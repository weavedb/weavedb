var zc=Object.create;var Uo=Object.defineProperty;var Cc=Object.getOwnPropertyDescriptor;var Lc=Object.getOwnPropertyNames;var Rc=Object.getPrototypeOf,Mc=Object.prototype.hasOwnProperty;var ut=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Dc=(e,r)=>{for(var t in r)Uo(e,t,{get:r[t],enumerable:!0})},Tc=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Lc(r))!Mc.call(e,o)&&o!==t&&Uo(e,o,{get:()=>r[o],enumerable:!(n=Cc(r,o))||n.enumerable});return e};var Zt=(e,r,t)=>(t=e!=null?zc(Rc(e)):{},Tc(r||!e||!e.__esModule?Uo(t,"default",{value:e,enumerable:!0}):t,e));var qe=ut(($a,Fn)=>{(function(e,r){var t={};r(t);var n=t.default;for(var o in t)n[o]=t[o];typeof Fn=="object"&&typeof Fn.exports=="object"?Fn.exports=n:typeof define=="function"&&define.amd?define(function(){return n}):e.sha256=n})($a,function(e){"use strict";e.__esModule=!0,e.digestLength=32,e.blockSize=64;var r=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function t(g,l,c,d,h){for(var x,w,_,v,k,S,E,P,$,O,U,L,F;h>=64;){for(x=l[0],w=l[1],_=l[2],v=l[3],k=l[4],S=l[5],E=l[6],P=l[7],O=0;O<16;O++)U=d+O*4,g[O]=(c[U]&255)<<24|(c[U+1]&255)<<16|(c[U+2]&255)<<8|c[U+3]&255;for(O=16;O<64;O++)$=g[O-2],L=($>>>17|$<<15)^($>>>19|$<<13)^$>>>10,$=g[O-15],F=($>>>7|$<<25)^($>>>18|$<<14)^$>>>3,g[O]=(L+g[O-7]|0)+(F+g[O-16]|0);for(O=0;O<64;O++)L=(((k>>>6|k<<26)^(k>>>11|k<<21)^(k>>>25|k<<7))+(k&S^~k&E)|0)+(P+(r[O]+g[O]|0)|0)|0,F=((x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10))+(x&w^x&_^w&_)|0,P=E,E=S,S=k,k=v+L|0,v=_,_=w,w=x,x=L+F|0;l[0]+=x,l[1]+=w,l[2]+=_,l[3]+=v,l[4]+=k,l[5]+=S,l[6]+=E,l[7]+=P,d+=64,h-=64}return d}var n=(function(){function g(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return g.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},g.prototype.clean=function(){for(var l=0;l<this.buffer.length;l++)this.buffer[l]=0;for(var l=0;l<this.temp.length;l++)this.temp[l]=0;this.reset()},g.prototype.update=function(l,c){if(c===void 0&&(c=l.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var d=0;if(this.bytesHashed+=c,this.bufferLength>0){for(;this.bufferLength<64&&c>0;)this.buffer[this.bufferLength++]=l[d++],c--;this.bufferLength===64&&(t(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(c>=64&&(d=t(this.temp,this.state,l,d,c),c%=64);c>0;)this.buffer[this.bufferLength++]=l[d++],c--;return this},g.prototype.finish=function(l){if(!this.finished){var c=this.bytesHashed,d=this.bufferLength,h=c/536870912|0,x=c<<3,w=c%64<56?64:128;this.buffer[d]=128;for(var _=d+1;_<w-8;_++)this.buffer[_]=0;this.buffer[w-8]=h>>>24&255,this.buffer[w-7]=h>>>16&255,this.buffer[w-6]=h>>>8&255,this.buffer[w-5]=h>>>0&255,this.buffer[w-4]=x>>>24&255,this.buffer[w-3]=x>>>16&255,this.buffer[w-2]=x>>>8&255,this.buffer[w-1]=x>>>0&255,t(this.temp,this.state,this.buffer,0,w),this.finished=!0}for(var _=0;_<8;_++)l[_*4+0]=this.state[_]>>>24&255,l[_*4+1]=this.state[_]>>>16&255,l[_*4+2]=this.state[_]>>>8&255,l[_*4+3]=this.state[_]>>>0&255;return this},g.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},g.prototype._saveState=function(l){for(var c=0;c<this.state.length;c++)l[c]=this.state[c]},g.prototype._restoreState=function(l,c){for(var d=0;d<this.state.length;d++)this.state[d]=l[d];this.bytesHashed=c,this.finished=!1,this.bufferLength=0},g})();e.Hash=n;var o=(function(){function g(l){this.inner=new n,this.outer=new n,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var c=new Uint8Array(this.blockSize);if(l.length>this.blockSize)new n().update(l).finish(c).clean();else for(var d=0;d<l.length;d++)c[d]=l[d];for(var d=0;d<c.length;d++)c[d]^=54;this.inner.update(c);for(var d=0;d<c.length;d++)c[d]^=106;this.outer.update(c),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var d=0;d<c.length;d++)c[d]=0}return g.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},g.prototype.clean=function(){for(var l=0;l<this.istate.length;l++)this.ostate[l]=this.istate[l]=0;this.inner.clean(),this.outer.clean()},g.prototype.update=function(l){return this.inner.update(l),this},g.prototype.finish=function(l){return this.outer.finished?this.outer.finish(l):(this.inner.finish(l),this.outer.update(l,this.digestLength).finish(l)),this},g.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},g})();e.HMAC=o;function i(g){var l=new n().update(g),c=l.digest();return l.clean(),c}e.hash=i,e.default=i;function a(g,l){var c=new o(g).update(l),d=c.digest();return c.clean(),d}e.hmac=a;function f(g,l,c,d){var h=d[0];if(h===0)throw new Error("hkdf: cannot expand more");l.reset(),h>1&&l.update(g),c&&l.update(c),l.update(d),l.finish(g),d[0]++}var s=new Uint8Array(e.digestLength);function u(g,l,c,d){l===void 0&&(l=s),d===void 0&&(d=32);for(var h=new Uint8Array([1]),x=a(l,g),w=new o(x),_=new Uint8Array(w.digestLength),v=_.length,k=new Uint8Array(d),S=0;S<d;S++)v===_.length&&(f(_,w,c,h),v=0),k[S]=_[v++];return w.clean(),_.fill(0),h.fill(0),k}e.hkdf=u;function m(g,l,c,d){for(var h=new o(g),x=h.digestLength,w=new Uint8Array(4),_=new Uint8Array(x),v=new Uint8Array(x),k=new Uint8Array(d),S=0;S*x<d;S++){var E=S+1;w[0]=E>>>24&255,w[1]=E>>>16&255,w[2]=E>>>8&255,w[3]=E>>>0&255,h.reset(),h.update(l),h.update(w),h.finish(v);for(var P=0;P<x;P++)_[P]=v[P];for(var P=2;P<=c;P++){h.reset(),h.update(v).finish(v);for(var $=0;$<x;$++)_[$]^=v[$]}for(var P=0;P<x&&S*x+P<d;P++)k[S*x+P]=_[P]}for(var S=0;S<x;S++)_[S]=v[S]=0;for(var S=0;S<4;S++)w[S]=0;return h.clean(),k}e.pbkdf2=m})});var Ba=ut(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});function lm(e){var r=4,t=e.length,n=t%r;if(!n)return e;var o=t,i=r-n,a=t+i,f=Buffer.alloc(a);for(f.write(e);i--;)f.write("=",o++);return f.toString()}di.default=lm});var Fa=ut(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});var cm=Ba();function Ia(e,r){return r===void 0&&(r="utf8"),Buffer.isBuffer(e)?hi(e.toString("base64")):hi(Buffer.from(e,r).toString("base64"))}function pm(e,r){return r===void 0&&(r="utf8"),Buffer.from(yi(e),"base64").toString(r)}function yi(e){return e=e.toString(),cm.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function hi(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function mm(e){return Buffer.from(yi(e),"base64")}var pe=Ia;pe.encode=Ia;pe.decode=pm;pe.toBase64=yi;pe.fromBase64=hi;pe.toBuffer=mm;gi.default=pe});var ja=ut((bk,Nn)=>{Nn.exports=Fa().default;Nn.exports.default=Nn.exports});var St=ut((jr,Oi)=>{"use strict";var bi=jr.ValidationError=function(r,t,n,o,i,a){if(Array.isArray(o)?(this.path=o,this.property=o.reduce(function(s,u){return s+Ta(u)},"instance")):o!==void 0&&(this.property=o),r&&(this.message=r),n){var f=n.$id||n.id;this.schema=f||n}t!==void 0&&(this.instance=t),this.name=i,this.argument=a,this.stack=this.toString()};bi.prototype.toString=function(){return this.property+" "+this.message};var zn=jr.ValidatorResult=function(r,t,n,o){this.instance=r,this.schema=t,this.options=n,this.path=o.path,this.propertyPath=o.propertyPath,this.errors=[],this.throwError=n&&n.throwError,this.throwFirst=n&&n.throwFirst,this.throwAll=n&&n.throwAll,this.disableFormat=n&&n.disableFormat===!0};zn.prototype.addError=function(r){var t;if(typeof r=="string")t=new bi(r,this.instance,this.schema,this.path);else{if(!r)throw new Error("Missing error detail");if(!r.message)throw new Error("Missing error message");if(!r.name)throw new Error("Missing validator type");t=new bi(r.message,this.instance,this.schema,this.path,r.name,r.argument)}if(this.errors.push(t),this.throwFirst)throw new re(this);if(this.throwError)throw t;return t};zn.prototype.importErrors=function(r){typeof r=="string"||r&&r.validatorType?this.addError(r):r&&r.errors&&(this.errors=this.errors.concat(r.errors))};function Em(e,r){return r+": "+e.toString()+`
`}zn.prototype.toString=function(r){return this.errors.map(Em).join("")};Object.defineProperty(zn.prototype,"valid",{get:function(){return!this.errors.length}});Oi.exports.ValidatorResultError=re;function re(e){typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,re),this.instance=e.instance,this.schema=e.schema,this.options=e.options,this.errors=e.errors}re.prototype=new Error;re.prototype.constructor=re;re.prototype.name="Validation Error";var Da=jr.SchemaError=function e(r,t){this.message=r,this.schema=t,Error.call(this,r),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)};Da.prototype=Object.create(Error.prototype,{constructor:{value:Da,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var ki=jr.SchemaContext=function(r,t,n,o,i){this.schema=r,this.options=t,Array.isArray(n)?(this.path=n,this.propertyPath=n.reduce(function(a,f){return a+Ta(f)},"instance")):this.propertyPath=n,this.base=o,this.schemas=i};ki.prototype.resolve=function(r){return Ua(this.base,r)};ki.prototype.makeChild=function(r,t){var n=t===void 0?this.path:this.path.concat([t]),o=r.$id||r.id;let i=Ua(this.base,o||"");var a=new ki(r,this.options,n,i,Object.create(this.schemas));return o&&!a.schemas[i]&&(a.schemas[i]=r),a};var Gr=jr.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(e){return typeof e=="string"&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var r=!0;try{new RegExp(e)}catch{r=!1}return r},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};Gr.regexp=Gr.regex;Gr.pattern=Gr.regex;Gr.ipv4=Gr["ip-address"];jr.isFormat=function(r,t,n){if(typeof r=="string"&&Gr[t]!==void 0){if(Gr[t]instanceof RegExp)return Gr[t].test(r);if(typeof Gr[t]=="function")return Gr[t](r)}else if(n&&n.customFormats&&typeof n.customFormats[t]=="function")return n.customFormats[t](r);return!0};var Ta=jr.makeSuffix=function(r){return r=r.toString(),!r.match(/[.\s\[\]]/)&&!r.match(/^[\d]/)?"."+r:r.match(/^\d+$/)?"["+r+"]":"["+JSON.stringify(r)+"]"};jr.deepCompareStrict=function e(r,t){if(typeof r!=typeof t)return!1;if(Array.isArray(r))return!Array.isArray(t)||r.length!==t.length?!1:r.every(function(i,a){return e(r[a],t[a])});if(typeof r=="object"){if(!r||!t)return r===t;var n=Object.keys(r),o=Object.keys(t);return n.length!==o.length?!1:n.every(function(i){return e(r[i],t[i])})}return r===t};function Bm(e,r,t,n){typeof t=="object"?r[n]=Si(e[n],t):e.indexOf(t)===-1&&r.push(t)}function Im(e,r,t){r[t]=e[t]}function Fm(e,r,t,n){typeof r[n]!="object"||!r[n]?t[n]=r[n]:e[n]?t[n]=Si(e[n],r[n]):t[n]=r[n]}function Si(e,r){var t=Array.isArray(r),n=t&&[]||{};return t?(e=e||[],n=n.concat(e),r.forEach(Bm.bind(null,e,n))):(e&&typeof e=="object"&&Object.keys(e).forEach(Im.bind(null,e,n)),Object.keys(r).forEach(Fm.bind(null,e,r,n))),n}Oi.exports.deepMerge=Si;jr.objectGetPath=function(r,t){for(var n=t.split("/").slice(1),o;typeof(o=n.shift())=="string";){var i=decodeURIComponent(o.replace(/~0/,"~").replace(/~1/g,"/"));if(!(i in r))return;r=r[i]}return r};function jm(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}jr.encodePath=function(r){return r.map(jm).join("")};jr.getDecimalPlaces=function(r){var t=0;if(isNaN(r))return t;typeof r!="number"&&(r=Number(r));var n=r.toString().split("e");if(n.length===2){if(n[1][0]!=="-")return t;t=Number(n[1].slice(1))}var o=n[0].split(".");return o.length===2&&(t+=o[1].length),t};jr.isSchema=function(r){return typeof r=="object"&&r||typeof r=="boolean"};var Ua=jr.resolveUrl=function(r,t){let n=new URL(t,new URL(r,"resolve://"));if(n.protocol==="resolve:"){let{pathname:o,search:i,hash:a}=n;return o+i+a}return n.toString()}});var Ja=ut((Uk,Va)=>{"use strict";var Lr=St(),V=Lr.ValidatorResult,Ot=Lr.SchemaError,$i={};$i.ignoreProperties={id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0};var J=$i.validators={};J.type=function(r,t,n,o){if(r===void 0)return null;var i=new V(r,t,n,o),a=Array.isArray(t.type)?t.type:[t.type];if(!a.some(this.testType.bind(this,r,t,n,o))){var f=a.map(function(s){if(s){var u=s.$id||s.id;return u?"<"+u+">":s+""}});i.addError({name:"type",argument:f,message:"is not of a type(s) "+f})}return i};function Ei(e,r,t,n,o){var i=r.throwError,a=r.throwAll;r.throwError=!1,r.throwAll=!1;var f=this.validateSchema(e,o,r,t);return r.throwError=i,r.throwAll=a,!f.valid&&n instanceof Function&&n(f),f.valid}J.anyOf=function(r,t,n,o){if(r===void 0)return null;var i=new V(r,t,n,o),a=new V(r,t,n,o);if(!Array.isArray(t.anyOf))throw new Ot("anyOf must be an array");if(!t.anyOf.some(Ei.bind(this,r,n,o,function(s){a.importErrors(s)}))){var f=t.anyOf.map(function(s,u){var m=s.$id||s.id;return m?"<"+m+">":s.title&&JSON.stringify(s.title)||s.$ref&&"<"+s.$ref+">"||"[subschema "+u+"]"});n.nestedErrors&&i.importErrors(a),i.addError({name:"anyOf",argument:f,message:"is not any of "+f.join(",")})}return i};J.allOf=function(r,t,n,o){if(r===void 0)return null;if(!Array.isArray(t.allOf))throw new Ot("allOf must be an array");var i=new V(r,t,n,o),a=this;return t.allOf.forEach(function(f,s){var u=a.validateSchema(r,f,n,o);if(!u.valid){var m=f.$id||f.id,g=m||f.title&&JSON.stringify(f.title)||f.$ref&&"<"+f.$ref+">"||"[subschema "+s+"]";i.addError({name:"allOf",argument:{id:g,length:u.errors.length,valid:u},message:"does not match allOf schema "+g+" with "+u.errors.length+" error[s]:"}),i.importErrors(u)}}),i};J.oneOf=function(r,t,n,o){if(r===void 0)return null;if(!Array.isArray(t.oneOf))throw new Ot("oneOf must be an array");var i=new V(r,t,n,o),a=new V(r,t,n,o),f=t.oneOf.filter(Ei.bind(this,r,n,o,function(u){a.importErrors(u)})).length,s=t.oneOf.map(function(u,m){var g=u.$id||u.id;return g||u.title&&JSON.stringify(u.title)||u.$ref&&"<"+u.$ref+">"||"[subschema "+m+"]"});return f!==1&&(n.nestedErrors&&i.importErrors(a),i.addError({name:"oneOf",argument:s,message:"is not exactly one from "+s.join(",")})),i};J.if=function(r,t,n,o){if(r===void 0)return null;if(!Lr.isSchema(t.if))throw new Error('Expected "if" keyword to be a schema');var i=Ei.call(this,r,n,o,null,t.if),a=new V(r,t,n,o),f;if(i){if(t.then===void 0)return;if(!Lr.isSchema(t.then))throw new Error('Expected "then" keyword to be a schema');f=this.validateSchema(r,t.then,n,o.makeChild(t.then)),a.importErrors(f)}else{if(t.else===void 0)return;if(!Lr.isSchema(t.else))throw new Error('Expected "else" keyword to be a schema');f=this.validateSchema(r,t.else,n,o.makeChild(t.else)),a.importErrors(f)}return a};function Bi(e,r){if(Object.hasOwnProperty.call(e,r))return e[r];if(r in e){for(;e=Object.getPrototypeOf(e);)if(Object.propertyIsEnumerable.call(e,r))return e[r]}}J.propertyNames=function(r,t,n,o){if(this.types.object(r)){var i=new V(r,t,n,o),a=t.propertyNames!==void 0?t.propertyNames:{};if(!Lr.isSchema(a))throw new Ot('Expected "propertyNames" to be a schema (object or boolean)');for(var f in r)if(Bi(r,f)!==void 0){var s=this.validateSchema(f,a,n,o.makeChild(a));i.importErrors(s)}return i}};J.properties=function(r,t,n,o){if(this.types.object(r)){var i=new V(r,t,n,o),a=t.properties||{};for(var f in a){var s=a[f];if(s!==void 0){if(s===null)throw new Ot('Unexpected null, expected schema in "properties"');typeof n.preValidateProperty=="function"&&n.preValidateProperty(r,f,s,n,o);var u=Bi(r,f),m=this.validateSchema(u,s,n,o.makeChild(s,f));m.instance!==i.instance[f]&&(i.instance[f]=m.instance),i.importErrors(m)}}return i}};function Za(e,r,t,n,o,i){if(this.types.object(e)&&!(r.properties&&r.properties[o]!==void 0))if(r.additionalProperties===!1)i.addError({name:"additionalProperties",argument:o,message:"is not allowed to have the additional property "+JSON.stringify(o)});else{var a=r.additionalProperties||{};typeof t.preValidateProperty=="function"&&t.preValidateProperty(e,o,a,t,n);var f=this.validateSchema(e[o],a,t,n.makeChild(a,o));f.instance!==i.instance[o]&&(i.instance[o]=f.instance),i.importErrors(f)}}J.patternProperties=function(r,t,n,o){if(this.types.object(r)){var i=new V(r,t,n,o),a=t.patternProperties||{};for(var f in r){var s=!0;for(var u in a){var m=a[u];if(m!==void 0){if(m===null)throw new Ot('Unexpected null, expected schema in "patternProperties"');try{var g=new RegExp(u,"u")}catch{g=new RegExp(u)}if(g.test(f)){s=!1,typeof n.preValidateProperty=="function"&&n.preValidateProperty(r,f,m,n,o);var l=this.validateSchema(r[f],m,n,o.makeChild(m,f));l.instance!==i.instance[f]&&(i.instance[f]=l.instance),i.importErrors(l)}}}s&&Za.call(this,r,t,n,o,f,i)}return i}};J.additionalProperties=function(r,t,n,o){if(this.types.object(r)){if(t.patternProperties)return null;var i=new V(r,t,n,o);for(var a in r)Za.call(this,r,t,n,o,a,i);return i}};J.minProperties=function(r,t,n,o){if(this.types.object(r)){var i=new V(r,t,n,o),a=Object.keys(r);return a.length>=t.minProperties||i.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),i}};J.maxProperties=function(r,t,n,o){if(this.types.object(r)){var i=new V(r,t,n,o),a=Object.keys(r);return a.length<=t.maxProperties||i.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),i}};J.items=function(r,t,n,o){var i=this;if(this.types.array(r)&&t.items!==void 0){var a=new V(r,t,n,o);return r.every(function(f,s){if(Array.isArray(t.items))var u=t.items[s]===void 0?t.additionalItems:t.items[s];else var u=t.items;if(u===void 0)return!0;if(u===!1)return a.addError({name:"items",message:"additionalItems not permitted"}),!1;var m=i.validateSchema(f,u,n,o.makeChild(u,s));return m.instance!==a.instance[s]&&(a.instance[s]=m.instance),a.importErrors(m),!0}),a}};J.contains=function(r,t,n,o){var i=this;if(this.types.array(r)&&t.contains!==void 0){if(!Lr.isSchema(t.contains))throw new Error('Expected "contains" keyword to be a schema');var a=new V(r,t,n,o),f=r.some(function(s,u){var m=i.validateSchema(s,t.contains,n,o.makeChild(t.contains,u));return m.errors.length===0});return f===!1&&a.addError({name:"contains",argument:t.contains,message:"must contain an item matching given schema"}),a}};J.minimum=function(r,t,n,o){if(this.types.number(r)){var i=new V(r,t,n,o);return t.exclusiveMinimum&&t.exclusiveMinimum===!0?r>t.minimum||i.addError({name:"minimum",argument:t.minimum,message:"must be greater than "+t.minimum}):r>=t.minimum||i.addError({name:"minimum",argument:t.minimum,message:"must be greater than or equal to "+t.minimum}),i}};J.maximum=function(r,t,n,o){if(this.types.number(r)){var i=new V(r,t,n,o);return t.exclusiveMaximum&&t.exclusiveMaximum===!0?r<t.maximum||i.addError({name:"maximum",argument:t.maximum,message:"must be less than "+t.maximum}):r<=t.maximum||i.addError({name:"maximum",argument:t.maximum,message:"must be less than or equal to "+t.maximum}),i}};J.exclusiveMinimum=function(r,t,n,o){if(typeof t.exclusiveMinimum!="boolean"&&this.types.number(r)){var i=new V(r,t,n,o),a=r>t.exclusiveMinimum;return a||i.addError({name:"exclusiveMinimum",argument:t.exclusiveMinimum,message:"must be strictly greater than "+t.exclusiveMinimum}),i}};J.exclusiveMaximum=function(r,t,n,o){if(typeof t.exclusiveMaximum!="boolean"&&this.types.number(r)){var i=new V(r,t,n,o),a=r<t.exclusiveMaximum;return a||i.addError({name:"exclusiveMaximum",argument:t.exclusiveMaximum,message:"must be strictly less than "+t.exclusiveMaximum}),i}};var qa=function(r,t,n,o,i,a){if(this.types.number(r)){var f=t[i];if(f==0)throw new Ot(i+" cannot be zero");var s=new V(r,t,n,o),u=Lr.getDecimalPlaces(r),m=Lr.getDecimalPlaces(f),g=Math.max(u,m),l=Math.pow(10,g);return Math.round(r*l)%Math.round(f*l)!==0&&s.addError({name:i,argument:f,message:a+JSON.stringify(f)}),s}};J.multipleOf=function(r,t,n,o){return qa.call(this,r,t,n,o,"multipleOf","is not a multiple of (divisible by) ")};J.divisibleBy=function(r,t,n,o){return qa.call(this,r,t,n,o,"divisibleBy","is not divisible by (multiple of) ")};J.required=function(r,t,n,o){var i=new V(r,t,n,o);return r===void 0&&t.required===!0?i.addError({name:"required",message:"is required"}):this.types.object(r)&&Array.isArray(t.required)&&t.required.forEach(function(a){Bi(r,a)===void 0&&i.addError({name:"required",argument:a,message:"requires property "+JSON.stringify(a)})}),i};J.pattern=function(r,t,n,o){if(this.types.string(r)){var i=new V(r,t,n,o),a=t.pattern;try{var f=new RegExp(a,"u")}catch{f=new RegExp(a)}return r.match(f)||i.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern.toString())}),i}};J.format=function(r,t,n,o){if(r!==void 0){var i=new V(r,t,n,o);return!i.disableFormat&&!Lr.isFormat(r,t.format,this)&&i.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),i}};J.minLength=function(r,t,n,o){if(this.types.string(r)){var i=new V(r,t,n,o),a=r.match(/[\uDC00-\uDFFF]/g),f=r.length-(a?a.length:0);return f>=t.minLength||i.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),i}};J.maxLength=function(r,t,n,o){if(this.types.string(r)){var i=new V(r,t,n,o),a=r.match(/[\uDC00-\uDFFF]/g),f=r.length-(a?a.length:0);return f<=t.maxLength||i.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),i}};J.minItems=function(r,t,n,o){if(this.types.array(r)){var i=new V(r,t,n,o);return r.length>=t.minItems||i.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),i}};J.maxItems=function(r,t,n,o){if(this.types.array(r)){var i=new V(r,t,n,o);return r.length<=t.maxItems||i.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),i}};function Nm(e,r,t){var n,o=t.length;for(n=r+1,o;n<o;n++)if(Lr.deepCompareStrict(e,t[n]))return!1;return!0}J.uniqueItems=function(r,t,n,o){if(t.uniqueItems===!0&&this.types.array(r)){var i=new V(r,t,n,o);return r.every(Nm)||i.addError({name:"uniqueItems",message:"contains duplicate item"}),i}};J.dependencies=function(r,t,n,o){if(this.types.object(r)){var i=new V(r,t,n,o);for(var a in t.dependencies)if(r[a]!==void 0){var f=t.dependencies[a],s=o.makeChild(f,a);if(typeof f=="string"&&(f=[f]),Array.isArray(f))f.forEach(function(m){r[m]===void 0&&i.addError({name:"dependencies",argument:s.propertyPath,message:"property "+m+" not found, required by "+s.propertyPath})});else{var u=this.validateSchema(r,f,n,s);i.instance!==u.instance&&(i.instance=u.instance),u&&u.errors.length&&(i.addError({name:"dependencies",argument:s.propertyPath,message:"does not meet dependency required by "+s.propertyPath}),i.importErrors(u))}}return i}};J.enum=function(r,t,n,o){if(r===void 0)return null;if(!Array.isArray(t.enum))throw new Ot("enum expects an array",t);var i=new V(r,t,n,o);return t.enum.some(Lr.deepCompareStrict.bind(null,r))||i.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),i};J.const=function(r,t,n,o){if(r===void 0)return null;var i=new V(r,t,n,o);return Lr.deepCompareStrict(t.const,r)||i.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),i};J.not=J.disallow=function(r,t,n,o){var i=this;if(r===void 0)return null;var a=new V(r,t,n,o),f=t.not||t.disallow;return f?(Array.isArray(f)||(f=[f]),f.forEach(function(s){if(i.testType(r,t,n,o,s)){var u=s&&(s.$id||s.id),m=u||s;a.addError({name:"not",argument:m,message:"is of prohibited type "+m})}}),a):null};Va.exports=$i});var Cn=ut((Zk,Fi)=>{"use strict";var Ii=St();Fi.exports.SchemaScanResult=Xa;function Xa(e,r){this.id=e,this.ref=r}Fi.exports.scan=function(r,t){function n(s,u){if(!u||typeof u!="object")return;if(u.$ref){let c=Ii.resolveUrl(s,u.$ref);f[c]=f[c]?f[c]+1:0;return}var m=u.$id||u.id;let g=Ii.resolveUrl(s,m);var l=m?g:s;if(l){if(l.indexOf("#")<0&&(l+="#"),a[l]){if(!Ii.deepCompareStrict(a[l],u))throw new Error("Schema <"+l+"> already exists with different definition");return a[l]}a[l]=u,l[l.length-1]=="#"&&(a[l.substring(0,l.length-1)]=u)}o(l+"/items",Array.isArray(u.items)?u.items:[u.items]),o(l+"/extends",Array.isArray(u.extends)?u.extends:[u.extends]),n(l+"/additionalItems",u.additionalItems),i(l+"/properties",u.properties),n(l+"/additionalProperties",u.additionalProperties),i(l+"/definitions",u.definitions),i(l+"/patternProperties",u.patternProperties),i(l+"/dependencies",u.dependencies),o(l+"/disallow",u.disallow),o(l+"/allOf",u.allOf),o(l+"/anyOf",u.anyOf),o(l+"/oneOf",u.oneOf),n(l+"/not",u.not)}function o(s,u){if(Array.isArray(u))for(var m=0;m<u.length;m++)n(s+"/"+m,u[m])}function i(s,u){if(!(!u||typeof u!="object"))for(var m in u)n(s+"/"+m,u[m])}var a={},f={};return n(r,t),new Xa(a,f)}});var tf=ut((qk,rf)=>{"use strict";var Ha=Ja(),$t=St(),Ka=Cn().scan,Ga=$t.ValidatorResult,Pm=$t.ValidatorResultError,Xe=$t.SchemaError,Qa=$t.SchemaContext,Wm="/",_r=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(et),this.attributes=Object.create(Ha.validators)};_r.prototype.customFormats={};_r.prototype.schemas=null;_r.prototype.types=null;_r.prototype.attributes=null;_r.prototype.unresolvedRefs=null;_r.prototype.addSchema=function(r,t){var n=this;if(!r)return null;var o=Ka(t||Wm,r),i=t||r.$id||r.id;for(var a in o.id)this.schemas[a]=o.id[a];for(var a in o.ref)this.unresolvedRefs.push(a);return this.unresolvedRefs=this.unresolvedRefs.filter(function(f){return typeof n.schemas[f]>"u"}),this.schemas[i]};_r.prototype.addSubSchemaArray=function(r,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addSubSchema(r,t[n])};_r.prototype.addSubSchemaObject=function(r,t){if(!(!t||typeof t!="object"))for(var n in t)this.addSubSchema(r,t[n])};_r.prototype.setSchemas=function(r){this.schemas=r};_r.prototype.getSchema=function(r){return this.schemas[r]};_r.prototype.validate=function(r,t,n,o){if(typeof t!="boolean"&&typeof t!="object"||t===null)throw new Xe("Expected `schema` to be an object or boolean");n||(n={});var i=t.$id||t.id;let a=$t.resolveUrl(n.base,i||"");if(!o){o=new Qa(t,n,[],a,Object.create(this.schemas)),o.schemas[a]||(o.schemas[a]=t);var f=Ka(a,t);for(var s in f.id){var u=f.id[s];o.schemas[s]=u}}if(n.required&&r===void 0){var m=new Ga(r,t,n,o);return m.addError("is required, but is undefined"),m}var m=this.validateSchema(r,t,n,o);if(m){if(n.throwAll&&m.errors.length)throw new Pm(m)}else throw new Error("Result undefined");return m};function Ya(e){var r=typeof e=="string"?e:e.$ref;return typeof r=="string"?r:!1}_r.prototype.validateSchema=function(r,t,n,o){var i=new Ga(r,t,n,o);if(typeof t=="boolean")t===!0?t={}:t===!1&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(Array.isArray(t.extends)){var a={schema:t,ctx:o};t.extends.forEach(this.schemaTraverser.bind(this,a)),t=a.schema,a.schema=null,a.ctx=null,a=null}else t=$t.deepMerge(t,this.superResolve(t.extends,o));var f=Ya(t);if(f){var s=this.resolve(t,f,o),u=new Qa(s.subschema,n,o.path,s.switchSchema,o.schemas);return this.validateSchema(r,s.subschema,n,u)}var m=n&&n.skipAttributes||[];for(var g in t)if(!Ha.ignoreProperties[g]&&m.indexOf(g)<0){var l=null,c=this.attributes[g];if(c)l=c.call(this,r,t,n,o);else if(n.allowUnknownAttributes===!1)throw new Xe("Unsupported attribute: "+g,t);l&&i.importErrors(l)}if(typeof n.rewrite=="function"){var d=n.rewrite.call(this,r,t,n,o);i.instance=d}return i};_r.prototype.schemaTraverser=function(r,t){r.schema=$t.deepMerge(r.schema,this.superResolve(t,r.ctx))};_r.prototype.superResolve=function(r,t){var n=Ya(r);return n?this.resolve(r,n,t).subschema:r};_r.prototype.resolve=function(r,t,n){if(t=n.resolve(t),n.schemas[t])return{subschema:n.schemas[t],switchSchema:t};let i=new URL(t,"thismessage::/").hash;var a=i&&i.length&&t.substr(0,t.length-i.length);if(!a||!n.schemas[a])throw new Xe("no such schema <"+t+">",r);var f=$t.objectGetPath(n.schemas[a],i.substr(1));if(f===void 0)throw new Xe("no such schema "+i+" located in <"+a+">",r);return{subschema:f,switchSchema:t}};_r.prototype.testType=function(r,t,n,o,i){if(i!==void 0){if(i===null)throw new Xe('Unexpected null in "type" keyword');if(typeof this.types[i]=="function")return this.types[i].call(this,r);if(i&&typeof i=="object"){var a=this.validateSchema(r,i,n,o);return a===void 0||!(a&&a.errors.length)}return!0}};var et=_r.prototype.types={};et.string=function(r){return typeof r=="string"};et.number=function(r){return typeof r=="number"&&isFinite(r)};et.integer=function(r){return typeof r=="number"&&r%1===0};et.boolean=function(r){return typeof r=="boolean"};et.array=function(r){return Array.isArray(r)};et.null=function(r){return r===null};et.date=function(r){return r instanceof Date};et.any=function(r){return!0};et.object=function(r){return r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)};rf.exports=_r});var ji=ut((Vk,ht)=>{"use strict";var zm=ht.exports.Validator=tf();ht.exports.ValidatorResult=St().ValidatorResult;ht.exports.ValidatorResultError=St().ValidatorResultError;ht.exports.ValidationError=St().ValidationError;ht.exports.SchemaError=St().SchemaError;ht.exports.SchemaScanResult=Cn().SchemaScanResult;ht.exports.scan=Cn().scan;ht.exports.validate=function(e,r,t){var n=new zm;return n.validate(e,r,t)}});function G(e){return e!=null&&typeof e=="object"&&e["@@functional/placeholder"]===!0}function W(e){return function r(t){return arguments.length===0||G(t)?r:e.apply(this,arguments)}}function B(e){return function r(t,n){switch(arguments.length){case 0:return r;case 1:return G(t)?r:W(function(o){return e(t,o)});default:return G(t)&&G(n)?r:G(t)?W(function(o){return e(o,n)}):G(n)?W(function(o){return e(t,o)}):e(t,n)}}}function We(e,r){e=e||[],r=r||[];var t,n=e.length,o=r.length,i=[];for(t=0;t<n;)i[i.length]=e[t],t+=1;for(t=0;t<o;)i[i.length]=r[t],t+=1;return i}function lt(e,r){switch(e){case 0:return function(){return r.apply(this,arguments)};case 1:return function(t){return r.apply(this,arguments)};case 2:return function(t,n){return r.apply(this,arguments)};case 3:return function(t,n,o){return r.apply(this,arguments)};case 4:return function(t,n,o,i){return r.apply(this,arguments)};case 5:return function(t,n,o,i,a){return r.apply(this,arguments)};case 6:return function(t,n,o,i,a,f){return r.apply(this,arguments)};case 7:return function(t,n,o,i,a,f,s){return r.apply(this,arguments)};case 8:return function(t,n,o,i,a,f,s,u){return r.apply(this,arguments)};case 9:return function(t,n,o,i,a,f,s,u,m){return r.apply(this,arguments)};case 10:return function(t,n,o,i,a,f,s,u,m,g){return r.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function yn(e,r,t){return function(){for(var n=[],o=0,i=e,a=0,f=!1;a<r.length||o<arguments.length;){var s;a<r.length&&(!G(r[a])||o>=arguments.length)?s=r[a]:(s=arguments[o],o+=1),n[a]=s,G(s)?f=!0:i-=1,a+=1}return!f&&i<=0?t.apply(this,n):lt(Math.max(0,i),yn(e,n,t))}}var Uc=B(function(r,t){return r===1?W(t):lt(r,yn(r,[],t))}),qt=Uc;function Hr(e){return function r(t,n,o){switch(arguments.length){case 0:return r;case 1:return G(t)?r:B(function(i,a){return e(t,i,a)});case 2:return G(t)&&G(n)?r:G(t)?B(function(i,a){return e(i,n,a)}):G(n)?B(function(i,a){return e(t,i,a)}):W(function(i){return e(t,n,i)});default:return G(t)&&G(n)&&G(o)?r:G(t)&&G(n)?B(function(i,a){return e(i,a,o)}):G(t)&&G(o)?B(function(i,a){return e(i,n,a)}):G(n)&&G(o)?B(function(i,a){return e(t,i,a)}):G(t)?W(function(i){return e(i,n,o)}):G(n)?W(function(i){return e(t,i,o)}):G(o)?W(function(i){return e(t,n,i)}):e(t,n,o)}}}var Cr=Array.isArray||function(r){return r!=null&&r.length>=0&&Object.prototype.toString.call(r)==="[object Array]"};function Zo(e){return e!=null&&typeof e["@@transducer/step"]=="function"}function Vt(e,r,t){return function(){if(arguments.length===0)return t();var n=arguments[arguments.length-1];if(!Cr(n)){for(var o=0;o<e.length;){if(typeof n[e[o]]=="function")return n[e[o]].apply(n,Array.prototype.slice.call(arguments,0,-1));o+=1}if(Zo(n)){var i=r.apply(null,Array.prototype.slice.call(arguments,0,-1));return i(n)}}return t.apply(this,arguments)}}var ct={init:function(){return this.xf["@@transducer/init"]()},result:function(e){return this.xf["@@transducer/result"](e)}};function gn(e){for(var r=[],t;!(t=e.next()).done;)r.push(t.value);return r}function xn(e,r,t){for(var n=0,o=t.length;n<o;){if(e(r,t[n]))return!0;n+=1}return!1}function qo(e){var r=String(e).match(/^function (\w*)/);return r==null?"":r[1]}function Yr(e,r){return Object.prototype.hasOwnProperty.call(r,e)}function Zc(e,r){return e===r?e!==0||1/e===1/r:e!==e&&r!==r}var vn=typeof Object.is=="function"?Object.is:Zc;var ia=Object.prototype.toString,qc=(function(){return ia.call(arguments)==="[object Arguments]"?function(r){return ia.call(r)==="[object Arguments]"}:function(r){return Yr("callee",r)}})(),aa=qc;var Vc=!{toString:null}.propertyIsEnumerable("toString"),fa=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],sa=(function(){"use strict";return arguments.propertyIsEnumerable("length")})(),Jc=function(r,t){for(var n=0;n<r.length;){if(r[n]===t)return!0;n+=1}return!1},Xc=typeof Object.keys=="function"&&!sa?W(function(r){return Object(r)!==r?[]:Object.keys(r)}):W(function(r){if(Object(r)!==r)return[];var t,n,o=[],i=sa&&aa(r);for(t in r)Yr(t,r)&&(!i||t!=="length")&&(o[o.length]=t);if(Vc)for(n=fa.length-1;n>=0;)t=fa[n],Yr(t,r)&&!Jc(o,t)&&(o[o.length]=t),n-=1;return o}),q=Xc;var Hc=W(function(r){return r===null?"Null":r===void 0?"Undefined":Object.prototype.toString.call(r).slice(8,-1)}),ze=Hc;function ua(e,r,t,n){var o=gn(e),i=gn(r);function a(f,s){return Ce(f,s,t.slice(),n.slice())}return!xn(function(f,s){return!xn(a,s,f)},i,o)}function Ce(e,r,t,n){if(vn(e,r))return!0;var o=ze(e);if(o!==ze(r))return!1;if(typeof e["fantasy-land/equals"]=="function"||typeof r["fantasy-land/equals"]=="function")return typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](r)&&typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](e);if(typeof e.equals=="function"||typeof r.equals=="function")return typeof e.equals=="function"&&e.equals(r)&&typeof r.equals=="function"&&r.equals(e);switch(o){case"Arguments":case"Array":case"Object":if(typeof e.constructor=="function"&&qo(e.constructor)==="Promise")return e===r;break;case"Boolean":case"Number":case"String":if(!(typeof e==typeof r&&vn(e.valueOf(),r.valueOf())))return!1;break;case"Date":if(!vn(e.valueOf(),r.valueOf()))return!1;break;case"Error":return e.name===r.name&&e.message===r.message;case"RegExp":if(!(e.source===r.source&&e.global===r.global&&e.ignoreCase===r.ignoreCase&&e.multiline===r.multiline&&e.sticky===r.sticky&&e.unicode===r.unicode))return!1;break}for(var i=t.length-1;i>=0;){if(t[i]===e)return n[i]===r;i-=1}switch(o){case"Map":return e.size!==r.size?!1:ua(e.entries(),r.entries(),t.concat([e]),n.concat([r]));case"Set":return e.size!==r.size?!1:ua(e.values(),r.values(),t.concat([e]),n.concat([r]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var a=q(e);if(a.length!==q(r).length)return!1;var f=t.concat([e]),s=n.concat([r]);for(i=a.length-1;i>=0;){var u=a[i];if(!(Yr(u,r)&&Ce(r[u],e[u],f,s)))return!1;i-=1}return!0}var Kc=B(function(r,t){return Ce(r,t,[],[])}),kr=Kc;function Le(e,r,t){var n,o;if(typeof e.indexOf=="function")switch(typeof r){case"number":if(r===0){for(n=1/r;t<e.length;){if(o=e[t],o===0&&1/o===n)return t;t+=1}return-1}else if(r!==r){for(;t<e.length;){if(o=e[t],typeof o=="number"&&o!==o)return t;t+=1}return-1}return e.indexOf(r,t);case"string":case"boolean":case"function":case"undefined":return e.indexOf(r,t);case"object":if(r===null)return e.indexOf(r,t)}for(;t<e.length;){if(kr(e[t],r))return t;t+=1}return-1}function wt(e,r){return Le(r,e,0)>=0}function Jt(e,r){for(var t=0,n=r.length,o=Array(n);t<n;)o[t]=e(r[t]),t+=1;return o}function Re(e){var r=e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+r.replace(/"/g,'\\"')+'"'}var Me=function(r){return(r<10?"0":"")+r},Gc=typeof Date.prototype.toISOString=="function"?function(r){return r.toISOString()}:function(r){return r.getUTCFullYear()+"-"+Me(r.getUTCMonth()+1)+"-"+Me(r.getUTCDate())+"T"+Me(r.getUTCHours())+":"+Me(r.getUTCMinutes())+":"+Me(r.getUTCSeconds())+"."+(r.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},la=Gc;function Vo(e){return function(){return!e.apply(this,arguments)}}function pt(e,r,t){for(var n=0,o=t.length;n<o;)r=e(r,t[n]),n+=1;return r}function De(e,r){for(var t=0,n=r.length,o=[];t<n;)e(r[t])&&(o[o.length]=r[t]),t+=1;return o}function Jo(e,r){for(var t=new Map,n=r.entries(),o=n.next();!o.done;)e(o.value[1])&&t.set(o.value[0],o.value[1]),o=n.next();return t}function Xo(e){return Object.prototype.toString.call(e)==="[object Map]"}function Ho(e){return Object.prototype.toString.call(e)==="[object Object]"}var Qc=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=ct.init,e.prototype["@@transducer/result"]=ct.result,e.prototype["@@transducer/step"]=function(r,t){return this.f(t)?this.xf["@@transducer/step"](r,t):r},e})();function Ko(e){return function(r){return new Qc(e,r)}}var Yc=B(Vt(["fantasy-land/filter","filter"],Ko,function(e,r){return Ho(r)?pt(function(t,n){return e(r[n])&&(t[n]=r[n]),t},{},q(r)):Xo(r)?Jo(e,r):De(e,r)})),ca=Yc;var rp=B(function(r,t){return ca(Vo(r),t)}),_n=rp;function wn(e,r){var t=function(a){var f=r.concat([e]);return wt(a,f)?"<Circular>":wn(a,f)},n=function(i,a){return Jt(function(f){return Re(f)+": "+t(i[f])},a.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+Jt(t,e).join(", ")+"))";case"[object Array]":return"["+Jt(t,e).concat(n(e,_n(function(i){return/^\d+$/.test(i)},q(e)))).join(", ")+"]";case"[object Boolean]":return typeof e=="object"?"new Boolean("+t(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?t(NaN):Re(la(e)))+")";case"[object Map]":return"new Map("+t(Array.from(e))+")";case"[object Null]":return"null";case"[object Number]":return typeof e=="object"?"new Number("+t(e.valueOf())+")":1/e===-1/0?"-0":e.toString(10);case"[object Set]":return"new Set("+t(Array.from(e).sort())+")";case"[object String]":return typeof e=="object"?"new String("+t(e.valueOf())+")":Re(e);case"[object Undefined]":return"undefined";default:if(typeof e.toString=="function"){var o=e.toString();if(o!=="[object Object]")return o}return"{"+n(e,q(e)).join(", ")+"}"}}var tp=W(function(r){return wn(r,[])}),ue=tp;var ep=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=ct.init,e.prototype["@@transducer/result"]=ct.result,e.prototype["@@transducer/step"]=function(r,t){return this.xf["@@transducer/step"](r,this.f(t))},e})(),np=function(r){return function(t){return new ep(r,t)}},pa=np;var op=B(Vt(["fantasy-land/map","map"],pa,function(r,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return qt(t.length,function(){return r.call(this,t.apply(this,arguments))});case"[object Object]":return pt(function(n,o){return n[o]=r(t[o]),n},{},q(t));default:return Jt(r,t)}})),z=op;var At=Number.isInteger||function(r){return r<<0===r};function Xt(e,r){var t=e<0?r.length+e:e;return r[t]}function ip(e,r){if(r!=null)return At(e)?Xt(e,r):r[e]}var An=ip;var ap=B(An),Te=ap;var fp=B(function(r,t){return z(Te(r),t)}),rt=fp;function bt(e){return Object.prototype.toString.call(e)==="[object String]"}var sp=W(function(r){return Cr(r)?!0:!r||typeof r!="object"||bt(r)?!1:r.length===0?!0:r.length>0?r.hasOwnProperty(0)&&r.hasOwnProperty(r.length-1):!1}),bn=sp;var ma=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function Ue(e,r,t){return function(o,i,a){if(bn(a))return e(o,i,a);if(a==null)return i;if(typeof a["fantasy-land/reduce"]=="function")return r(o,i,a,"fantasy-land/reduce");if(a[ma]!=null)return t(o,i,a[ma]());if(typeof a.next=="function")return t(o,i,a);if(typeof a.reduce=="function")return r(o,i,a,"reduce");throw new TypeError("reduce: list must be array or iterable")}}function Go(e,r,t){for(var n=0,o=t.length;n<o;){if(r=e["@@transducer/step"](r,t[n]),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}n+=1}return e["@@transducer/result"](r)}var up=B(function(r,t){return lt(r.length,function(){return r.apply(t,arguments)})}),da=up;function lp(e,r,t){for(var n=t.next();!n.done;){if(r=e["@@transducer/step"](r,n.value),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}n=t.next()}return e["@@transducer/result"](r)}function cp(e,r,t,n){return e["@@transducer/result"](t[n](da(e["@@transducer/step"],e),r))}var pp=Ue(Go,cp,lp),ha=pp;var mp=(function(){function e(r){this.f=r}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(r){return r},e.prototype["@@transducer/step"]=function(r,t){return this.f(r,t)},e})();function Qo(e){return new mp(e)}var dp=Hr(function(e,r,t){return ha(typeof e=="function"?Qo(e):e,r,t)}),ya=dp;function hp(e,r,t){for(var n=t.next();!n.done;)r=e(r,n.value),n=t.next();return r}function yp(e,r,t,n){return t[n](e,r)}var gp=Ue(pt,yp,hp),ga=gp;var xp=B(function(r,t){return typeof t["fantasy-land/ap"]=="function"?t["fantasy-land/ap"](r):typeof r.ap=="function"?r.ap(t):typeof r=="function"?function(n){return r(n)(t(n))}:ga(function(n,o){return We(n,z(o,t))},[],r)}),xa=xp;var vp=B(function(r,t){return We(t,[r])}),mt=vp;function Yo(e,r,t){if(At(e)&&Cr(t)){var n=e<0?t.length+e:e,o=[].concat(t);return o[n]=r,o}var i={};for(var a in t)i[a]=t[a];return i[e]=r,i}var _p=W(function(r){return r==null}),y=_p;var wp=Hr(function e(r,t,n){if(r.length===0)return t;var o=r[0];if(r.length>1){var i=An(o,n);(y(i)||typeof i!="object")&&(i=At(r[1])?[]:{}),t=e(Array.prototype.slice.call(r,1),t,i)}return Yo(o,t,n)}),va=wp;var Ap=Hr(function(r,t,n){return va([r],t,n)}),kn=Ap;function le(e){var r=Object.prototype.toString.call(e);return r==="[object Function]"||r==="[object AsyncFunction]"||r==="[object GeneratorFunction]"||r==="[object AsyncGeneratorFunction]"}var bp=B(function(r,t){var n=qt(r,t);return qt(r,function(){return pt(xa,z(n,arguments[0]),Array.prototype.slice.call(arguments,1))})}),_a=bp;var kp=W(function(r){return _a(r.length,r)}),wa=kp;function ri(e){return function r(t){for(var n,o,i,a=[],f=0,s=t.length;f<s;){if(bn(t[f]))for(n=e?r(t[f]):t[f],i=0,o=n.length;i<o;)a[a.length]=n[i],i+=1;else a[a.length]=t[f];f+=1}return a}}function ti(e){return new RegExp(e.source,e.flags?e.flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":"")+(e.dotAll?"s":""))}function Sn(e,r,t){if(t||(t=new Op),Sp(e))return e;var n=function(i){var a=t.get(e);if(a)return a;t.set(e,i);for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(i[f]=r?Sn(e[f],!0,t):e[f]);return i};switch(ze(e)){case"Object":return n(Object.create(Object.getPrototypeOf(e)));case"Array":return n(Array(e.length));case"Date":return new Date(e.valueOf());case"RegExp":return ti(e);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return e.slice();default:return e}}function Sp(e){var r=typeof e;return e==null||r!="object"&&r!="function"}var Op=(function(){function e(){this.map={},this.length=0}return e.prototype.set=function(r,t){var n=this.hash(r),o=this.map[n];o||(this.map[n]=o=[]),o.push([r,t]),this.length+=1},e.prototype.hash=function(r){var t=[];for(var n in r)t.push(Object.prototype.toString.call(r[n]));return t.join()},e.prototype.get=function(r){if(this.length<=180){for(var t in this.map)for(var a=this.map[t],n=0;n<a.length;n+=1){var o=a[n];if(o[0]===r)return o[1]}return}var i=this.hash(r),a=this.map[i];if(a)for(var n=0;n<a.length;n+=1){var o=a[n];if(o[0]===r)return o[1]}},e})();var $p=W(function(r){return r!=null&&typeof r.clone=="function"?r.clone():Sn(r,!0)}),ar=$p;var Ep=W(function(r){return!r}),Aa=Ep;var Bp=wa(Aa),ei=Bp;function ni(e,r){return function(){return r.call(this,e.apply(this,arguments))}}function Ze(e,r){return function(){var t=arguments.length;if(t===0)return r();var n=arguments[t-1];return Cr(n)||typeof n[e]!="function"?r.apply(this,arguments):n[e].apply(n,Array.prototype.slice.call(arguments,0,t-1))}}var Ip=Hr(Ze("slice",function(r,t,n){return Array.prototype.slice.call(n,r,t)})),Dr=Ip;var Fp=W(Ze("tail",Dr(1,1/0))),Q=Fp;function oi(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return lt(arguments[0].length,ya(ni,arguments[0],Q(arguments)))}var jp=W(function(r){return bt(r)?r.split("").reverse().join(""):Array.prototype.slice.call(r,0).reverse()}),Ht=jp;function M(){if(arguments.length===0)throw new Error("compose requires at least one argument");return oi.apply(this,Ht(arguments))}function ii(e){return e}var Np=W(ii),ce=Np;var Pp=B(function(r,t){if(Cr(r)){if(Cr(t))return r.concat(t);throw new TypeError(ue(t)+" is not an array")}if(bt(r)){if(bt(t))return r+t;throw new TypeError(ue(t)+" is not a string")}if(r!=null&&le(r["fantasy-land/concat"]))return r["fantasy-land/concat"](t);if(r!=null&&le(r.concat))return r.concat(t);throw new TypeError(ue(r)+' does not have a method named "concat" or "fantasy-land/concat"')}),Ir=Pp;var Wp=(function(){function e(){this._nativeSet=typeof Set=="function"?new Set:null,this._items={}}return e.prototype.add=function(r){return!ba(r,!0,this)},e.prototype.has=function(r){return ba(r,!1,this)},e})();function ba(e,r,t){var n=typeof e,o,i;switch(n){case"string":case"number":return e===0&&1/e===-1/0?t._items["-0"]?!0:(r&&(t._items["-0"]=!0),!1):t._nativeSet!==null?r?(o=t._nativeSet.size,t._nativeSet.add(e),i=t._nativeSet.size,i===o):t._nativeSet.has(e):n in t._items?e in t._items[n]?!0:(r&&(t._items[n][e]=!0),!1):(r&&(t._items[n]={},t._items[n][e]=!0),!1);case"boolean":if(n in t._items){var a=e?1:0;return t._items[n][a]?!0:(r&&(t._items[n][a]=!0),!1)}else return r&&(t._items[n]=e?[!1,!0]:[!0,!1]),!1;case"function":return t._nativeSet!==null?r?(o=t._nativeSet.size,t._nativeSet.add(e),i=t._nativeSet.size,i===o):t._nativeSet.has(e):n in t._items?wt(e,t._items[n])?!0:(r&&t._items[n].push(e),!1):(r&&(t._items[n]=[e]),!1);case"undefined":return t._items[n]?!0:(r&&(t._items[n]=!0),!1);case"object":if(e===null)return t._items.null?!0:(r&&(t._items.null=!0),!1);default:return n=Object.prototype.toString.call(e),n in t._items?wt(e,t._items[n])?!0:(r&&t._items[n].push(e),!1):(r&&(t._items[n]=[e]),!1)}}var tt=Wp;var zp=B(function(r,t){for(var n=[],o=0,i=r.length,a=t.length,f=new tt,s=0;s<a;s+=1)f.add(t[s]);for(;o<i;)f.add(r[o])&&(n[n.length]=r[o]),o+=1;return n}),cr=zp;var Cp=W(function(e){return Xt(-1,e)}),Kt=Cp;var Lp=W(ri(!0)),fr=Lp;var Rp=B(wt),sr=Rp;var Mp=B(function(r,t){return typeof t.indexOf=="function"&&!Cr(t)?t.indexOf(r):Le(t,r,0)}),kt=Mp;var Dp=Dr(0,-1),dt=Dp;var Tp=(function(){function e(r,t){this.xf=t,this.f=r,this.set=new tt}return e.prototype["@@transducer/init"]=ct.init,e.prototype["@@transducer/result"]=ct.result,e.prototype["@@transducer/step"]=function(r,t){return this.set.add(this.f(t))?this.xf["@@transducer/step"](r,t):r},e})();function ai(e){return function(r){return new Tp(e,r)}}var Up=B(Vt([],ai,function(e,r){for(var t=new tt,n=[],o=0,i,a;o<r.length;)a=r[o],i=e(a),t.add(i)&&n.push(a),o+=1;return n})),ka=Up;var Zp=ka(ce),Sr=Zp;var qp=B(function(r,t){for(var n=new tt,o=0;o<r.length;o+=1)n.add(r[o]);return Sr(De(n.has.bind(n),t))}),Or=qp;function Vp(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),t=1,n=arguments.length;t<n;){var o=arguments[t];if(o!=null)for(var i in o)Yr(i,o)&&(r[i]=o[i]);t+=1}return r}var Sa=typeof Object.assign=="function"?Object.assign:Vp;var Jp=B(function(r,t){return qt(r+1,function(){var n=arguments[r];if(n!=null&&le(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,r));throw new TypeError(ue(n)+' does not have a method named "'+t+'"')})}),On=Jp;var Xp=B(function(r,t){return t instanceof r||t!=null&&(t.constructor===r||r.name==="Object"&&typeof t=="object")}),N=Xp;var Hp=On(1,"join"),er=Hp;function fi(e){return Object.prototype.toString.call(e)==="[object Number]"}var Kp=W(function(r){return r!=null&&fi(r.length)?r.length:NaN}),Oa=Kp;function si(e,r){for(var t=r,n=0;n<e.length;n+=1){if(t==null)return;var o=e[n];At(o)?t=Xt(o,t):t=t[o]}return t}var Gp=B(function(r,t){return Sa({},t,r)}),$n=Gp;var Qp=Hr(function(r,t,n){return r(t(n))}),En=Qp;var Yp=B(si),Kr=Yp;var rm=B(function(r,t){return Array.prototype.slice.call(t,0).sort(function(n,o){var i=r(n),a=r(o);return i<a?-1:i>a?1:0})}),Bn=rm;var tm=On(1,"split"),ui=tm;var em=B(function(r,t){return[Dr(0,r,t),Dr(r,Oa(t),t)]}),In=em;var nm=B(function(r,t){if(r<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var n=[],o=0;o<t.length;)n.push(Dr(o,o+=r,t));return n}),Fr=nm;var om=B(function(r,t){for(var n=0,o=t.length,i=[];n<o&&!r(t[n]);)i.push(t[n]),n+=1;return[i,Array.prototype.slice.call(t,n)]}),li=om;var im=B(function(r,t){for(var n=new tt,o=0;o<r.length;o+=1)n.add(r[o]);return _n(n.has.bind(n),t)}),Tr=im;var Gt=Zt(qe(),1);function am(e){let r=e.match(/([^=]+)=\((.*?)\);(.*)$/);if(r){let n=r[1],o=r[2].split(" "),i={};return r[3].split(";").filter(f=>f).forEach(f=>{let[s,u]=f.split("=");s&&u&&(i[s]=u.replace(/"/g,""))}),{name:n,components:o,params:i}}let t=e.match(/([^=]+)=:([^:]+):/);return t?{name:t[1],value:t[2]}:null}function fm(e){return e.replace(/-/g,"+").replace(/_/g,"/")}function ci(e){let r=e.signature.match(/^[^=]+=:([^:]+):/);if(!r)throw new Error("Invalid signature format");let t=r[1],n=Uint8Array.from(atob(t),a=>a.charCodeAt(0)),o=(0,Gt.hash)(n);return Ve(o)}function pi(e){let r=am(e["signature-input"]);if(!r||!r.components)throw new Error("Failed to parse signature-input");let t=[...r.components].sort(),n=[];t.forEach(u=>{let m=u.replace(/"/g,""),g=m,l;m.startsWith("@")?(g=m.substring(1),l=e[g]):l=e[m],l==null?l="":typeof l=="number"&&(l=l.toString()),n.push(`"${g}": ${l}`)});let o=t.join(" ");n.push(`"@signature-params": (${o});alg="hmac-sha256";keyid="ao"`);let i=n.join(`
`),a=new TextEncoder().encode(i),f=new TextEncoder().encode("ao"),s=(0,Gt.hmac)(f,a);return Ve(s)}function Ve(e){let r="";for(let n=0;n<e.length;n++)r+=String.fromCharCode(e[n]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function sm(e){let r=["method","target-uri","authority","scheme","request-target","path","query","query-param","status"],t={};for(let[g,l]of Object.entries(e))t[g.toLowerCase()]=l;let o=Object.keys(t).map(g=>r.includes(g.replace(/_/g,"-"))?"@"+g:g).sort(),i=[];for(let g of o){let l=g.replace("@",""),c=t[l],d=typeof c=="string"?c:String(c);i.push(`"${l}": ${d}`)}let a=o.map(g=>`"${g}"`).join(" ");i.push(`"@signature-params": (${a});alg="hmac-sha256";keyid="ao"`);let f=i.join(`
`),s=new TextEncoder().encode(f),u=new TextEncoder().encode("ao"),m=(0,Gt.hmac)(u,s);return Ve(m)}function jn(e){let r=Object.keys(e.commitments||{});if(r.length===0)return sm(e);if(r.length===1)return r[0];{let n=r.sort().join(", "),i=new TextEncoder().encode(n),a=(0,Gt.hash)(i);return Ve(a)}}function um(e){let r=e.split("/");if(r.length!==2)throw new Error("Invalid hashpath format. Expected 'base/request'");let[t,n]=r,o=Ea(t),i=Ea(n),a=new Uint8Array(o.length+i.length);a.set(o,0),a.set(i,o.length);let f=(0,Gt.hash)(a);return Ve(f)}function mi(e,r){let t=jn(r);if(!e)throw new Error("For first operation, provide the base message ID as currentHashpath");return e.includes("/")?`${um(e)}/${t}`:`${e}/${t}`}function Ea(e){let r=fm(e),t=atob(r),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n}var Na=Zt(ja(),1);function dm(e,r=null){if(!e)return null;try{let t=e;if(r){let i=e.indexOf(r);if(i===-1)return null;let a=e.substring(i+r.length).match(/,\s*[a-zA-Z0-9-]+=/),f=a?i+r.length+a.index:e.length;t=e.substring(i,f).trim()}let n={},o=t.split(/,(?=\s*[a-zA-Z0-9-]+=)/);for(let i of o){let a=i.trim(),f=a.match(/^([a-zA-Z0-9-]+)=\(([^)]*)\)(.*)$/);if(!f)continue;let s=f[1],u=f[2],m=f[3],g=[],l=/"[^"]+"|[^\s]+/g,c;for(;(c=l.exec(u))!==null;)g.push(c[0].replace(/"/g,""));let d={};if(m){let h=m.split(";").filter(x=>x.trim());for(let x of h){let[w,..._]=x.split("=");if(w&&_.length>0){let v=_.join("=").replace(/^"|"$/g,"");d[w.trim()]=v}}}n[s]={components:g,params:d,raw:a}}return r&&n[r]?n[r]:r?null:n}catch(t){return console.error("Error decoding signature-input:",t),null}}function xi(e,r){let t=e["signature-input"]||e["Signature-Input"];if(!t)return null;let n=dm(t,r);if(!n)return null;let o=r&&n.params?n.params.keyid:Object.values(n)[0]?.params?.keyid;if(!o)return null;try{return Na.default.toBuffer(o)}catch{return null}}function Pa(e,r=!1){if(e.startsWith("#erl_response{")){let n=e.match(/#erl_response\{raw=(.*?),formatted=(.*?)\}$/s);if(n&&n[1]&&n[2]){let o=n[1],i=n[2];if(r)return new Pn(i,!0).parse();{let a=hm(o);return new vi(i,a).parse()}}}return new Pn(e,r).parse()}function hm(e){let r=new Map;function t(o,i){let a=i+2;for(;a<o.length&&/\s/.test(o[a]);)a++;if(a<o.length&&o[a]==='"'){let f=a+1,s=!1;for(;f<o.length&&!(o[f]==='"'&&o[f+1]===">"&&o[f+2]===">");)if(o[f]==="\\"&&f+1<o.length){let u=o[f+1];if(/[0-7]/.test(u)){s=!0;break}f+=2}else f++;return s?"binary":"string"}return"binary"}function n(o,i,a){for(;i<o.length&&/\s/.test(o[i]);)i++;if(i>=o.length)return i;if(o[i]==="#"&&o[i+1]==="{"){i+=2;let f=0;for(;i<o.length;){for(;i<o.length&&/\s/.test(o[i]);)i++;if(o[i]==="}")return i+1;let s=i;if(o[i]==="<"&&o[i+1]==="<"){let u=t(o,i),m=i+2;if(u==="string"){for(m++;m<o.length&&!(o[m]==='"'&&o[m+1]===">"&&o[m+2]===">");)o[m]==="\\"&&m++,m++;m+=3}else{let g=1;for(;g>0&&m<o.length;)o[m]==="<"&&o[m+1]==="<"?(g++,m+=2):o[m]===">"&&o[m+1]===">"?(g--,m+=2):m++}i=m}else for(;i<o.length&&!/[\s=,}]/.test(o[i]);)i++;for(;i<o.length&&/\s/.test(o[i]);)i++;for(o[i]==="="&&o[i+1]===">"&&(i+=2);i<o.length&&/\s/.test(o[i]);)i++;if(o[i]==="<"&&o[i+1]==="<"){let u=t(o,i),m=[...a,f].join(".");r.set(m,u)}for(i=n(o,i,[...a,f]),f++;i<o.length&&/\s/.test(o[i]);)i++;o[i]===","&&i++}}else if(o[i]==="<"&&o[i+1]==="<"){let f=t(o,i),s=a.join(".");if(r.set(s,f),i+=2,f==="string"||o[i]==='"'){for(o[i]==='"'&&i++;i<o.length&&!(o[i]==='"'&&o[i+1]===">"&&o[i+2]===">");)o[i]==="\\"&&i++,i++;return i+3}else{let u=1;for(;u>0&&i<o.length;)o[i]==="<"&&o[i+1]==="<"?(u++,i+=2):o[i]===">"&&o[i+1]===">"?(u--,i+=2):i++;return i}}else if(o[i]==="["){i++;let f=0;for(;i<o.length;){for(;i<o.length&&/\s/.test(o[i]);)i++;if(o[i]==="]")return i+1;for(i=n(o,i,[...a,f]),f++;i<o.length&&/\s/.test(o[i]);)i++;o[i]===","&&i++}}else{for(;i<o.length&&!/[\s,\]}=>]/.test(o[i]);)i++;return i}return i}return n(e,0,[]),r}var vi=class{constructor(r,t){this.str=r,this.typeMap=t,this.pos=0,this.path=[]}parse(){let r=this.parseValue();if(this.skipWhitespace(),this.pos<this.str.length)throw new Error(`Unexpected content at position ${this.pos}`);return r}peek(r=0){return this.str[this.pos+r]||""}advance(r=1){this.pos+=r}skipWhitespace(){for(;this.pos<this.str.length&&/\s/.test(this.peek());)this.advance()}parseValue(){this.skipWhitespace();let r=this.peek(),t=this.peek(1);return r==="#"&&t==="{"?this.parseMap():r==="<"&&t==="<"?this.parseBinary():r==="["?this.parseList():r==="'"?this.parseQuotedAtom():r==='"'?this.parseQuotedString():this.parseAtomOrNumber()}parseMap(){this.advance(2);let r={},t=0;for(;;){if(this.skipWhitespace(),this.peek()==="}"){this.advance();break}this.path.push(t);let n=this.parseValue();if(this.path.pop(),this.skipWhitespace(),this.peek()!=="="||this.peek(1)!==">")throw new Error("Expected =>");this.advance(2),this.skipWhitespace(),this.path.push(t);let o=this.parseValue();this.path.pop();let i=n instanceof Buffer?n.toString("utf8"):typeof n=="symbol"&&Symbol.keyFor(n)||String(n);r[i]=o,t++,this.skipWhitespace(),this.peek()===","&&this.advance()}return r}parseBinary(){let r=this.path.join("."),t=this.typeMap.get(r)||"binary";if(this.advance(2),this.peek()===">"&&this.peek(1)===">")return this.advance(2),Buffer.alloc(0);let n=[];for(;!(this.peek()===">"&&this.peek(1)===">");){this.skipWhitespace();let i="";for(;/\d/.test(this.peek());)i+=this.peek(),this.advance();i&&n.push(parseInt(i,10)),this.skipWhitespace(),this.peek()===","&&this.advance()}this.advance(2);let o=Buffer.from(n);if(t==="string")return o.toString("utf8");try{let i=o.toString("utf8");if(Buffer.from(i,"utf8").equals(o)){let a=!0;for(let f=0;f<i.length;f++){let s=i.charCodeAt(f);if(s<32&&s!==9&&s!==10&&s!==13){a=!1;break}}if(a)return i}}catch{}return o}parseQuotedString(){this.advance();let r="";for(;this.peek()!=='"';)if(this.peek()==="\\"){this.advance();let t=this.peek();switch(t){case'"':r+='"';break;case"\\":r+="\\";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;default:r+=t}this.advance()}else r+=this.peek(),this.advance();return this.advance(),r}parseList(){this.advance();let r=[],t=0;for(;;){if(this.skipWhitespace(),this.peek()==="]"){this.advance();break}this.path.push(t),r.push(this.parseValue()),this.path.pop(),t++,this.skipWhitespace(),this.peek()===","&&this.advance()}return r}parseQuotedAtom(){this.advance();let r="";for(;this.peek()!=="'";)if(this.peek()==="\\"){this.advance();let t=this.peek();switch(t){case"'":r+="'";break;case"\\":r+="\\";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;default:r+=t}this.advance()}else r+=this.peek(),this.advance();return this.advance(),r==="null"?null:r==="true"?!0:r==="false"?!1:Symbol.for(r)}parseAtomOrNumber(){let r="";for(;this.pos<this.str.length;){let t=this.peek();if(t===","||t==="]"||t==="}"||t===")"||t==="="&&this.peek(1)===">")break;if(/\s/.test(t)){let n=this.pos;for(;n<this.str.length&&/\s/.test(this.str[n]);)n++;if(n>=this.str.length)break;let o=this.str[n];if(o===","||o==="]"||o==="}"||o===")"||o==="="&&n+1<this.str.length&&this.str[n+1]===">")break}r+=t,this.advance()}return r=r.trim(),r==="null"?null:r==="true"?!0:r==="false"?!1:/^-?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(r)?parseFloat(r):Symbol.for(r)}},Pn=class{constructor(r,t=!1){this.str=r,this.pos=0,this.binaryMode=t}parse(){let r=this.parseValue();if(this.skipWhitespace(),this.pos<this.str.length)throw new Error(`Unexpected content at position ${this.pos}: ${this.str.slice(this.pos,this.pos+50)}`);return r}peek(r=0){return this.str[this.pos+r]||""}advance(r=1){this.pos+=r}skipWhitespace(){for(;this.pos<this.str.length&&/\s/.test(this.peek());)this.advance()}parseValue(){this.skipWhitespace();let r=this.peek(),t=this.peek(1);return r==="#"&&t==="{"?this.parseMap():r==="<"&&t==="<"?this.parseBinary():r==="["?this.parseList():r==="'"?this.parseQuotedAtom():r==='"'?this.parseQuotedString():this.parseAtomOrNumber()}parseMap(){this.advance(2);let r={};for(;;){if(this.skipWhitespace(),this.peek()==="}"){this.advance();break}let t=this.parseValue();if(this.skipWhitespace(),this.peek()!=="="||this.peek(1)!==">")throw new Error(`Expected => at position ${this.pos}`);this.advance(2),this.skipWhitespace();let n=this.parseValue(),o;t instanceof Buffer?o=t.toString("utf8"):typeof t=="symbol"?o=Symbol.keyFor(t)||t.description||String(t):o=String(t),r[o]=n,this.skipWhitespace(),this.peek()===","&&this.advance()}return r}parseBinary(){if(this.advance(2),this.peek()==='"'){this.advance();let t="";for(;!(this.peek()==='"'&&this.peek(1)===">"&&this.peek(2)===">");){if(this.pos>=this.str.length)throw new Error("Unterminated string binary");if(this.peek()==="\\"){this.advance();let n=this.peek();if(/[0-7]/.test(n)){let o=n;this.advance(),/[0-7]/.test(this.peek())&&(o+=this.peek(),this.advance(),/[0-7]/.test(this.peek())&&(o+=this.peek(),this.advance()));let i=parseInt(o,8);t+=String.fromCharCode(i)}else{switch(n){case'"':t+='"';break;case"\\":t+="\\";break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;default:t+=n}this.advance()}}else t+=this.peek(),this.advance()}if(this.advance(3),t.startsWith(":")&&t.endsWith(":")&&t.length>=2){if(t==="::")return Buffer.alloc(0);try{let n=t.slice(1,-1);return Buffer.from(n,"base64")}catch{}}if(this.binaryMode)return Buffer.from(t,"utf8");{let n=Buffer.from(t,"utf8");return Array.from(n).every(i=>i>=32&&i<=126)?t:n}}if(this.peek()===">"&&this.peek(1)===">")return this.advance(2),Buffer.alloc(0);let r=[];for(;!(this.peek()===">"&&this.peek(1)===">");){if(this.pos>=this.str.length)throw new Error("Unterminated byte binary");this.skipWhitespace();let t="";for(;/\d/.test(this.peek());)t+=this.peek(),this.advance();t&&r.push(parseInt(t,10)),this.skipWhitespace(),this.peek()===","&&this.advance()}return this.advance(2),Buffer.from(r)}parseQuotedString(){this.advance();let r="";for(;this.peek()!=='"';)if(this.peek()==="\\"){this.advance();let t=this.peek();switch(t){case'"':r+='"';break;case"\\":r+="\\";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;default:r+=t}this.advance()}else r+=this.peek(),this.advance();return this.advance(),r}parseList(){this.advance();let r=[];for(;;){if(this.skipWhitespace(),this.peek()==="]"){this.advance();break}r.push(this.parseValue()),this.skipWhitespace(),this.peek()===","&&this.advance()}return r}parseQuotedAtom(){this.advance();let r="";for(;this.peek()!=="'";){if(this.pos>=this.str.length)throw new Error("Unterminated quoted atom");if(this.peek()==="\\"){this.advance();let t=this.peek();switch(t){case"'":r+="'";break;case"\\":r+="\\";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;default:r+=t}this.advance()}else r+=this.peek(),this.advance()}return this.advance(),r==="null"?null:r==="true"?!0:r==="false"?!1:Symbol.for(r)}parseAtomOrNumber(){let r=this.pos,t="";for(;this.pos<this.str.length;){let n=this.peek(),o=this.peek(1);if(n===","||n==="]"||n==="}"||n===")"||n==="="&&o===">")break;if(n==="\\"){t+=n,this.advance(),this.pos<this.str.length&&(t+=this.peek(),this.advance());continue}if(/\s/.test(n)){let i=this.pos;for(;i<this.str.length&&/\s/.test(this.str[i]);)i++;if(i>=this.str.length)break;let a=this.str[i];if(a===","||a==="]"||a==="}"||a===")"||a==="="&&i+1<this.str.length&&this.str[i+1]===">")break}if(t+=n,this.advance(),this.pos-r>1e3)throw new Error(`Atom too long at position ${r}`)}if(t=t.trimEnd(),!t)throw new Error(`Empty atom at position ${this.pos}`);return t==="null"?null:t==="true"?!0:t==="false"?!1:/^-?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(t)?parseFloat(t):Symbol.for(t)}};function _i(e){return typeof e=="string"?Pa(e,!1):za(e)}function za(e){if(typeof e=="string"||e instanceof Buffer||e instanceof Uint8Array||typeof e!="object"||e===null||Array.isArray(e))return e;let r=e["ao-types"]||"",t=ym(r),n={};for(let[o,i]of Object.entries(t))i==="empty-binary"?n[o]="":i==="empty-list"?n[o]=[]:i==="empty-message"&&(n[o]={});for(let[o,i]of Object.entries(e)){if(o==="ao-types")continue;let a=o.toLowerCase();if(typeof i=="string"||i instanceof Buffer||i instanceof Uint8Array){let f=t[a];f?n[o]=Ca(f,i):n[o]=i}else if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let f=za(i);t[a]==="list"?n[o]=xm(f):n[o]=f}else n[o]=i}return n}function ym(e){if(!e)return{};let r={},t=e.split(", ");for(let n of t){let o=n.match(/^(.+?)="(.+?)"$/);if(o){let[,i,a]=o,f=gm(i);r[f.toLowerCase()]=a}}return r}function gm(e){return e.replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function xm(e){return Object.keys(e).filter(t=>/^\d+$/.test(t)).map(t=>parseInt(t,10)).sort((t,n)=>t-n).map(t=>e[t.toString()])}function Ca(e,r){switch(e.toLowerCase()){case"integer":return parseInt(Wa(r),10);case"float":return parseFloat(r);case"atom":return Wa(r).replace(/^"|"$/g,"");case"list":return vm(r).map(n=>{if(typeof n=="string"&&n.startsWith("(ao-type-")){let o=n.match(/^\(ao-type-(.+?)\) (.+)$/);if(o){let[,i,a]=o;return Ca(i,a)}}return n});case"binary":return r;default:return r}}function Wa(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function vm(e){return e.split(", ").map(r=>r.startsWith('"')&&r.endsWith('"')?r.slice(1,-1):r)}var Am=Zt(qe(),1);function wi(e){if(typeof e=="string"||e instanceof Buffer)return wm(e).ok;if(typeof e!="object"||e===null)throw new Error("Input must be an object or string");let r={};for(let[t,n]of Object.entries(e)){let o=_m(t);La(o,n,r)}return r}function _m(e){if(Array.isArray(e))return e.length===1&&Array.isArray(e[0])?e[0]:e;if(typeof e=="string")return e.split("/");throw new Error("Path must be a string or array")}function La(e,r,t){if(e.length===0)throw new Error("Path cannot be empty");if(e.length===1){let i=e[0];if(i in t){let a=t[i];if(typeof a=="object"&&a!==null&&typeof r=="object"&&r!==null&&!Array.isArray(a)&&!Array.isArray(r))t[i]={...a,...r};else throw new Error(`Path collision at key: ${i}, existing: ${JSON.stringify(a)}, value: ${JSON.stringify(r)}`)}else t[i]=r;return}let[n,...o]=e;if(!(n in t))t[n]={};else if(typeof t[n]!="object"||t[n]===null)throw new Error(`Cannot create nested path at non-object key: ${n}`);La(o,r,t[n])}function wm(e){try{let t=e.toString().split(`
`).filter(o=>o.trim()),n={};for(let o of t){let i=o.indexOf(": ");if(i!==-1){let a=o.substring(0,i),f=o.substring(i+2);n[a]=f}}return{ok:wi(n)}}catch(r){return{error:r.message}}}var Ra=`\r
`,Ma=Ra+Ra;function bm(e){let r={};if(!e)return r;let t=e.split(/,\s*/);for(let n of t){let o=n.match(/^([^=]+)=(.+)$/);if(o){let i=o[1].trim(),a=o[2].trim();a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),r[i]=a}}return r}function km(e){let r=e["inline-body-key"];return r?[{},r]:"body"in e?[{},"body"]:"data"in e?[{"inline-body-key":"data"},"data"]:[{},"body"]}function Sm(e){if(!e["ao-ids"])return e;let r={...e};delete r["ao-ids"];let t=bm(e["ao-ids"]);for(let[n,o]of Object.entries(t))r[n]=o;return r}function Wn(e){let r=Math.min(e.length,512);for(let o=0;o<r;o++)if(e[o]===0)return!0;let t=0,n=0;for(let o=0;o<r;o++){let i=e[o];i<32&&i!==9&&i!==10&&i!==13&&t++,i>127&&n++}return t/r>.05||n/r>.2}function Om(e,r){let t=e.match(/boundary="?([^";\s]+)"?/);if(!t)return{};let n=t[1],o=`--${n}`,i=`--${n}--`,a=typeof r=="string"?r:r.toString("binary");a.endsWith(i)&&(a=a.substring(0,a.lastIndexOf(i)));let f=a.split(new RegExp(`\\r?\\n?${o}\\r?\\n`)).filter(m=>m&&m.trim()&&!m.startsWith("--")),s={},u=[];for(let m of f){let g=m.indexOf(Ma),l,c;g!==-1?(l=m.substring(0,g),c=m.substring(g+Ma.length),c=c.replace(/\r?\n?$/,"")):(l=m,c="");let d={},h=0;for(;h<l.length;){let _=l.indexOf(": ",h);if(_===-1)break;let v=h,k=_-1;for(;k>=h;){if(l[k]===`
`){v=k+1;break}k--}let S=l.substring(v,_).trim().toLowerCase();if(!/^[a-zA-Z0-9-]+$/.test(S)||S.length>50){h=_+2;continue}let E=_+2,P=l.length,$=E;for(;$<l.length;){let L=l.indexOf(`
`,$);if(L===-1)break;let F=L+1;if(F>=l.length)break;let R=l.indexOf(": ",F);if(R>F&&R<F+50){let X=l.substring(F,R).trim();if(/^[a-zA-Z0-9-]+$/.test(X)){P=L;break}}$=L+1}let O=l.substring(E,P);O.length>0&&Wn(Buffer.from(O,"binary"))?(P<l.length&&l[P]===`
`&&O.endsWith("\r")&&(O=O.substring(0,O.length-1)),d[S]=Buffer.from(O,"binary")):(O=O.replace(/[\r\n]+$/,""),d[S]=O),h=P,h<l.length&&l[h]===`
`&&h++,h<l.length&&l[h]==="\r"&&h++}let x=d["content-disposition"];if(!x)continue;let w;if(x==="inline"){w="body",u.push("body");let _={...d};delete _["content-disposition"];for(let[v,k]of Object.entries(_))s[v]=k;c&&(s[w]=Wn(Buffer.from(c,"binary"))?Buffer.from(c,"binary"):c)}else{let _=x.match(/name="([^"]+)"/);if(w=_?_[1]:null,w){let k=w.split("/")[0];u.push(k)}if(!w)continue;let v={...d};delete v["content-disposition"],Object.keys(v).length===0?s[w]=Wn(Buffer.from(c,"binary"))?Buffer.from(c,"binary"):c:c?s[w]={...v,body:Wn(Buffer.from(c,"binary"))?Buffer.from(c,"binary"):c}:s[w]=v}}return u.length>0&&(s["body-keys"]=u.map(m=>`"${m}"`).join(", ")),s}function Ai(e){if(typeof e=="string")return e;let r=e.body||"",[t,n]=km(e),o={...e};delete o.body,delete o["body-keys"];let i=o["content-type"],a=o;if(r&&i&&i.includes("multipart")){let u=Om(i,r);if(e["body-keys"]){let l=e["body-keys"];typeof l=="string"&&(l.includes('"')?u["body-keys"]=l:u["body-keys"]=l.split(/,\s*/).map(c=>`"${c.trim()}"`).join(", "))}a={...o,...u};let m={},g={};for(let[l,c]of Object.entries(a))l.includes("/")?m[l]=c:g[l]=c;if(Object.keys(m).length>0){let l={...g,...m};a=wi(l)}}else r&&(a[n]=r);let s={...Sm(a)};delete s.signature,delete s["signature-input"],delete s.commitments,delete s["content-digest"];for(let u of Object.keys(s))u.startsWith("hashpath")&&delete s[u];return s}var or=(e,r=!1,t=null)=>(t=r&&t?t:{__monad__:!0},t.map=n=>or(n(e),!0,t),t.tap=n=>(n(e),or(e,!0,t)),t.chain=n=>{if(n.__ka__)throw new Error("Cannot chain arrow directly. Use arrow.fn() to convert to function");let o=n(e);if(!o?.__monad__)throw new Error("fn must return monad");return o},t.to=n=>n(e),t.val=()=>e,t),Je=(e,r=!1,t=null)=>{let n=Promise.resolve(e);return t=r&&t?t:{__monad__:!0},t.map=o=>Je(n.then(i=>o(i)),!0,t),t.tap=o=>Je(n.then(i=>(o(i),i)),!0,t),t.chain=o=>Je(n.then(async i=>{if(o.__ka__)throw new Error("Cannot chain arrow directly. Use arrow.fn() to convert to function");let a=await o(i);if(!a?.__monad__)throw new Error("fn must return monad");return a.val()}),!0,t),t.to=o=>n.then(i=>o(i)),t.val=()=>n,t},$m=(e,r)=>{e.__ka__=!0,e.map=t=>{let n=o=>t(o);return r.push(n),e},e.tap=t=>{let n=o=>(t(o),o);return r.push(n),e},e.chain=t=>{let n=o=>{let a=(t.__ka__?t.fn():t)(o);if(!a?.__monad__)throw new Error("fn must return monad");return a.val()};return r.push(n),e},e.fn=()=>t=>{for(let n of r)t=n(t);return or(t)}},Y=()=>{let e=[],r=t=>{for(let n of e)t=n(t);return or(t)};return $m(r,e),r};var Qt=(e={},r={})=>t=>{let n={__device__:!0},o=t;n.map=i=>Qt(e,r)(i(o)),n.tap=i=>(i(o),Qt(e,r)(o)),n.chain=i=>{if(i.__ka__)throw new Error("Cannot chain arrow directly. Use arrow.fn() to convert to function");let a=i(o);if(!a?.__monad__)throw new Error("fn must return monad");return Qt(e,r)(a.val())},n.to=i=>i(o),n.val=()=>o,n.monad=()=>or(o);for(let[i,a]of Object.entries(e))n[i]=(...f)=>Qt(e,r)(a(o,...f));for(let[i,a]of Object.entries(r))n[i]=(...f)=>a(o,...f);return n},Yt=(e={},r={})=>t=>{let n={__device__:!0,__async__:!0},o=Promise.resolve(t);n.map=i=>Yt(e,r)(o.then(a=>i(a))),n.tap=i=>Yt(e,r)(o.then(a=>(i(a),a))),n.chain=i=>{if(i.__ka__)throw new Error("Cannot chain arrow directly. Use arrow.fn() to convert to function");return Yt(e,r)(o.then(async a=>{let f=await i(a);if(!f?.__monad__)throw new Error("fn must return monad");return f.val()}))},n.to=i=>o.then(a=>i(a)),n.val=()=>o,n.monad=()=>Je(o);for(let[i,a]of Object.entries(e))n[i]=(...f)=>Yt(e,r)(o.then(async s=>await a(s,...f)));for(let[i,a]of Object.entries(r))n[i]=(...f)=>o.then(async s=>await a(s,...f));return n};var mc=Zt(qe(),1);var lc=Zt(ji(),1),cc=Zt(qe(),1);var pn={};Dc(pn,{F:()=>ef,T:()=>nf,__:()=>He,add:()=>Et,addIndex:()=>of,adjust:()=>Ln,all:()=>Rn,allPass:()=>df,always:()=>ot,and:()=>Tn,andThen:()=>pl,any:()=>yf,anyPass:()=>gf,ap:()=>me,aperture:()=>vf,append:()=>_f,apply:()=>de,applySpec:()=>Af,applyTo:()=>bf,ascend:()=>kf,assoc:()=>ye,assocPath:()=>he,binary:()=>Sf,bind:()=>Mn,both:()=>Of,call:()=>$f,chain:()=>qn,clamp:()=>If,clone:()=>Ff,collectBy:()=>jf,comparator:()=>Nf,complement:()=>Pf,compose:()=>oe,composeWith:()=>Wf,concat:()=>we,cond:()=>Rf,construct:()=>Mf,constructN:()=>Kn,converge:()=>Gn,count:()=>Df,countBy:()=>Uf,curry:()=>at,curryN:()=>D,dec:()=>Zf,defaultTo:()=>Ae,descend:()=>qf,difference:()=>an,differenceWith:()=>fn,dissoc:()=>Jf,dissocPath:()=>Yn,divide:()=>Xf,drop:()=>ro,dropLast:()=>Qf,dropLastWhile:()=>rs,dropRepeats:()=>ts,dropRepeatsWith:()=>eo,dropWhile:()=>ns,either:()=>os,empty:()=>oo,endsWith:()=>is,eqBy:()=>as,eqProps:()=>fs,equals:()=>lr,evolve:()=>ss,filter:()=>ve,find:()=>ls,findIndex:()=>ps,findLast:()=>ds,findLastIndex:()=>ys,flatten:()=>gs,flip:()=>Wt,forEach:()=>xs,forEachObjIndexed:()=>vs,fromPairs:()=>_s,groupBy:()=>ws,groupWith:()=>As,gt:()=>ao,gte:()=>bs,has:()=>ks,hasIn:()=>Ss,hasPath:()=>fo,head:()=>Jn,identical:()=>Os,identity:()=>jt,ifElse:()=>so,inc:()=>$s,includes:()=>uo,indexBy:()=>Es,indexOf:()=>Bs,init:()=>lo,innerJoin:()=>Is,insert:()=>Fs,insertAll:()=>js,intersection:()=>Ps,intersperse:()=>Ws,into:()=>zs,invert:()=>Cs,invertObj:()=>Ls,invoker:()=>ft,is:()=>$r,isEmpty:()=>Rs,isNil:()=>qr,join:()=>Ms,juxt:()=>mo,keys:()=>pr,keysIn:()=>Ds,last:()=>Se,lastIndexOf:()=>Ts,length:()=>Ee,lens:()=>Ct,lensIndex:()=>Us,lensPath:()=>Zs,lensProp:()=>qs,lift:()=>It,liftN:()=>Zn,lt:()=>Vs,lte:()=>Js,map:()=>ur,mapAccum:()=>Xs,mapAccumRight:()=>Hs,mapObjIndexed:()=>Ks,match:()=>Gs,mathMod:()=>Qs,max:()=>Ur,maxBy:()=>Ys,mean:()=>xo,median:()=>ru,memoizeWith:()=>tu,mergeAll:()=>eu,mergeDeepLeft:()=>nu,mergeDeepRight:()=>vo,mergeDeepWith:()=>ou,mergeDeepWithKey:()=>Lt,mergeLeft:()=>iu,mergeRight:()=>au,mergeWith:()=>fu,mergeWithKey:()=>Be,min:()=>su,minBy:()=>uu,modify:()=>lu,modifyPath:()=>_o,modulo:()=>cu,move:()=>pu,multiply:()=>wo,nAry:()=>Bt,negate:()=>du,none:()=>hu,not:()=>Vn,nth:()=>Pr,nthArg:()=>yu,o:()=>Ao,objOf:()=>po,of:()=>gu,omit:()=>xu,on:()=>vu,once:()=>_u,or:()=>no,otherwise:()=>wu,over:()=>bo,pair:()=>bu,partial:()=>ku,partialObject:()=>mu,partialRight:()=>Su,partition:()=>Ou,path:()=>Er,pathEq:()=>$u,pathOr:()=>Eu,pathSatisfies:()=>Bu,paths:()=>yo,pick:()=>Iu,pickAll:()=>ko,pickBy:()=>Fu,pipe:()=>Ye,pipeWith:()=>Xn,pluck:()=>nt,prepend:()=>So,product:()=>ju,project:()=>Nu,promap:()=>Wu,prop:()=>Wr,propEq:()=>zu,propIs:()=>Cu,propOr:()=>Lu,propSatisfies:()=>Ru,props:()=>Mu,range:()=>Du,reduce:()=>wr,reduceBy:()=>Pt,reduceRight:()=>$o,reduceWhile:()=>Tu,reduced:()=>Uu,reject:()=>Nt,remove:()=>Qn,repeat:()=>Zu,replace:()=>qu,reverse:()=>ge,scan:()=>Vu,sequence:()=>Bo,set:()=>Ju,slice:()=>hr,sort:()=>Xu,sortBy:()=>Hu,sortWith:()=>Ku,split:()=>Gu,splitAt:()=>Qu,splitEvery:()=>Yu,splitWhen:()=>rl,splitWhenever:()=>tl,startsWith:()=>el,subtract:()=>nl,sum:()=>go,symmetricDifference:()=>ol,symmetricDifferenceWith:()=>il,tail:()=>zr,take:()=>ke,takeLast:()=>io,takeLastWhile:()=>al,takeWhile:()=>sl,tap:()=>ll,test:()=>cl,thunkify:()=>Zl,times:()=>Eo,toLower:()=>ml,toPairs:()=>dl,toPairsIn:()=>hl,toString:()=>it,toUpper:()=>yl,transduce:()=>gl,transpose:()=>xl,traverse:()=>vl,trim:()=>_l,tryCatch:()=>wl,type:()=>ne,unapply:()=>Al,unary:()=>bl,uncurryN:()=>kl,unfold:()=>Sl,union:()=>Ol,unionWith:()=>El,uniq:()=>Oe,uniqBy:()=>co,uniqWith:()=>Io,unless:()=>Bl,unnest:()=>Il,until:()=>Fl,unwind:()=>jl,update:()=>ho,useWith:()=>Oo,values:()=>Un,valuesIn:()=>Nl,view:()=>Pl,when:()=>Wl,where:()=>Fo,whereAny:()=>zl,whereEq:()=>Cl,without:()=>Ll,xor:()=>Rl,xprod:()=>Ml,zip:()=>Dl,zipObj:()=>Tl,zipWith:()=>Ul});var Cm=function(){return!1},ef=Cm;var Lm=function(){return!0},nf=Lm;var He={"@@functional/placeholder":!0};function rr(e){return e!=null&&typeof e=="object"&&e["@@functional/placeholder"]===!0}function A(e){return function r(t){return arguments.length===0||rr(t)?r:e.apply(this,arguments)}}function p(e){return function r(t,n){switch(arguments.length){case 0:return r;case 1:return rr(t)?r:A(function(o){return e(t,o)});default:return rr(t)&&rr(n)?r:rr(t)?A(function(o){return e(o,n)}):rr(n)?A(function(o){return e(t,o)}):e(t,n)}}}var Rm=p(function(r,t){return Number(r)+Number(t)}),Et=Rm;function dr(e,r){e=e||[],r=r||[];var t,n=e.length,o=r.length,i=[];for(t=0;t<n;)i[i.length]=e[t],t+=1;for(t=0;t<o;)i[i.length]=r[t],t+=1;return i}function gr(e,r){switch(e){case 0:return function(){return r.apply(this,arguments)};case 1:return function(t){return r.apply(this,arguments)};case 2:return function(t,n){return r.apply(this,arguments)};case 3:return function(t,n,o){return r.apply(this,arguments)};case 4:return function(t,n,o,i){return r.apply(this,arguments)};case 5:return function(t,n,o,i,a){return r.apply(this,arguments)};case 6:return function(t,n,o,i,a,f){return r.apply(this,arguments)};case 7:return function(t,n,o,i,a,f,s){return r.apply(this,arguments)};case 8:return function(t,n,o,i,a,f,s,u){return r.apply(this,arguments)};case 9:return function(t,n,o,i,a,f,s,u,m){return r.apply(this,arguments)};case 10:return function(t,n,o,i,a,f,s,u,m,g){return r.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function Nr(e,r,t){return function(){for(var n=[],o=0,i=e,a=0;a<r.length||o<arguments.length;){var f;a<r.length&&(!rr(r[a])||o>=arguments.length)?f=r[a]:(f=arguments[o],o+=1),n[a]=f,rr(f)||(i-=1),a+=1}return i<=0?t.apply(this,n):gr(i,Nr(e,n,t))}}var Mm=p(function(r,t){return r===1?A(t):gr(r,Nr(r,[],t))}),D=Mm;var Dm=A(function(r){return D(r.length,function(){var t=0,n=arguments[0],o=arguments[arguments.length-1],i=Array.prototype.slice.call(arguments,0);return i[0]=function(){var a=n.apply(this,dr(arguments,[t,o]));return t+=1,a},r.apply(this,i)})}),of=Dm;function b(e){return function r(t,n,o){switch(arguments.length){case 0:return r;case 1:return rr(t)?r:p(function(i,a){return e(t,i,a)});case 2:return rr(t)&&rr(n)?r:rr(t)?p(function(i,a){return e(i,n,a)}):rr(n)?p(function(i,a){return e(t,i,a)}):A(function(i){return e(t,n,i)});default:return rr(t)&&rr(n)&&rr(o)?r:rr(t)&&rr(n)?p(function(i,a){return e(i,a,o)}):rr(t)&&rr(o)?p(function(i,a){return e(i,n,a)}):rr(n)&&rr(o)?p(function(i,a){return e(t,i,a)}):rr(t)?A(function(i){return e(i,n,o)}):rr(n)?A(function(i){return e(t,i,o)}):rr(o)?A(function(i){return e(t,n,i)}):e(t,n,o)}}}var Tm=b(function(r,t,n){var o=n.length;if(r>=o||r<-o)return n;var i=(o+r)%o,a=dr(n);return a[i]=t(n[i]),a}),Ln=Tm;var H=Array.isArray||function(r){return r!=null&&r.length>=0&&Object.prototype.toString.call(r)==="[object Array]"};function te(e){return e!=null&&typeof e["@@transducer/step"]=="function"}function j(e,r,t){return function(){if(arguments.length===0)return t();var n=arguments[arguments.length-1];if(!H(n)){for(var o=0;o<e.length;){if(typeof n[e[o]]=="function")return n[e[o]].apply(n,Array.prototype.slice.call(arguments,0,-1));o+=1}if(te(n)){var i=r.apply(null,Array.prototype.slice.call(arguments,0,-1));return i(n)}}return t.apply(this,arguments)}}function vr(e){return e&&e["@@transducer/reduced"]?e:{"@@transducer/value":e,"@@transducer/reduced":!0}}var I={init:function(){return this.xf["@@transducer/init"]()},result:function(e){return this.xf["@@transducer/result"](e)}};var Um=(function(){function e(r,t){this.xf=t,this.f=r,this.all=!0}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.all&&(r=this.xf["@@transducer/step"](r,!0)),this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.f(t)||(this.all=!1,r=vr(this.xf["@@transducer/step"](r,!1))),r},e})(),Zm=p(function(r,t){return new Um(r,t)}),af=Zm;var qm=p(j(["all"],af,function(r,t){for(var n=0;n<t.length;){if(!r(t[n]))return!1;n+=1}return!0})),Rn=qm;var Vm=p(function(r,t){return t>r?t:r}),Ur=Vm;function Rr(e,r){for(var t=0,n=r.length,o=Array(n);t<n;)o[t]=e(r[t]),t+=1;return o}function Zr(e){return Object.prototype.toString.call(e)==="[object String]"}var Jm=A(function(r){return H(r)?!0:!r||typeof r!="object"||Zr(r)?!1:r.length===0?!0:r.length>0?r.hasOwnProperty(0)&&r.hasOwnProperty(r.length-1):!1}),yt=Jm;var Xm=(function(){function e(r){this.f=r}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(r){return r},e.prototype["@@transducer/step"]=function(r,t){return this.f(r,t)},e})();function Ke(e){return new Xm(e)}var Hm=p(function(r,t){return gr(r.length,function(){return r.apply(t,arguments)})}),Mn=Hm;function Km(e,r,t){for(var n=0,o=t.length;n<o;){if(r=e["@@transducer/step"](r,t[n]),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}n+=1}return e["@@transducer/result"](r)}function ff(e,r,t){for(var n=t.next();!n.done;){if(r=e["@@transducer/step"](r,n.value),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}n=t.next()}return e["@@transducer/result"](r)}function sf(e,r,t,n){return e["@@transducer/result"](t[n](Mn(e["@@transducer/step"],e),r))}var uf=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function Z(e,r,t){if(typeof e=="function"&&(e=Ke(e)),yt(t))return Km(e,r,t);if(typeof t["fantasy-land/reduce"]=="function")return sf(e,r,t,"fantasy-land/reduce");if(t[uf]!=null)return ff(e,r,t[uf]());if(typeof t.next=="function")return ff(e,r,t);if(typeof t.reduce=="function")return sf(e,r,t,"reduce");throw new TypeError("reduce: list must be array or iterable")}var Gm=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.xf["@@transducer/step"](r,this.f(t))},e})(),Qm=p(function(r,t){return new Gm(r,t)}),lf=Qm;function T(e,r){return Object.prototype.hasOwnProperty.call(r,e)}var cf=Object.prototype.toString,Ym=(function(){return cf.call(arguments)==="[object Arguments]"?function(r){return cf.call(r)==="[object Arguments]"}:function(r){return T("callee",r)}})(),Dn=Ym;var rd=!{toString:null}.propertyIsEnumerable("toString"),pf=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],mf=(function(){"use strict";return arguments.propertyIsEnumerable("length")})(),td=function(r,t){for(var n=0;n<r.length;){if(r[n]===t)return!0;n+=1}return!1},ed=typeof Object.keys=="function"&&!mf?A(function(r){return Object(r)!==r?[]:Object.keys(r)}):A(function(r){if(Object(r)!==r)return[];var t,n,o=[],i=mf&&Dn(r);for(t in r)T(t,r)&&(!i||t!=="length")&&(o[o.length]=t);if(rd)for(n=pf.length-1;n>=0;)t=pf[n],T(t,r)&&!td(o,t)&&(o[o.length]=t),n-=1;return o}),pr=ed;var nd=p(j(["fantasy-land/map","map"],lf,function(r,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return D(t.length,function(){return r.call(this,t.apply(this,arguments))});case"[object Object]":return Z(function(n,o){return n[o]=r(t[o]),n},{},pr(t));default:return Rr(r,t)}})),ur=nd;var br=Number.isInteger||function(r){return r<<0===r};var od=p(function(r,t){var n=r<0?t.length+r:r;return Zr(t)?t.charAt(n):t[n]}),Pr=od;var id=p(function(r,t){if(t!=null)return br(r)?Pr(r,t):t[r]}),Wr=id;var ad=p(function(r,t){return ur(Wr(r),t)}),nt=ad;var fd=b(Z),wr=fd;var sd=A(function(r){return D(wr(Ur,0,nt("length",r)),function(){for(var t=0,n=r.length;t<n;){if(!r[t].apply(this,arguments))return!1;t+=1}return!0})}),df=sd;var ud=A(function(r){return function(){return r}}),ot=ud;var ld=p(function(r,t){return r&&t}),Tn=ld;var cd=(function(){function e(r,t){this.xf=t,this.f=r,this.any=!1}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.any||(r=this.xf["@@transducer/step"](r,!1)),this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.f(t)&&(this.any=!0,r=vr(this.xf["@@transducer/step"](r,!0))),r},e})(),pd=p(function(r,t){return new cd(r,t)}),hf=pd;var md=p(j(["any"],hf,function(r,t){for(var n=0;n<t.length;){if(r(t[n]))return!0;n+=1}return!1})),yf=md;var dd=A(function(r){return D(wr(Ur,0,nt("length",r)),function(){for(var t=0,n=r.length;t<n;){if(r[t].apply(this,arguments))return!0;t+=1}return!1})}),gf=dd;var hd=p(function(r,t){return typeof t["fantasy-land/ap"]=="function"?t["fantasy-land/ap"](r):typeof r.ap=="function"?r.ap(t):typeof r=="function"?function(n){return r(n)(t(n))}:Z(function(n,o){return dr(n,ur(o,t))},[],r)}),me=hd;function Ni(e,r){for(var t=0,n=r.length-(e-1),o=new Array(n>=0?n:0);t<n;)o[t]=Array.prototype.slice.call(r,t,t+e),t+=1;return o}var yd=(function(){function e(r,t){this.xf=t,this.pos=0,this.full=!1,this.acc=new Array(r)}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.acc=null,this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.store(t),this.full?this.xf["@@transducer/step"](r,this.getCopy()):r},e.prototype.store=function(r){this.acc[this.pos]=r,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},e.prototype.getCopy=function(){return dr(Array.prototype.slice.call(this.acc,this.pos),Array.prototype.slice.call(this.acc,0,this.pos))},e})(),gd=p(function(r,t){return new yd(r,t)}),xf=gd;var xd=p(j([],xf,Ni)),vf=xd;var vd=p(function(r,t){return dr(t,[r])}),_f=vd;var _d=p(function(r,t){return r.apply(this,t)}),de=_d;var wd=A(function(r){for(var t=pr(r),n=t.length,o=[],i=0;i<n;)o[i]=r[t[i]],i+=1;return o}),Un=wd;function wf(e,r){return H(r)?r.map(e):pr(r).reduce(function(t,n){return t[n]=e(r[n]),t},{})}var Ad=A(function e(r){return r=wf(function(t){return typeof t=="function"?t:e(t)},r),D(wr(Ur,0,nt("length",Un(r))),function(){var t=arguments;return wf(function(n){return de(n,t)},r)})}),Af=Ad;var bd=p(function(r,t){return t(r)}),bf=bd;var kd=b(function(r,t,n){var o=r(t),i=r(n);return o<i?-1:o>i?1:0}),kf=kd;function ee(e,r,t){if(br(e)&&H(t)){var n=[].concat(t);return n[e]=r,n}var o={};for(var i in t)o[i]=t[i];return o[e]=r,o}var Sd=A(function(r){return r==null}),qr=Sd;var Od=b(function e(r,t,n){if(r.length===0)return t;var o=r[0];if(r.length>1){var i=!qr(n)&&T(o,n)?n[o]:br(r[1])?[]:{};t=e(Array.prototype.slice.call(r,1),t,i)}return ee(o,t,n)}),he=Od;var $d=b(function(r,t,n){return he([r],t,n)}),ye=$d;var Ed=p(function(r,t){switch(r){case 0:return function(){return t.call(this)};case 1:return function(n){return t.call(this,n)};case 2:return function(n,o){return t.call(this,n,o)};case 3:return function(n,o,i){return t.call(this,n,o,i)};case 4:return function(n,o,i,a){return t.call(this,n,o,i,a)};case 5:return function(n,o,i,a,f){return t.call(this,n,o,i,a,f)};case 6:return function(n,o,i,a,f,s){return t.call(this,n,o,i,a,f,s)};case 7:return function(n,o,i,a,f,s,u){return t.call(this,n,o,i,a,f,s,u)};case 8:return function(n,o,i,a,f,s,u,m){return t.call(this,n,o,i,a,f,s,u,m)};case 9:return function(n,o,i,a,f,s,u,m,g){return t.call(this,n,o,i,a,f,s,u,m,g)};case 10:return function(n,o,i,a,f,s,u,m,g,l){return t.call(this,n,o,i,a,f,s,u,m,g,l)};default:throw new Error("First argument to nAry must be a non-negative integer no greater than ten")}}),Bt=Ed;var Bd=A(function(r){return Bt(2,r)}),Sf=Bd;function Vr(e){var r=Object.prototype.toString.call(e);return r==="[object Function]"||r==="[object AsyncFunction]"||r==="[object GeneratorFunction]"||r==="[object AsyncGeneratorFunction]"}var Id=p(function(r,t){var n=D(r,t);return D(r,function(){return Z(me,ur(n,arguments[0]),Array.prototype.slice.call(arguments,1))})}),Zn=Id;var Fd=A(function(r){return Zn(r.length,r)}),It=Fd;var jd=p(function(r,t){return Vr(r)?function(){return r.apply(this,arguments)&&t.apply(this,arguments)}:It(Tn)(r,t)}),Of=jd;var Nd=A(function(r){return r.apply(this,Array.prototype.slice.call(arguments,1))}),$f=Nd;function Ge(e){return function r(t){for(var n,o,i,a=[],f=0,s=t.length;f<s;){if(yt(t[f]))for(n=e?r(t[f]):t[f],i=0,o=n.length;i<o;)a[a.length]=n[i],i+=1;else a[a.length]=t[f];f+=1}return a}}function Pi(e){return{"@@transducer/value":e,"@@transducer/reduced":!0}}var Pd=function(e){return{"@@transducer/init":I.init,"@@transducer/result":function(r){return e["@@transducer/result"](r)},"@@transducer/step":function(r,t){var n=e["@@transducer/step"](r,t);return n["@@transducer/reduced"]?Pi(n):n}}},Wd=function(r){var t=Pd(r);return{"@@transducer/init":I.init,"@@transducer/result":function(n){return t["@@transducer/result"](n)},"@@transducer/step":function(n,o){return yt(o)?Z(t,n,o):Z(t,n,[o])}}},Ef=Wd;var zd=p(function(r,t){return ur(r,Ef(t))}),Bf=zd;var Cd=p(j(["fantasy-land/chain","chain"],Bf,function(r,t){return typeof t=="function"?function(n){return r(t(n))(n)}:Ge(!1)(ur(r,t))})),qn=Cd;var Ld=b(function(r,t,n){if(r>t)throw new Error("min must not be greater than max in clamp(min, max, value)");return n<r?r:n>t?t:n}),If=Ld;function Qe(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))}var Rd=A(function(r){return r===null?"Null":r===void 0?"Undefined":Object.prototype.toString.call(r).slice(8,-1)}),ne=Rd;function Ft(e,r,t,n){var o=function(a){for(var f=r.length,s=0;s<f;){if(e===r[s])return t[s];s+=1}r[s]=e,t[s]=a;for(var u in e)e.hasOwnProperty(u)&&(a[u]=n?Ft(e[u],r,t,!0):e[u]);return a};switch(ne(e)){case"Object":return o(Object.create(Object.getPrototypeOf(e)));case"Array":return o([]);case"Date":return new Date(e.valueOf());case"RegExp":return Qe(e);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return e.slice();default:return e}}var Md=A(function(r){return r!=null&&typeof r.clone=="function"?r.clone():Ft(r,[],[],!0)}),Ff=Md;var Dd=p(function(r,t){var n=Z(function(a,f){var s=r(f);return a[s]===void 0&&(a[s]=[]),a[s].push(f),a},{},t),o=[];for(var i in n)o.push(n[i]);return o}),jf=Dd;var Td=A(function(r){return function(t,n){return r(t,n)?-1:r(n,t)?1:0}}),Nf=Td;var Ud=A(function(r){return!r}),Vn=Ud;var Zd=It(Vn),Pf=Zd;function Wi(e,r){return function(){return r.call(this,e.apply(this,arguments))}}function Qr(e,r){return function(){var t=arguments.length;if(t===0)return r();var n=arguments[t-1];return H(n)||typeof n[e]!="function"?r.apply(this,arguments):n[e].apply(n,Array.prototype.slice.call(arguments,0,t-1))}}var qd=b(Qr("slice",function(r,t,n){return Array.prototype.slice.call(n,r,t)})),hr=qd;var Vd=A(Qr("tail",hr(1,1/0))),zr=Vd;function Ye(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return gr(arguments[0].length,wr(Wi,arguments[0],zr(arguments)))}var Jd=A(function(r){return Zr(r)?r.split("").reverse().join(""):Array.prototype.slice.call(r,0).reverse()}),ge=Jd;function oe(){if(arguments.length===0)throw new Error("compose requires at least one argument");return Ye.apply(this,ge(arguments))}var Xd=Pr(0),Jn=Xd;function gt(e){return e}var Hd=A(gt),jt=Hd;var Kd=p(function(r,t){if(t.length<=0)return jt;var n=Jn(t),o=zr(t);return gr(n.length,function(){return Z(function(i,a){return r.call(this,a,i)},n.apply(this,arguments),o)})}),Xn=Kd;var Gd=p(function(r,t){return Xn.apply(this,[r,ge(t)])}),Wf=Gd;function Hn(e){for(var r=[],t;!(t=e.next()).done;)r.push(t.value);return r}function Mr(e,r,t){for(var n=0,o=t.length;n<o;){if(e(r,t[n]))return!0;n+=1}return!1}function zi(e){var r=String(e).match(/^function (\w*)/);return r==null?"":r[1]}function Qd(e,r){return e===r?e!==0||1/e===1/r:e!==e&&r!==r}var xe=typeof Object.is=="function"?Object.is:Qd;function zf(e,r,t,n){var o=Hn(e),i=Hn(r);function a(f,s){return rn(f,s,t.slice(),n.slice())}return!Mr(function(f,s){return!Mr(a,s,f)},i,o)}function rn(e,r,t,n){if(xe(e,r))return!0;var o=ne(e);if(o!==ne(r))return!1;if(typeof e["fantasy-land/equals"]=="function"||typeof r["fantasy-land/equals"]=="function")return typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](r)&&typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](e);if(typeof e.equals=="function"||typeof r.equals=="function")return typeof e.equals=="function"&&e.equals(r)&&typeof r.equals=="function"&&r.equals(e);switch(o){case"Arguments":case"Array":case"Object":if(typeof e.constructor=="function"&&zi(e.constructor)==="Promise")return e===r;break;case"Boolean":case"Number":case"String":if(!(typeof e==typeof r&&xe(e.valueOf(),r.valueOf())))return!1;break;case"Date":if(!xe(e.valueOf(),r.valueOf()))return!1;break;case"Error":return e.name===r.name&&e.message===r.message;case"RegExp":if(!(e.source===r.source&&e.global===r.global&&e.ignoreCase===r.ignoreCase&&e.multiline===r.multiline&&e.sticky===r.sticky&&e.unicode===r.unicode))return!1;break}for(var i=t.length-1;i>=0;){if(t[i]===e)return n[i]===r;i-=1}switch(o){case"Map":return e.size!==r.size?!1:zf(e.entries(),r.entries(),t.concat([e]),n.concat([r]));case"Set":return e.size!==r.size?!1:zf(e.values(),r.values(),t.concat([e]),n.concat([r]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var a=pr(e);if(a.length!==pr(r).length)return!1;var f=t.concat([e]),s=n.concat([r]);for(i=a.length-1;i>=0;){var u=a[i];if(!(T(u,r)&&rn(r[u],e[u],f,s)))return!1;i-=1}return!0}var Yd=p(function(r,t){return rn(r,t,[],[])}),lr=Yd;function tn(e,r,t){var n,o;if(typeof e.indexOf=="function")switch(typeof r){case"number":if(r===0){for(n=1/r;t<e.length;){if(o=e[t],o===0&&1/o===n)return t;t+=1}return-1}else if(r!==r){for(;t<e.length;){if(o=e[t],typeof o=="number"&&o!==o)return t;t+=1}return-1}return e.indexOf(r,t);case"string":case"boolean":case"function":case"undefined":return e.indexOf(r,t);case"object":if(r===null)return e.indexOf(r,t)}for(;t<e.length;){if(lr(e[t],r))return t;t+=1}return-1}function Jr(e,r){return tn(r,e,0)>=0}function en(e){var r=e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+r.replace(/"/g,'\\"')+'"'}var nn=function(r){return(r<10?"0":"")+r},rh=typeof Date.prototype.toISOString=="function"?function(r){return r.toISOString()}:function(r){return r.getUTCFullYear()+"-"+nn(r.getUTCMonth()+1)+"-"+nn(r.getUTCDate())+"T"+nn(r.getUTCHours())+":"+nn(r.getUTCMinutes())+":"+nn(r.getUTCSeconds())+"."+(r.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},Cf=rh;function on(e){return function(){return!e.apply(this,arguments)}}function ie(e,r){for(var t=0,n=r.length,o=[];t<n;)e(r[t])&&(o[o.length]=r[t]),t+=1;return o}function Xr(e){return Object.prototype.toString.call(e)==="[object Object]"}var th=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.f(t)?this.xf["@@transducer/step"](r,t):r},e})(),eh=p(function(r,t){return new th(r,t)}),Lf=eh;var nh=p(j(["fantasy-land/filter","filter"],Lf,function(e,r){return Xr(r)?Z(function(t,n){return e(r[n])&&(t[n]=r[n]),t},{},pr(r)):ie(e,r)})),ve=nh;var oh=p(function(r,t){return ve(on(r),t)}),Nt=oh;function _e(e,r){var t=function(a){var f=r.concat([e]);return Jr(a,f)?"<Circular>":_e(a,f)},n=function(i,a){return Rr(function(f){return en(f)+": "+t(i[f])},a.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+Rr(t,e).join(", ")+"))";case"[object Array]":return"["+Rr(t,e).concat(n(e,Nt(function(i){return/^\d+$/.test(i)},pr(e)))).join(", ")+"]";case"[object Boolean]":return typeof e=="object"?"new Boolean("+t(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?t(NaN):en(Cf(e)))+")";case"[object Null]":return"null";case"[object Number]":return typeof e=="object"?"new Number("+t(e.valueOf())+")":1/e===-1/0?"-0":e.toString(10);case"[object String]":return typeof e=="object"?"new String("+t(e.valueOf())+")":en(e);case"[object Undefined]":return"undefined";default:if(typeof e.toString=="function"){var o=e.toString();if(o!=="[object Object]")return o}return"{"+n(e,pr(e)).join(", ")+"}"}}var ih=A(function(r){return _e(r,[])}),it=ih;var ah=p(function(r,t){if(H(r)){if(H(t))return r.concat(t);throw new TypeError(it(t)+" is not an array")}if(Zr(r)){if(Zr(t))return r+t;throw new TypeError(it(t)+" is not a string")}if(r!=null&&Vr(r["fantasy-land/concat"]))return r["fantasy-land/concat"](t);if(r!=null&&Vr(r.concat))return r.concat(t);throw new TypeError(it(r)+' does not have a method named "concat" or "fantasy-land/concat"')}),we=ah;var fh=A(function(r){var t=wr(Ur,0,ur(function(n){return n[0].length},r));return gr(t,function(){for(var n=0;n<r.length;){if(r[n][0].apply(this,arguments))return r[n][1].apply(this,arguments);n+=1}})}),Rf=fh;var sh=A(function(r){return D(r.length,r)}),at=sh;var uh=p(function(r,t){if(r>10)throw new Error("Constructor with greater than ten arguments");return r===0?function(){return new t}:at(Bt(r,function(n,o,i,a,f,s,u,m,g,l){switch(arguments.length){case 1:return new t(n);case 2:return new t(n,o);case 3:return new t(n,o,i);case 4:return new t(n,o,i,a);case 5:return new t(n,o,i,a,f);case 6:return new t(n,o,i,a,f,s);case 7:return new t(n,o,i,a,f,s,u);case 8:return new t(n,o,i,a,f,s,u,m);case 9:return new t(n,o,i,a,f,s,u,m,g);case 10:return new t(n,o,i,a,f,s,u,m,g,l)}}))}),Kn=uh;var lh=A(function(r){return Kn(r.length,r)}),Mf=lh;var ch=p(function(r,t){return D(wr(Ur,0,nt("length",t)),function(){var n=arguments,o=this;return r.apply(o,Rr(function(i){return i.apply(o,n)},t))})}),Gn=ch;var ph=at(function(e,r){return Z(function(t,n){return e(n)?t+1:t},0,r)}),Df=ph;var mh=(function(){function e(r,t,n,o){this.valueFn=r,this.valueAcc=t,this.keyFn=n,this.xf=o,this.inputs={}}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){var t;for(t in this.inputs)if(T(t,this.inputs)&&(r=this.xf["@@transducer/step"](r,this.inputs[t]),r["@@transducer/reduced"])){r=r["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){var n=this.keyFn(t);return this.inputs[n]=this.inputs[n]||[n,this.valueAcc],this.inputs[n][1]=this.valueFn(this.inputs[n][1],t),r},e})(),dh=Nr(4,[],function(r,t,n,o){return new mh(r,t,n,o)}),Tf=dh;var hh=Nr(4,[],j([],Tf,function(r,t,n,o){return Z(function(i,a){var f=n(a),s=r(T(f,i)?i[f]:Ft(t,[],[],!1),a);return s&&s["@@transducer/reduced"]?vr(i):(i[f]=s,i)},{},o)})),Pt=hh;var yh=Pt(function(e,r){return e+1},0),Uf=yh;var gh=Et(-1),Zf=gh;var xh=p(function(r,t){return t==null||t!==t?r:t}),Ae=xh;var vh=b(function(r,t,n){var o=r(t),i=r(n);return o>i?-1:o<i?1:0}),qf=vh;var _h=(function(){function e(){this._nativeSet=typeof Set=="function"?new Set:null,this._items={}}return e.prototype.add=function(r){return!Vf(r,!0,this)},e.prototype.has=function(r){return Vf(r,!1,this)},e})();function Vf(e,r,t){var n=typeof e,o,i;switch(n){case"string":case"number":return e===0&&1/e===-1/0?t._items["-0"]?!0:(r&&(t._items["-0"]=!0),!1):t._nativeSet!==null?r?(o=t._nativeSet.size,t._nativeSet.add(e),i=t._nativeSet.size,i===o):t._nativeSet.has(e):n in t._items?e in t._items[n]?!0:(r&&(t._items[n][e]=!0),!1):(r&&(t._items[n]={},t._items[n][e]=!0),!1);case"boolean":if(n in t._items){var a=e?1:0;return t._items[n][a]?!0:(r&&(t._items[n][a]=!0),!1)}else return r&&(t._items[n]=e?[!1,!0]:[!0,!1]),!1;case"function":return t._nativeSet!==null?r?(o=t._nativeSet.size,t._nativeSet.add(e),i=t._nativeSet.size,i===o):t._nativeSet.has(e):n in t._items?Jr(e,t._items[n])?!0:(r&&t._items[n].push(e),!1):(r&&(t._items[n]=[e]),!1);case"undefined":return t._items[n]?!0:(r&&(t._items[n]=!0),!1);case"object":if(e===null)return t._items.null?!0:(r&&(t._items.null=!0),!1);default:return n=Object.prototype.toString.call(e),n in t._items?Jr(e,t._items[n])?!0:(r&&t._items[n].push(e),!1):(r&&(t._items[n]=[e]),!1)}}var be=_h;var wh=p(function(r,t){for(var n=[],o=0,i=r.length,a=t.length,f=new be,s=0;s<a;s+=1)f.add(t[s]);for(;o<i;)f.add(r[o])&&(n[n.length]=r[o]),o+=1;return n}),an=wh;var Ah=b(function(r,t,n){for(var o=[],i=0,a=t.length;i<a;)!Mr(r,t[i],n)&&!Mr(r,t[i],o)&&o.push(t[i]),i+=1;return o}),fn=Ah;var bh=b(function(r,t,n){var o=Array.prototype.slice.call(n,0);return o.splice(r,t),o}),Qn=bh;function Ci(e,r){if(r==null)return r;if(br(e)&&H(r))return Qn(e,1,r);var t={};for(var n in r)t[n]=r[n];return delete t[e],t}function kh(e,r){if(br(e)&&H(r))return[].concat(r);var t={};for(var n in r)t[n]=r[n];return t}var Sh=p(function e(r,t){if(t==null)return t;switch(r.length){case 0:return t;case 1:return Ci(r[0],t);default:var n=r[0],o=Array.prototype.slice.call(r,1);return t[n]==null?kh(n,t):ye(n,e(o,t[n]),t)}}),Yn=Sh;var Oh=p(function(r,t){return Yn([r],t)}),Jf=Oh;var $h=p(function(r,t){return r/t}),Xf=$h;var Eh=(function(){function e(r,t){this.xf=t,this.n=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.n>0?(this.n-=1,r):this.xf["@@transducer/step"](r,t)},e})(),Bh=p(function(r,t){return new Eh(r,t)}),Hf=Bh;var Ih=p(j(["drop"],Hf,function(r,t){return hr(Math.max(0,r),1/0,t)})),ro=Ih;var Fh=(function(){function e(r,t){this.xf=t,this.n=r,this.i=0}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){this.i+=1;var n=this.n===0?r:this.xf["@@transducer/step"](r,t);return this.n>=0&&this.i>=this.n?vr(n):n},e})(),jh=p(function(r,t){return new Fh(r,t)}),Kf=jh;var Nh=p(j(["take"],Kf,function(r,t){return hr(0,r<0?1/0:r,t)})),ke=Nh;function Li(e,r){return ke(e<r.length?r.length-e:0,r)}var Ph=(function(){function e(r,t){this.xf=t,this.pos=0,this.full=!1,this.acc=new Array(r)}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.acc=null,this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.full&&(r=this.xf["@@transducer/step"](r,this.acc[this.pos])),this.store(t),r},e.prototype.store=function(r){this.acc[this.pos]=r,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},e})(),Wh=p(function(r,t){return new Ph(r,t)}),Gf=Wh;var zh=p(j([],Gf,Li)),Qf=zh;function Ri(e,r){for(var t=r.length-1;t>=0&&e(r[t]);)t-=1;return hr(0,t+1,r)}var Ch=(function(){function e(r,t){this.f=r,this.retained=[],this.xf=t}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.retained=null,this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.f(t)?this.retain(r,t):this.flush(r,t)},e.prototype.flush=function(r,t){return r=Z(this.xf["@@transducer/step"],r,this.retained),this.retained=[],this.xf["@@transducer/step"](r,t)},e.prototype.retain=function(r,t){return this.retained.push(t),r},e})(),Lh=p(function(r,t){return new Ch(r,t)}),Yf=Lh;var Rh=p(j([],Yf,Ri)),rs=Rh;var Mh=(function(){function e(r,t){this.xf=t,this.pred=r,this.lastValue=void 0,this.seenFirstValue=!1}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){var n=!1;return this.seenFirstValue?this.pred(this.lastValue,t)&&(n=!0):this.seenFirstValue=!0,this.lastValue=t,n?r:this.xf["@@transducer/step"](r,t)},e})(),Dh=p(function(r,t){return new Mh(r,t)}),to=Dh;var Th=Pr(-1),Se=Th;var Uh=p(j([],to,function(r,t){var n=[],o=1,i=t.length;if(i!==0)for(n[0]=t[0];o<i;)r(Se(n),t[o])||(n[n.length]=t[o]),o+=1;return n})),eo=Uh;var Zh=A(j([],to(lr),eo(lr))),ts=Zh;var qh=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){if(this.f){if(this.f(t))return r;this.f=null}return this.xf["@@transducer/step"](r,t)},e})(),Vh=p(function(r,t){return new qh(r,t)}),es=Vh;var Jh=p(j(["dropWhile"],es,function(r,t){for(var n=0,o=t.length;n<o&&r(t[n]);)n+=1;return hr(n,1/0,t)})),ns=Jh;var Xh=p(function(r,t){return r||t}),no=Xh;var Hh=p(function(r,t){return Vr(r)?function(){return r.apply(this,arguments)||t.apply(this,arguments)}:It(no)(r,t)}),os=Hh;function Mi(e){var r=Object.prototype.toString.call(e);return r==="[object Uint8ClampedArray]"||r==="[object Int8Array]"||r==="[object Uint8Array]"||r==="[object Int16Array]"||r==="[object Uint16Array]"||r==="[object Int32Array]"||r==="[object Uint32Array]"||r==="[object Float32Array]"||r==="[object Float64Array]"||r==="[object BigInt64Array]"||r==="[object BigUint64Array]"}var Kh=A(function(r){return r!=null&&typeof r["fantasy-land/empty"]=="function"?r["fantasy-land/empty"]():r!=null&&r.constructor!=null&&typeof r.constructor["fantasy-land/empty"]=="function"?r.constructor["fantasy-land/empty"]():r!=null&&typeof r.empty=="function"?r.empty():r!=null&&r.constructor!=null&&typeof r.constructor.empty=="function"?r.constructor.empty():H(r)?[]:Zr(r)?"":Xr(r)?{}:Dn(r)?(function(){return arguments})():Mi(r)?r.constructor.from(""):void 0}),oo=Kh;var Gh=p(function(r,t){return ro(r>=0?t.length-r:0,t)}),io=Gh;var Qh=p(function(e,r){return lr(io(e.length,r),e)}),is=Qh;var Yh=b(function(r,t,n){return lr(r(t),r(n))}),as=Yh;var ry=b(function(r,t,n){return lr(t[r],n[r])}),fs=ry;var ty=p(function e(r,t){if(!Xr(t)&&!H(t))return t;var n=t instanceof Array?[]:{},o,i,a;for(i in t)o=r[i],a=typeof o,n[i]=a==="function"?o(t[i]):o&&a==="object"?e(o,t[i]):t[i];return n}),ss=ty;var ey=(function(){function e(r,t){this.xf=t,this.f=r,this.found=!1}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.found||(r=this.xf["@@transducer/step"](r,void 0)),this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.f(t)&&(this.found=!0,r=vr(this.xf["@@transducer/step"](r,t))),r},e})(),ny=p(function(r,t){return new ey(r,t)}),us=ny;var oy=p(j(["find"],us,function(r,t){for(var n=0,o=t.length;n<o;){if(r(t[n]))return t[n];n+=1}})),ls=oy;var iy=(function(){function e(r,t){this.xf=t,this.f=r,this.idx=-1,this.found=!1}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.found||(r=this.xf["@@transducer/step"](r,-1)),this.xf["@@transducer/result"](r)},e.prototype["@@transducer/step"]=function(r,t){return this.idx+=1,this.f(t)&&(this.found=!0,r=vr(this.xf["@@transducer/step"](r,this.idx))),r},e})(),ay=p(function(r,t){return new iy(r,t)}),cs=ay;var fy=p(j([],cs,function(r,t){for(var n=0,o=t.length;n<o;){if(r(t[n]))return n;n+=1}return-1})),ps=fy;var sy=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](r,this.last))},e.prototype["@@transducer/step"]=function(r,t){return this.f(t)&&(this.last=t),r},e})(),uy=p(function(r,t){return new sy(r,t)}),ms=uy;var ly=p(j([],ms,function(r,t){for(var n=t.length-1;n>=0;){if(r(t[n]))return t[n];n-=1}})),ds=ly;var cy=(function(){function e(r,t){this.xf=t,this.f=r,this.idx=-1,this.lastIdx=-1}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=function(r){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](r,this.lastIdx))},e.prototype["@@transducer/step"]=function(r,t){return this.idx+=1,this.f(t)&&(this.lastIdx=this.idx),r},e})(),py=p(function(r,t){return new cy(r,t)}),hs=py;var my=p(j([],hs,function(r,t){for(var n=t.length-1;n>=0;){if(r(t[n]))return n;n-=1}return-1})),ys=my;var dy=A(Ge(!0)),gs=dy;var hy=A(function(r){return D(r.length,function(t,n){var o=Array.prototype.slice.call(arguments,0);return o[0]=n,o[1]=t,r.apply(this,o)})}),Wt=hy;var yy=p(Qr("forEach",function(r,t){for(var n=t.length,o=0;o<n;)r(t[o]),o+=1;return t})),xs=yy;var gy=p(function(r,t){for(var n=pr(t),o=0;o<n.length;){var i=n[o];r(t[i],i,t),o+=1}return t}),vs=gy;var xy=A(function(r){for(var t={},n=0;n<r.length;)t[r[n][0]]=r[n][1],n+=1;return t}),_s=xy;var vy=p(Qr("groupBy",Pt(function(e,r){return e.push(r),e},[]))),ws=vy;var _y=p(function(e,r){for(var t=[],n=0,o=r.length;n<o;){for(var i=n+1;i<o&&e(r[i-1],r[i]);)i+=1;t.push(r.slice(n,i)),n=i}return t}),As=_y;var wy=p(function(r,t){return r>t}),ao=wy;var Ay=p(function(r,t){return r>=t}),bs=Ay;var by=p(function(r,t){if(r.length===0||qr(t))return!1;for(var n=t,o=0;o<r.length;)if(!qr(n)&&T(r[o],n))n=n[r[o]],o+=1;else return!1;return!0}),fo=by;var ky=p(function(r,t){return fo([r],t)}),ks=ky;var Sy=p(function(r,t){return qr(t)?!1:r in t}),Ss=Sy;var Oy=p(xe),Os=Oy;var $y=b(function(r,t,n){return D(Math.max(r.length,t.length,n.length),function(){return r.apply(this,arguments)?t.apply(this,arguments):n.apply(this,arguments)})}),so=$y;var Ey=Et(1),$s=Ey;var By=p(Jr),uo=By;var Iy=Pt(function(e,r){return r},null),Es=Iy;var Fy=p(function(r,t){return typeof t.indexOf=="function"&&!H(t)?t.indexOf(r):tn(t,r,0)}),Bs=Fy;var jy=hr(0,-1),lo=jy;var Ny=b(function(r,t,n){return ie(function(o){return Mr(r,o,n)},t)}),Is=Ny;var Py=b(function(r,t,n){r=r<n.length&&r>=0?r:n.length;var o=Array.prototype.slice.call(n,0);return o.splice(r,0,t),o}),Fs=Py;var Wy=b(function(r,t,n){return r=r<n.length&&r>=0?r:n.length,[].concat(Array.prototype.slice.call(n,0,r),t,Array.prototype.slice.call(n,r))}),js=Wy;var zy=(function(){function e(r,t){this.xf=t,this.f=r,this.set=new be}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.set.add(this.f(t))?this.xf["@@transducer/step"](r,t):r},e})(),Cy=p(function(r,t){return new zy(r,t)}),Ns=Cy;var Ly=p(j([],Ns,function(e,r){for(var t=new be,n=[],o=0,i,a;o<r.length;)a=r[o],i=e(a),t.add(i)&&n.push(a),o+=1;return n})),co=Ly;var Ry=co(jt),Oe=Ry;var My=p(function(r,t){var n,o;return r.length>t.length?(n=r,o=t):(n=t,o=r),Oe(ie(Wt(Jr)(n),o))}),Ps=My;var Dy=p(Qr("intersperse",function(r,t){for(var n=[],o=0,i=t.length;o<i;)o===i-1?n.push(t[o]):n.push(t[o],r),o+=1;return n})),Ws=Dy;function Ty(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),t=1,n=arguments.length;t<n;){var o=arguments[t];if(o!=null)for(var i in o)T(i,o)&&(r[i]=o[i]);t+=1}return r}var zt=typeof Object.assign=="function"?Object.assign:Ty;var Uy=p(function(r,t){var n={};return n[r]=t,n}),po=Uy;var Zy={"@@transducer/init":Array,"@@transducer/step":function(e,r){return e.push(r),e},"@@transducer/result":gt},qy={"@@transducer/init":String,"@@transducer/step":function(e,r){return e+r},"@@transducer/result":gt},Vy={"@@transducer/init":Object,"@@transducer/step":function(e,r){return zt(e,yt(r)?po(r[0],r[1]):r)},"@@transducer/result":gt};function Di(e){if(te(e))return e;if(yt(e))return Zy;if(typeof e=="string")return qy;if(typeof e=="object")return Vy;throw new Error("Cannot create transformer for "+e)}var Jy=b(function(r,t,n){return te(r)?Z(t(r),r["@@transducer/init"](),n):Z(t(Di(r)),Ft(r,[],[],!1),n)}),zs=Jy;var Xy=A(function(r){for(var t=pr(r),n=t.length,o=0,i={};o<n;){var a=t[o],f=r[a],s=T(f,i)?i[f]:i[f]=[];s[s.length]=a,o+=1}return i}),Cs=Xy;var Hy=A(function(r){for(var t=pr(r),n=t.length,o=0,i={};o<n;){var a=t[o];i[r[a]]=a,o+=1}return i}),Ls=Hy;var Ky=p(function(r,t){return D(r+1,function(){var n=arguments[r];if(n!=null&&Vr(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,r));throw new TypeError(it(n)+' does not have a method named "'+t+'"')})}),ft=Ky;var Gy=p(function(r,t){return t instanceof r||t!=null&&(t.constructor===r||r.name==="Object"&&typeof t=="object")}),$r=Gy;var Qy=A(function(r){return r!=null&&lr(r,oo(r))}),Rs=Qy;var Yy=ft(1,"join"),Ms=Yy;var rg=A(function(r){return Gn(function(){return Array.prototype.slice.call(arguments,0)},r)}),mo=rg;var tg=A(function(r){var t,n=[];for(t in r)n[n.length]=t;return n}),Ds=tg;var eg=p(function(r,t){if(typeof t.lastIndexOf=="function"&&!H(t))return t.lastIndexOf(r);for(var n=t.length-1;n>=0;){if(lr(t[n],r))return n;n-=1}return-1}),Ts=eg;function $e(e){return Object.prototype.toString.call(e)==="[object Number]"}var ng=A(function(r){return r!=null&&$e(r.length)?r.length:NaN}),Ee=ng;var og=p(function(r,t){return function(n){return function(o){return ur(function(i){return t(i,o)},n(r(o)))}}}),Ct=og;var ig=b(function(r,t,n){return Ln(r,ot(t),n)}),ho=ig;var ag=A(function(r){return Ct(Pr(r),ho(r))}),Us=ag;var fg=p(function(r,t){return r.map(function(n){for(var o=t,i=0,a;i<n.length;){if(o==null)return;a=n[i],o=br(a)?Pr(a,o):o[a],i+=1}return o})}),yo=fg;var sg=p(function(r,t){return yo([r],t)[0]}),Er=sg;var ug=A(function(r){return Ct(Er(r),he(r))}),Zs=ug;var lg=A(function(r){return Ct(Wr(r),ye(r))}),qs=lg;var cg=p(function(r,t){return r<t}),Vs=cg;var pg=p(function(r,t){return r<=t}),Js=pg;var mg=b(function(r,t,n){for(var o=0,i=n.length,a=[],f=[t];o<i;)f=r(f[0],n[o]),a[o]=f[1],o+=1;return[f[0],a]}),Xs=mg;var dg=b(function(r,t,n){for(var o=n.length-1,i=[],a=[t];o>=0;)a=r(a[0],n[o]),i[o]=a[1],o-=1;return[a[0],i]}),Hs=dg;var hg=p(function(r,t){return Z(function(n,o){return n[o]=r(t[o],o,t),n},{},pr(t))}),Ks=hg;var yg=p(function(r,t){return t.match(r)||[]}),Gs=yg;var gg=p(function(r,t){return br(r)?!br(t)||t<1?NaN:(r%t+t)%t:NaN}),Qs=gg;var xg=b(function(r,t,n){return r(n)>r(t)?n:t}),Ys=xg;var vg=wr(Et,0),go=vg;var _g=A(function(r){return go(r)/r.length}),xo=_g;var wg=A(function(r){var t=r.length;if(t===0)return NaN;var n=2-t%2,o=(t-n)/2;return xo(Array.prototype.slice.call(r,0).sort(function(i,a){return i<a?-1:i>a?1:0}).slice(o,o+n))}),ru=wg;var Ag=p(function(r,t){var n={};return gr(t.length,function(){var o=r.apply(this,arguments);return T(o,n)||(n[o]=t.apply(this,arguments)),n[o]})}),tu=Ag;var bg=A(function(r){return zt.apply(null,[{}].concat(r))}),eu=bg;var kg=b(function(r,t,n){var o={},i;for(i in t)T(i,t)&&(o[i]=T(i,n)?r(i,t[i],n[i]):t[i]);for(i in n)T(i,n)&&!T(i,o)&&(o[i]=n[i]);return o}),Be=kg;var Sg=b(function e(r,t,n){return Be(function(o,i,a){return Xr(i)&&Xr(a)?e(r,i,a):r(o,i,a)},t,n)}),Lt=Sg;var Og=p(function(r,t){return Lt(function(n,o,i){return o},r,t)}),nu=Og;var $g=p(function(r,t){return Lt(function(n,o,i){return i},r,t)}),vo=$g;var Eg=b(function(r,t,n){return Lt(function(o,i,a){return r(i,a)},t,n)}),ou=Eg;var Bg=p(function(r,t){return zt({},t,r)}),iu=Bg;var Ig=p(function(r,t){return zt({},r,t)}),au=Ig;var Fg=b(function(r,t,n){return Be(function(o,i,a){return r(i,a)},t,n)}),fu=Fg;var jg=p(function(r,t){return t<r?t:r}),su=jg;var Ng=b(function(r,t,n){return r(n)<r(t)?n:t}),uu=Ng;function Ti(e,r,t){if(br(e)&&H(t)){var n=[].concat(t);return n[e]=r(n[e]),n}var o={};for(var i in t)o[i]=t[i];return o[e]=r(o[e]),o}var Pg=b(function e(r,t,n){if(!Xr(n)&&!H(n)||r.length===0)return n;var o=r[0];if(!T(o,n))return n;if(r.length===1)return Ti(o,t,n);var i=e(Array.prototype.slice.call(r,1),t,n[o]);return i===n[o]?n:ee(o,i,n)}),_o=Pg;var Wg=b(function(r,t,n){return _o([r],t,n)}),lu=Wg;var zg=p(function(r,t){return r%t}),cu=zg;var Cg=b(function(e,r,t){var n=t.length,o=t.slice(),i=e<0?n+e:e,a=r<0?n+r:r,f=o.splice(i,1);return i<0||i>=t.length||a<0||a>=t.length?t:[].concat(o.slice(0,a)).concat(f).concat(o.slice(a,t.length))}),pu=Cg;var Lg=p(function(r,t){return r*t}),wo=Lg;var mu=p((e,r)=>t=>e.call(void 0,vo(r,t)));var Rg=A(function(r){return-r}),du=Rg;var Mg=p(function(r,t){return Rn(on(r),t)}),hu=Mg;var Dg=A(function(r){var t=r<0?1:r+1;return D(t,function(){return Pr(r,arguments)})}),yu=Dg;var Tg=b(function(r,t,n){return r(t(n))}),Ao=Tg;function Ui(e){return[e]}var Ug=A(Ui),gu=Ug;var Zg=p(function(r,t){for(var n={},o={},i=0,a=r.length;i<a;)o[r[i]]=1,i+=1;for(var f in t)o.hasOwnProperty(f)||(n[f]=t[f]);return n}),xu=Zg;var qg=Nr(4,[],function(r,t,n,o){return r(t(n),t(o))}),vu=qg;var Vg=A(function(r){var t=!1,n;return gr(r.length,function(){return t||(t=!0,n=r.apply(this,arguments)),n})}),_u=Vg;function sn(e,r){if(r==null||!Vr(r.then))throw new TypeError("`"+e+"` expected a Promise, received "+_e(r,[]))}var Jg=p(function(r,t){return sn("otherwise",t),t.then(null,r)}),wu=Jg;var Au=function(e){return{value:e,map:function(r){return Au(r(e))}}},Xg=b(function(r,t,n){return r(function(o){return Au(t(o))})(n).value}),bo=Xg;var Hg=p(function(r,t){return[r,t]}),bu=Hg;function un(e){return p(function(r,t){return gr(Math.max(0,r.length-t.length),function(){return r.apply(this,e(t,arguments))})})}var Kg=un(dr),ku=Kg;var Gg=un(Wt(dr)),Su=Gg;var Qg=mo([ve,Nt]),Ou=Qg;var Yg=b(function(r,t,n){return lr(Er(r,n),t)}),$u=Yg;var rx=b(function(r,t,n){return Ae(r,Er(t,n))}),Eu=rx;var tx=b(function(r,t,n){return r(Er(t,n))}),Bu=tx;var ex=p(function(r,t){for(var n={},o=0;o<r.length;)r[o]in t&&(n[r[o]]=t[r[o]]),o+=1;return n}),Iu=ex;var nx=p(function(r,t){for(var n={},o=0,i=r.length;o<i;){var a=r[o];n[a]=t[a],o+=1}return n}),ko=nx;var ox=p(function(r,t){var n={};for(var o in t)r(t[o],o,t)&&(n[o]=t[o]);return n}),Fu=ox;var ix=p(function(r,t){return dr([r],t)}),So=ix;var ax=wr(wo,1),ju=ax;var fx=p(function(r,t){return D(t.length,function(){for(var n=[],o=0;o<t.length;)n.push(t[o].call(this,arguments[o])),o+=1;return r.apply(this,n.concat(Array.prototype.slice.call(arguments,t.length)))})}),Oo=fx;var sx=Oo(Rr,[ko,jt]),Nu=sx;function ln(e,r,t){return function(n){return r(t(e(n)))}}var ux=(function(){function e(r,t,n){this.xf=n,this.f=r,this.g=t}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.xf["@@transducer/step"](r,ln(this.f,this.g,t))},e})(),lx=b(function(r,t,n){return new ux(r,t,n)}),Pu=lx;var cx=b(j(["fantasy-land/promap","promap"],Pu,ln)),Wu=cx;var px=b(function(r,t,n){return lr(t,Wr(r,n))}),zu=px;var mx=b(function(r,t,n){return $r(r,Wr(t,n))}),Cu=mx;var dx=b(function(r,t,n){return Ae(r,Wr(t,n))}),Lu=dx;var hx=b(function(r,t,n){return r(Wr(t,n))}),Ru=hx;var yx=p(function(r,t){return r.map(function(n){return Er([n],t)})}),Mu=yx;var gx=p(function(r,t){if(!($e(r)&&$e(t)))throw new TypeError("Both arguments to range must be numbers");for(var n=[],o=r;o<t;)n.push(o),o+=1;return n}),Du=gx;var xx=b(function(r,t,n){for(var o=n.length-1;o>=0;){if(t=r(n[o],t),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}o-=1}return t}),$o=xx;var vx=Nr(4,[],function(r,t,n,o){return Z(function(i,a){return r(i,a)?t(i,a):vr(i)},n,o)}),Tu=vx;var _x=A(vr),Uu=_x;var wx=p(function(r,t){var n=Number(t),o=0,i;if(n<0||isNaN(n))throw new RangeError("n must be a non-negative number");for(i=new Array(n);o<n;)i[o]=r(o),o+=1;return i}),Eo=wx;var Ax=p(function(r,t){return Eo(ot(r),t)}),Zu=Ax;var bx=b(function(r,t,n){return n.replace(r,t)}),qu=bx;var kx=b(function(r,t,n){for(var o=0,i=n.length,a=[t];o<i;)t=r(t,n[o]),a[o+1]=t,o+=1;return a}),Vu=kx;var Sx=p(function(r,t){return typeof t.sequence=="function"?t.sequence(r):$o(function(n,o){return me(ur(So,n),o)},r([]),t)}),Bo=Sx;var Ox=b(function(r,t,n){return bo(r,ot(t),n)}),Ju=Ox;var $x=p(function(r,t){return Array.prototype.slice.call(t,0).sort(r)}),Xu=$x;var Ex=p(function(r,t){return Array.prototype.slice.call(t,0).sort(function(n,o){var i=r(n),a=r(o);return i<a?-1:i>a?1:0})}),Hu=Ex;var Bx=p(function(r,t){return Array.prototype.slice.call(t,0).sort(function(n,o){for(var i=0,a=0;i===0&&a<r.length;)i=r[a](n,o),a+=1;return i})}),Ku=Bx;var Ix=ft(1,"split"),Gu=Ix;var Fx=p(function(r,t){return[hr(0,r,t),hr(r,Ee(t),t)]}),Qu=Fx;var jx=p(function(r,t){if(r<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var n=[],o=0;o<t.length;)n.push(hr(o,o+=r,t));return n}),Yu=jx;var Nx=p(function(r,t){for(var n=0,o=t.length,i=[];n<o&&!r(t[n]);)i.push(t[n]),n+=1;return[i,Array.prototype.slice.call(t,n)]}),rl=Nx;var Px=Nr(2,[],function(r,t){for(var n=[],o=[],i=0;i<t.length;i=i+1)r(t[i])||o.push(t[i]),(i<t.length-1&&r(t[i+1])||i===t.length-1)&&o.length>0&&(n.push(o),o=[]);return n}),tl=Px;var Wx=p(function(e,r){return lr(ke(e.length,r),e)}),el=Wx;var zx=p(function(r,t){return Number(r)-Number(t)}),nl=zx;var Cx=p(function(r,t){return we(an(r,t),an(t,r))}),ol=Cx;var Lx=b(function(r,t,n){return we(fn(r,t,n),fn(r,n,t))}),il=Lx;var Rx=p(function(r,t){for(var n=t.length-1;n>=0&&r(t[n]);)n-=1;return hr(n+1,1/0,t)}),al=Rx;var Mx=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.f(t)?this.xf["@@transducer/step"](r,t):vr(r)},e})(),Dx=p(function(r,t){return new Mx(r,t)}),fl=Dx;var Tx=p(j(["takeWhile"],fl,function(r,t){for(var n=0,o=t.length;n<o&&r(t[n]);)n+=1;return hr(0,n,t)})),sl=Tx;var Ux=(function(){function e(r,t){this.xf=t,this.f=r}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return this.f(t),this.xf["@@transducer/step"](r,t)},e})(),Zx=p(function(r,t){return new Ux(r,t)}),ul=Zx;var qx=p(j([],ul,function(r,t){return r(t),t})),ll=qx;function Zi(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var Vx=p(function(r,t){if(!Zi(r))throw new TypeError("\u2018test\u2019 requires a value of type RegExp as its first argument; received "+it(r));return Qe(r).test(t)}),cl=Vx;var Jx=p(function(r,t){return sn("andThen",t),t.then(r)}),pl=Jx;var Xx=ft(0,"toLowerCase"),ml=Xx;var Hx=A(function(r){var t=[];for(var n in r)T(n,r)&&(t[t.length]=[n,r[n]]);return t}),dl=Hx;var Kx=A(function(r){var t=[];for(var n in r)t[t.length]=[n,r[n]];return t}),hl=Kx;var Gx=ft(0,"toUpperCase"),yl=Gx;var Qx=D(4,function(r,t,n,o){return Z(r(typeof t=="function"?Ke(t):t),n,o)}),gl=Qx;var Yx=A(function(r){for(var t=0,n=[];t<r.length;){for(var o=r[t],i=0;i<o.length;)typeof n[i]>"u"&&(n[i]=[]),n[i].push(o[i]),i+=1;t+=1}return n}),xl=Yx;var rv=b(function(r,t,n){return typeof n["fantasy-land/traverse"]=="function"?n["fantasy-land/traverse"](t,r):typeof n.traverse=="function"?n.traverse(t,r):Bo(r,ur(t,n))}),vl=rv;var cn=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,tv="\u200B",ev=typeof String.prototype.trim=="function",nv=!ev||cn.trim()||!tv.trim()?A(function(r){var t=new RegExp("^["+cn+"]["+cn+"]*"),n=new RegExp("["+cn+"]["+cn+"]*$");return r.replace(t,"").replace(n,"")}):A(function(r){return r.trim()}),_l=nv;var ov=p(function(r,t){return gr(r.length,function(){try{return r.apply(this,arguments)}catch(n){return t.apply(this,dr([n],arguments))}})}),wl=ov;var iv=A(function(r){return function(){return r(Array.prototype.slice.call(arguments,0))}}),Al=iv;var av=A(function(r){return Bt(1,r)}),bl=av;var fv=p(function(r,t){return D(r,function(){for(var n=1,o=t,i=0,a;n<=r&&typeof o=="function";)a=n===r?arguments.length:i+o.length,o=o.apply(this,Array.prototype.slice.call(arguments,i,a)),n+=1,i=a;return o})}),kl=fv;var sv=p(function(r,t){for(var n=r(t),o=[];n&&n.length;)o[o.length]=n[0],n=r(n[1]);return o}),Sl=sv;var uv=p(oe(Oe,dr)),Ol=uv;var lv=(function(){function e(r,t){this.xf=t,this.pred=r,this.items=[]}return e.prototype["@@transducer/init"]=I.init,e.prototype["@@transducer/result"]=I.result,e.prototype["@@transducer/step"]=function(r,t){return Mr(this.pred,t,this.items)?r:(this.items.push(t),this.xf["@@transducer/step"](r,t))},e})(),cv=p(function(r,t){return new lv(r,t)}),$l=cv;var pv=p(j([],$l,function(e,r){for(var t=0,n=r.length,o=[],i;t<n;)i=r[t],Mr(e,i,o)||(o[o.length]=i),t+=1;return o})),Io=pv;var mv=b(function(r,t,n){return Io(r,dr(t,n))}),El=mv;var dv=b(function(r,t,n){return r(n)?n:t(n)}),Bl=dv;var hv=qn(gt),Il=hv;var yv=b(function(r,t,n){for(var o=n;!r(o);)o=t(o);return o}),Fl=yv;var gv=p(function(e,r){return e in r&&H(r[e])?Rr(function(t){return ee(e,t,r)},r[e]):[r]}),jl=gv;var xv=A(function(r){var t,n=[];for(t in r)n[n.length]=r[t];return n}),Nl=xv;var vv=function(e){return{value:e,"fantasy-land/map":function(){return this}}},_v=p(function(r,t){return r(vv)(t).value}),Pl=_v;var wv=b(function(r,t,n){return r(n)?t(n):n}),Wl=wv;var Av=p(function(r,t){for(var n in r)if(T(n,r)&&!r[n](t[n]))return!1;return!0}),Fo=Av;var bv=p(function(r,t){for(var n in r)if(T(n,r)&&r[n](t[n]))return!0;return!1}),zl=bv;var kv=p(function(r,t){return Fo(ur(lr,r),t)}),Cl=kv;var Sv=p(function(e,r){return Nt(Wt(Jr)(e),r)}),Ll=Sv;var Ov=p(function(r,t){return!!(!r^!t)}),Rl=Ov;var $v=p(function(r,t){for(var n=0,o=r.length,i,a=t.length,f=[];n<o;){for(i=0;i<a;)f[f.length]=[r[n],t[i]],i+=1;n+=1}return f}),Ml=$v;var Ev=p(function(r,t){for(var n=[],o=0,i=Math.min(r.length,t.length);o<i;)n[o]=[r[o],t[o]],o+=1;return n}),Dl=Ev;var Bv=p(function(r,t){for(var n=0,o=Math.min(r.length,t.length),i={};n<o;)i[r[n]]=t[n],n+=1;return i}),Tl=Bv;var Iv=b(function(r,t,n){for(var o=[],i=0,a=Math.min(t.length,n.length);i<a;)o[i]=r(t[i],n[i]),i+=1;return o}),Ul=Iv;var Fv=A(function(r){return D(r.length,function(){var n=arguments;return function(){return r.apply(this,n)}})}),Zl=Fv;var jv={Object,Array,String,Number,Boolean},qi=e=>typeof e=="function",jo=(e,r={})=>{if(qr(e))return e;let t=at(f=>{if($r(Array,f)){let s=[];for(let u of f)s.push(t(u));return s}else if($r(Object,f)){let s={};for(let u in f)s[u]=t(f[u]);return s}else return $r(String,f)?f[0]==="%"?zr(f):(/^\$/.test(f)&&(f=n(zr(f),!0)),Er(f.split("."))(r)):f}),n=at((f,s)=>t(f)),o=at((f,s)=>{let u=r;/^\$/.test(f)&&(f=n(zr(f),!0));let m=f.split(".");for(let g of lo(m))qr(u[g])&&(u[g]={}),u=u[g];return u[Se(m)]=s,s}),i=null;if(qi(e[0])){let f=zr(e);i=e[0](...f)}else $r(Array)(e)&&e.length===1&&e[0]==="__"?i=He:e[0]==="typ"?i=jv[e[1]]:e[0]==="reg"?i=new RegExp(...zr(e)):$r(Array)(e)&&(uo(e[0])(["let","var","$"])||qi(pn[e[0]]))?(i=oe(so(Ao(ao(He,0),Ee),de(e[0]==="$"?t:e[0]==="var"?n:e[0]==="let"?o:pn[e[0]]),ot(pn[e[0]])),ur(f=>jo(f,r)),zr)(e),i=typeof i>"u"?[]:i):$r(Object)(e)&&$r(String)(e.var)?i=Er(e.var.split("."))(r):$r(Array)(e)||$r(Object)(e)?i=ur(f=>jo(f,r))(e):i=e;let a=null;return $r(Array)(i)&&$r(String)(i[0])&&i[0]==="[]"?a=zr(i):a=qi(i?.[0])?jo(i,r):i,a},xt=jo;var st=xt.default||xt,vt=e=>{if(typeof e=="string")return e.slice(0,2)==="l$"?["toLower",{var:e.slice(2)}]:e.slice(0,2)==="u$"?["toUpper",{var:e.slice(2)}]:e.slice(0,2)==="o$"?[["complement",["isNil"]],{var:e.slice(2)}]:e.slice(0,2)==="x$"?["isNil",{var:e.slice(2)}]:e.slice(0,2)==="!$"?["not",{var:e.slice(2)}]:e.slice(0,2)==="$$"?Q(e):e[0]==="$"?{var:Q(e)}:e;if(N(Array,e)){if(e[0]==="toBatchAll")return["pipe",["var","batch"],["concat",["__"],["[]",...e[1]]],["let","batch"]];if(e[0]==="toBatch")return["pipe",["var","batch"],["append",["[]",...e[1]]],["let","batch"]];for(let[r,t]of e.entries())e[r]=vt(t)}else if(typeof e=="object")for(let r in e)e[r]=vt(e[r]);return e},ql=(e,r,t)=>{let n=t,o=e.split("#")[0].split(".");for(let[i,a]of o.entries()){if(i===o.length-1){N(Object)(r)&&r._$==="del"?delete n[a]:n[a]=r;break}else y(n[a])&&(n[a]={});n=n[a]}return n},Vi=(e,r)=>{if(N(Array,e))e=z(t=>N(Object,t)?Vi(t,r):t)(e);else if(N(Object,e)){if(N(String,e.var))return Kr(e.var.split("."))(r);e=z(t=>Vi(t,r))(e)}return e};function No(e=[],r={},t={}){let n=ar(e),o=a=>st(vt(ar(a)),r),i=(a,f={})=>{let s=null,u=!1;if(!N(Array,a))s=o(a);else if(/^=\$/.test(a[0]))[s,u]=i(a[1]),u||ql(a[0].replace(/^=\$/,""),s,r);else if(/^.+\(\)$/.test(a[0]))if(!y(t[a[0].slice(0,-2)]))[s,u]=t[a[0].slice(0,-2)](Vi(vt(a[1]),r),r,ql);else throw Error(`unknown function ${a[0]}`);else if(a[0]==="break")u=!0;else if(a[0]==="[]")for(let m of Q(a))i(m);else if(a[0]==="if")if(o(a[1])){if(typeof a[2]>"u")throw Error("wrong fpjson");[s,u]=i(a[2])}else[s,u]=i(a.slice(3),{if:!0});else if(a[0]==="else")if(f.if)[s,u]=i(a[1]);else throw Error("wrong fpjson");else if(a[0]==="elif")if(f.if)o(a[1])?[s,u]=i(a[2]):[s,u]=i(a.slice(3),{if:!0});else throw Error("wrong fpjson");else s=o(a);return[s,u]};for(let a of n){let[f,s]=i(a);if(s)break}}var Vl={split:(e,r,t)=>{let n=null,o=!1,i=ui(e[0],st(e[1],r));if(N(Array,e[2]))for(let[a,f]of i.entries())!y(e[2][a])&&typeof e[2][a]=="string"&&/^=\$.+$/.test(e[2][a])&&t(e[2][a].replace(/^=\$/,""),f,r);return[n,o]},mod:(e,r,t)=>{let n=null,o=!1;for(let i in e)t(`after.${i}`,st(e[i],r),r);return[n,o]},fields:(e,r,t)=>{let n=null,o=!1,i=q(r.req),a=[],f=[];for(let s of e){let u=s.replace(/^\*/,"");a.push(u),/^\*/.test(s)&&f.push(u)}return(cr(i,a).length>0||cr(f,i).length>0)&&(r.allow=!1,o=!0),[n,o]},required_fields:(e,r,t)=>{let n=null,o=!1,i=q(r.req);return cr(e,i).length>0&&(r.allow=!1,o=!0),[n,o]},disallowed_fields:(e,r,t)=>{let n=null,o=!1,i=q(r.req);return Or(i,e).length>0&&(r.allow=!1,o=!0),[n,o]},denyifall:(e,r,t)=>{let n=null,o=!1;return st(["all",["equals",!0],e],r)&&(r.allow=!1,o=!0),[n,o]},denyifany:(e,r,t)=>{let n=null,o=!1;return st(["any",["equals",!0],e],r)&&(r.allow=!1,o=!0),[n,o]},allowifall:(e,r,t)=>{let n=null,o=!1;return st(["all",["equals",!0],e],r)&&(r.allow=!0,o=!0),[n,o]},allow:(e,r,t)=>{let n=null,o=!1;return r.allow=!0,o=!0,[n,o]},deny:(e,r,t)=>{let n=null,o=!1;return r.allow=!1,o=!0,[n,o]},allowifany:(e,r,t)=>{let n=null,o=!1;return st(["any",["equals",!0],e],r)&&(r.allow=!0,o=!0),[n,o]},denyif:(e,r,t)=>{let n=null,o=!1;return st(e,r)&&(r.allow=!1,o=!0),[n,o]},allowif:(e,r,t)=>{let n=null,o=!1;return st(e,r)&&(r.allow=!0,o=!0),[n,o]},breakif:(e,r,t)=>{let n=null,o=!1;return st(e,r)&&(o=!0),[n,o]}};var Ji=class{constructor({order:r=5,sort_fields:t="number",kv:n,prefix:o,onCommit:i}){this.kv=n,this.onCommit=i,this.order=r,this.sort_fields=t,this.max_vals=this.order-1,this.min_vals=Math.ceil(this.order/2)-1,this.prefix=o}addPrefix(r,t){return t?`${t}${r}`:r}get=(r,t,n)=>t?.[r]??this.kv.get(this.addPrefix(r,n??`${this.prefix}/`));put=(r,t,n,o,i)=>{y(n)?this.kv.put(this.addPrefix(r,o??`${this.prefix}/`),t,i):n[r]=t};del=(r,t,n,o)=>{y(t)?this.kv.del(this.addPrefix(r,n??`${this.prefix}/`),o):t[r]={__del__:!0}};putData=(r,t,n)=>{let o={val:t};y(n)?this.put(`data/${r}`,o,n,""):n[`data/${r}`]=o};delData=(r,t)=>{y(t)?this.del(`data/${r}`,t,""):t[`data/${r}`]={__del__:!0}};putNode=(r,t)=>this.put(r.id,r,t);data=(r,t={},n)=>{if(typeof t[r]<"u")return{key:r,val:t[r]?.val??null};let o=`data/${r}`,i=n?.[o]??this.kv.data(r)??null;return t[r]=i,{key:r,val:i?.val??null}};root=r=>this.get("root",r)??null;setRoot=(r,t)=>this.put("root",r,t)??null;isOver=(r,t=0)=>r.vals.length+t>this.max_vals;isUnder=(r,t=0)=>r.vals.length+t<this.min_vals;wrap=(r,t)=>{let n={val:r};return y(r.__id__)||(n.key=r.__id__),y(t)||(n.key=t),n};compArr(r,t){let n=N(Array,r)?r:[r],o=N(Array,t)?t:[t],i=0;for(;;){if(!kr(n[i],o[i]))return n[i]<o[i]?1:-1;if(typeof n[i]>"u"||typeof o[i]>"u")break;i++}return 0}comp(r,t,n=!1,o){if(o??=this.sort_fields,typeof o=="string")return r.val===t.val?0:r.val<t.val?1:-1;for(let i of o){let a=i[0]==="__id__"?r.key:Kr(i[0].split("."),r.val)??null,f=i[0]==="__id__"?t.key:Kr(i[0].split("."),t.val)??null,s=this.compArr(a,f);if(s!==0)return(y(a)?(i[1]==="desc"?-1:1)*(n?-1:1):y(f)?(i[1]==="desc"?-1:1)*(n?1:-1):s===1?1:-1)*(i[1]==="desc"?-1:1)}return 0}id(r){let t=(this.get("count",r)??-1)+1;return this.put("count",t,r),t.toString()}init(r,t){let n={leaf:!0,id:this.id(t),vals:[r],parent:null,next:null,prev:null};this.putNode(n,t),this.setRoot(n.id,t)}search(r,t,n,o=!1){let i=this.get(t??this.root(n)??"0",n);if(y(i))return null;if(i.leaf)return i;let a=0;for(let f of i.vals){if(y(r)||this.comp(r,i.leaf?f:this.wrap(f),o)===1)return this.search(r,i.children[a],n,o);a++}return this.search(r,i.children[a],n,o)}rsearch(r,t,n,o=!1){let i=this.get(t??this.root(n)??"0",n);if(y(i))return null;if(i.leaf)return i;let a=i.vals.length-1;for(;a>=0;){let f=i.vals[a];if(y(r)||this.comp(r,i.leaf?f:this.wrap(f),!o)<=0)return this.rsearch(r,i.children[a+1],n,o);a--}return this.rsearch(r,i.children[0],n,o)}read(r){let t={},n=this.searchByKey(r,t)[0];return{key:r,val:n?.val??null}}getValsReverse(r,t,n=0,o,i={},a=null,f){for(let s=n;s>=0;s--){let u=r.vals[s],m=this.data(u,i,f);if(y(o.endAt)){if(!y(o.endBefore)&&this.comp(m,this.wrap(o.endBefore),!0)>=0)return}else if(this.comp(m,this.wrap(o.endAt))>0)return;if(t.push(m),!y(o.limit)&&t.length===o.limit)return}if(!y(r.prev)){let s=this.get(r.prev,f);this.getValsReverse(s,t,s.vals.length-1,o,i,null,f)}}getVals(r,t,n=0,o,i={},a=null,f){for(let s=n;s<r.vals.length;s++){let u=r.vals[s],m=this.data(u,i,f);if(y(o.endAt)){if(!y(o.endBefore)&&this.comp(m,this.wrap(o.endBefore))<=0)return}else if(this.comp(m,this.wrap(o.endAt),!0)<0)return;if(t.push(m),!y(o.limit)&&t.length===o.limit)return}if(!y(r.next)){let s=this.get(r.next,f);this.getVals(s,t,0,o,i,null,f)}}getValsReverseCursor(r,t,n=0,o,i={},a=null,f){let s=n,u=0;return()=>{let m=null,g=()=>{for(;s>=0;){let l=r.vals[s],c=this.data(l,i,f);if(y(o.endAt)){if(!y(o.endBefore)&&this.comp(c,this.wrap(o.endBefore),!0)>=0){r=null;return}}else if(this.comp(c,this.wrap(o.endAt))>0){r=null;return}if(m=c,!y(o.limit)&&t.length===o.limit){r=null;break}s--;break}y(m)&&(y(r?.prev)?r=null:(r=this.get(r.prev,f),s=r.vals.length-1))};for(;!y(r)&&y(m);)g();return m}}getValsCursor(r,t,n=0,o,i={},a=null,f){let s=n,u=0;return()=>{let m=null,g=()=>{for(;s<r.vals.length;){let l=r.vals[s],c=this.data(l,i,f);if(y(o.endAt)){if(!y(o.endBefore)&&this.comp(c,this.wrap(o.endBefore))<=0){r=null;break}}else if(this.comp(c,this.wrap(o.endAt),!0)<0){r=null;break}if(m=c,u++,!y(o.limit)&&u===o.limit){r=null;break}s++;break}y(m)&&(y(r?.next)?r=null:(r=this.get(r.next,f),s=0))};for(;!y(r)&&y(m);)g();return m}}findIndex(r,t,n,o,i){let a=r,f=!1;if(r===0)f=!y(t.prev);else{r??=t.vals.length;for(let s=r-1;s>=0;s--){let u=this.data(t.vals[s],o,i);if(this.comp(u,n)!==0)break;a=s,s===0&&(f=!y(t.prev))}}if(f){let s=this.get(t.prev,i),[u,m]=this.findIndex(null,s,n,o,i);return y(u)?[r,t]:[u,m]}else return[a,t]}findLastIndex(r,t,n,o,i){let a=null,f=!1;if(r>=t.vals.length-1)f=!y(t.next);else for(let s=r+1;s<t.vals.length;s++){let u=this.data(t.vals[s],o,i);if(this.comp(u,n)!==0){a=s;break}s===t.vals.length-1&&(f=!y(t.next))}if(f){let s=this.get(t.next,i),[u,m]=this.findLastIndex(-1,s,n,o,i);return y(u)?[r,t]:[u,m]}else return[a,t]}findLastGtIndex(r,t,n,o,i){let a=null,f=!1;if(r>=t.vals.length-1)f=!y(t.next);else for(let s=r+1;s<t.vals.length;s++){let u=this.data(t.vals[s],o,i);if(this.comp(u,n)===-1){a=s;break}s===t.vals.length-1&&(f=!y(t.next))}if(f){let s=this.get(t.next,i),[u,m]=this.findLastGtIndex(-1,s,n,o,i);return y(u)?[r,t]:[u,m]}else return[a,t]}findFirstLtIndex(r,t,n,o,i){let a=null,f=!1;if(r<=0)f=!y(t.prev);else for(let s=r-1;s>=0;s--){let u=this.data(t.vals[s],o,i);if(this.comp(u,n,!0)===1){a=s;break}s===0&&(f=!y(t.prev))}if(f){let s=this.get(t.prev,i),[u,m]=this.findFirstLtIndex(s.vals.length,s,n,o,i);return y(u)?[r,t]:[u,m]}else return[a,t]}range(r={},t=!1){r.limit??=1e3,r.limit>1e3&&(r.limit=1e3);let n={},o=r.startAt??r.startAfter;y(o)||(o=this.wrap(o));let i=y(r.startAt)&&!y(r.startAfter),a=this[r.reverse===!0?"rsearch":"search"](o??void 0,void 0,n,i);if(y(a))return t?()=>null:[];let f=[],s={},u=a,g=r.reverse===!0?u.vals.length-1:0;if(r.reverse===!0){if(!y(o)){let[l,c,d]=this.binarySearch(a,o,s,n,!i);if(!y(r.startAt))g=l,y(c)||(g=c);else if(!y(r.startAfter)){if(g=null,!y(c))g=c;else if(!y(l)){let[h,x]=this.findFirstLtIndex(l,a,o,s,n);y(h)||(g=h,u=x)}}}}else if(!y(o)){let[l,c,d]=this.binarySearch(a,o,s,n,i);if(y(r.startAt)){if(!y(r.startAfter))if(g=null,!y(d))g=d;else if(y(l)){if(!y(c)&&!y(a.next)){let h=this.get(a.next,n),[x,w]=this.findLastGtIndex(-1,h,o,s,n);y(x)||(g=x,u=w)}}else{let[h,x]=this.findLastIndex(l,a,o,s,n);y(h)||(g=h,u=x)}}else if(g=l,!y(d))g=d;else if(y(l)){if(!y(c)&&!y(a.next)){let h=this.get(a.next,n),[x,w]=this.findLastGtIndex(-1,h,o,s,n);y(x)||(g=x,u=w)}}else{let[h,x]=this.findIndex(g,a,o,s,n);y(h)||(g=h,u=x)}}return t?this[`getVals${r.reverse===!0?"Reverse":""}Cursor`](u,f,g,r,s,null,n):(y(g)||this[`getVals${r.reverse===!0?"Reverse":""}`](u,f,g,r,s,null,n),f)}searchByKey(r,t){let n=this.data(r,void 0,t);if(y(n.val))return[null,null,null];let o=this.search(n,void 0,t);return y(o)?[n,null,null]:[n,...this.searchNode(o,r,n,!0,void 0,t)]}binarySearch(r,t,n={},o,i){let a=0,f=r.vals.length-1;for(;a<=f;){let s=Math.floor((a+f)/2),u=this.data(r.vals[s],n,o);if(this.comp(u,t,i)===0)return[s,null,null];this.comp(u,t,i)===1?a=s+1:f=s-1}return[null,f>=0?f:null,a<r.vals.length?a:null]}searchNode(r,t,n,o=!1,i={},a){let f=0,s=null,u=null;o&&([f,u,s]=this.binarySearch(r,n,i,a));let m=f===0;if(f===null)return[null,null];if(f>0)for(let g=f-1;g>=0;g--){let l=r.vals[g];if(l===t)return[g,r];let c=this.data(l,i,a);if(this.comp(c,n)===1)break;g===0&&(m=!0)}for(let g=0;g<r.vals.length;g++){let l=r.vals[g];if(l===t)return[g,r];let c=this.data(l,i,a);if(this.comp(n,c)===1){if(m)break;return[null,null]}}return m&&!y(r.prev)?this.searchNode(this.get(r.prev,a),t,n,!1,i,a):[null,null]}rmIndex(r,t,n,o){if(n.vals.splice(r,1),n.children.splice(t,1),n.vals.length===0||!y(n.parent)&&this.isUnder(n))if(y(n.parent)){if(n.vals.length===0){let i=null;for(let a of n.children){let f=this.get(a,o);f.parent=null,i=a,this.putNode(f,o)}this.root(o)===n.id&&(this.setRoot(i,o),this.del(n.id,o))}}else{let i=this.get(n.parent,o),a=kt(n.id,i.children),f=!1,s=a>0,u=a+1<i.children.length,m=null,g=null;if(s&&(m=this.get(i.children[a-1],o),!this.isUnder(m,-1))){n.vals.unshift(i.vals[a-1]),n.children.unshift(m.children.pop()),i.vals[a-1]=m.vals.pop(),this.putNode(n,o),this.putNode(m,o),this.putNode(i,o);let l=this.get(n.children[0],o);l.parent=n.id,this.putNode(l,o),f=!0}if(!f&&u&&(g=this.get(i.children[a+1],o),!this.isUnder(g,-1))){n.vals.push(i.vals[a]),n.children.push(g.children.shift()),i.vals[a]=g.vals.shift(),this.putNode(n,o),this.putNode(g,o),this.putNode(i,o);let l=this.get(Kt(n.children),o);l.parent=n.id,this.putNode(l,o),f=!0}if(!f&&s&&!this.isOver(m,n.vals.length+1)){m.children=Ir(m.children,n.children);for(let l of n.children){let c=this.get(l,o);c.parent=m.id,this.putNode(c,o)}if(m.vals.push(i.vals[a-1]),m.vals=Ir(m.vals,n.vals),m.next=n.next||null,!y(n.next)){let l=this.get(n.next,o);l.prev=n.prev||null,this.putNode(l,o)}this.putNode(m,o),this.rmIndex(a-1,a,i,o),f=!0}if(!f&&u&&!this.isOver(g,n.vals.length+1)){g.children=Ir(n.children,g.children);for(let l of n.children){let c=this.get(l,o);c.parent=g.id,this.putNode(c,o)}if(g.vals.unshift(i.vals[a]),g.vals=Ir(n.vals,g.vals),g.prev=n.prev||null,!y(n.prev)){let l=this.get(n.prev,o);l.next=n.next||null,this.putNode(l,o)}this.putNode(g,o),this.rmIndex(a,a,i,o),f=!0}}else this.putNode(n,o)}updateIndexes(r,t,n,o,i){if(r===0&&!y(t.parent)){let a=this.get(t.parent,i);if(y(a))return;let f=kt(t.id,a.children);if(t.leaf)if(t.vals.length>0)n=this.pick(this.data(t.vals[0],void 0,i));else{if(y(t.next))return;{let s=this.get(t.next,i);n=this.pick(this.data(s.vals[0],void 0,i))}}kr(n,o)&&f>0?(a.vals[f-1]=n,this.putNode(a,i)):n!==o&&f>0?(a.vals[f-1]=n,this.putNode(a,i)):f===0&&this.updateIndexes(0,a,n,o,i)}}balance(r,t,n,o){let i=n,a=t;if(this.isUnder(n))if(y(n.parent))n.vals.length===0&&(this.setRoot(null,o),this.del(n.id,o));else{let f=this.get(n.parent,o),s=kt(n.id,f.children),u=!1,m=s>0,g=s+1<f.children.length,l=null,c=null;if(m&&(l??=this.get(f.children[s-1],o),this.isUnder(l,-1)||(u=!0,n.vals.unshift(l.vals.pop()),f.vals[s-1]=this.pick(this.data(n.vals[0],void 0,o)),this.putNode(l,o),this.putNode(n,o))),!u&&g&&(c??=this.get(f.children[s+1],o),this.isUnder(c,-1)||(u=!0,n.vals.push(c.vals.shift()),f.vals[s]=this.pick(this.data(c.vals[0],void 0,o)),this.putNode(c,o),this.putNode(n,o))),!u&&m&&!this.isOver(l,n.vals.length)){if(l.vals=Ir(l.vals,n.vals),l.next=n.next??null,!y(n.prev)&&!y(n.next)){let d=this.get(n.next,o);d.prev=n.prev,this.putNode(d,o)}this.putNode(l,o),this.rmIndex(s-1,s,f,o),this.del(n.id,o),u=!0}if(!u&&g&&!this.isOver(c,n.vals.length)){if(c.vals=Ir(n.vals,c.vals),c.prev=n.prev??null,!y(n.prev)&&!y(n.next)){let d=this.get(n.prev,o);d.next=n.next,this.putNode(d,o)}i=c,a=0,this.putNode(c,o),this.rmIndex(s,s,f,o),this.del(n.id,o),u=!0}this.putNode(f,o)}this.updateIndexes(a,i,null,r,o)}delete(r,t=!1){let n={},[o,i,a]=this.searchByKey(r,n);y(a)||(a.vals=Tr([r],a.vals),this.putNode(a,n),this.delData(r,n),this.balance(o,i,a,n),this.commit(n,t))}_insert(r,t,n,o){let i=0,a=!1;for(let f of n.vals){if(this.comp(t,this.data(f,void 0,o))>=0){n.vals.splice(i,0,r),a=!0;break}i+=1}a||n.vals.push(r)}insert(r,t,n=!1){if(t===null)return;let o={};this.putData(r,t,o);let i={key:r,val:t},a=this.search(i,void 0,o);y(a)?this.init(r,o):(this._insert(r,i,a,o),this.putNode(a,o),this.isOver(a)&&this.split(a,o)),this.commit(o,n)}commit(r,t=!1){for(let n in r){if(n.match(/^data\//))continue;let o=`${this.prefix}/`;r[n]?.__del__?t?t&&this.del(n,void 0,o,!0):this.del(n,void 0,o):t?t&&this.put(n,r[n],void 0,o,!0):this.put(n,r[n],void 0,o)}y(this.onCommit)||this.onCommit(r)}splitChildren(r,t,n){if(!r.leaf){let o=In(r.vals.length+1,r.children);r.children=o[0],t.children=o[1];for(let i of o[1]){let a=this.get(i,n);a.parent=t.id,this.putNode(a,n)}}}_split(r,t){let n=In(Math.ceil(r.vals.length/2))(r.vals);r.vals=r.leaf?n[0]:dt(n[0]);let o={leaf:r.leaf,id:this.id(t),vals:n[1],prev:r.id,next:r.next??null};if(!y(r.next)){let a=this.get(r.next,t);a.prev=o.id,this.putNode(a,t)}r.next=o.id;let i=r.leaf?n[1][0]:Kt(n[0]);return this.splitChildren(r,o,t),[r.leaf?this.data(i,void 0,t):i,o]}getParent(r,t,n,o){let i=y(r.parent),a=i?{leaf:!1,id:this.id(o),vals:[n],children:[r.id,t.id]}:this.get(r.parent,o);if(!i){let f=kt(r.id,a.children);a.vals.splice(f,0,n),a.children.splice(f+1,0,t.id)}return[i,a]}pick(r){if(typeof this.sort_fields=="string")return r.val;{let t={};for(let n of rt(0)(this.sort_fields))t[n]=n==="__id__"?r.key:r.val[n]??null;return t}}split(r,t){let[n,o]=this._split(r,t),[i,a]=this.getParent(r,o,r.leaf?this.pick(n):n,t);o.parent=a.id,r.parent=a.id,this.putNode(o,t),this.putNode(a,t),this.putNode(r,t),i&&this.setRoot(a.id,t),this.isOver(a)&&this.split(a,t)}},ir=Ji;var Nv=function(e){function r(x,w){var _,v,k,S,E;return k=x&2147483648,S=w&2147483648,_=x&1073741824,v=w&1073741824,E=(x&1073741823)+(w&1073741823),_&v?E^2147483648^k^S:_|v?E&1073741824?E^3221225472^k^S:E^1073741824^k^S:E^k^S}function t(x,w,_,v,k,S,E){return x=r(x,r(r(w&_|~w&v,k),E)),r(x<<S|x>>>32-S,w)}function n(x,w,_,v,k,S,E){return x=r(x,r(r(w&v|_&~v,k),E)),r(x<<S|x>>>32-S,w)}function o(x,w,_,v,k,S,E){return x=r(x,r(r(w^_^v,k),E)),r(x<<S|x>>>32-S,w)}function i(x,w,_,v,k,S,E){return x=r(x,r(r(_^(w|~v),k),E)),r(x<<S|x>>>32-S,w)}function a(x){var w="",_="",v;for(v=0;3>=v;v++)_=x>>>8*v&255,_="0"+_.toString(16),w+=_.substr(_.length-2,2);return w}var f=[],s,u,m,g,l,c,d,h;for(e=(function(x){x=x.replace(/\r\n/g,`
`);for(var w="",_=0;_<x.length;_++){var v=x.charCodeAt(_);128>v?w+=String.fromCharCode(v):(127<v&&2048>v?w+=String.fromCharCode(v>>6|192):(w+=String.fromCharCode(v>>12|224),w+=String.fromCharCode(v>>6&63|128)),w+=String.fromCharCode(v&63|128))}return w})(e),f=(function(x){var w,_=x.length;w=_+8;for(var v=16*((w-w%64)/64+1),k=Array(v-1),S=0,E=0;E<_;)w=(E-E%4)/4,S=E%4*8,k[w]|=x.charCodeAt(E)<<S,E++;return w=(E-E%4)/4,k[w]|=128<<E%4*8,k[v-2]=_<<3,k[v-1]=_>>>29,k})(e),l=1732584193,c=4023233417,d=2562383102,h=271733878,e=0;e<f.length;e+=16)s=l,u=c,m=d,g=h,l=t(l,c,d,h,f[e+0],7,3614090360),h=t(h,l,c,d,f[e+1],12,3905402710),d=t(d,h,l,c,f[e+2],17,606105819),c=t(c,d,h,l,f[e+3],22,3250441966),l=t(l,c,d,h,f[e+4],7,4118548399),h=t(h,l,c,d,f[e+5],12,1200080426),d=t(d,h,l,c,f[e+6],17,2821735955),c=t(c,d,h,l,f[e+7],22,4249261313),l=t(l,c,d,h,f[e+8],7,1770035416),h=t(h,l,c,d,f[e+9],12,2336552879),d=t(d,h,l,c,f[e+10],17,4294925233),c=t(c,d,h,l,f[e+11],22,2304563134),l=t(l,c,d,h,f[e+12],7,1804603682),h=t(h,l,c,d,f[e+13],12,4254626195),d=t(d,h,l,c,f[e+14],17,2792965006),c=t(c,d,h,l,f[e+15],22,1236535329),l=n(l,c,d,h,f[e+1],5,4129170786),h=n(h,l,c,d,f[e+6],9,3225465664),d=n(d,h,l,c,f[e+11],14,643717713),c=n(c,d,h,l,f[e+0],20,3921069994),l=n(l,c,d,h,f[e+5],5,3593408605),h=n(h,l,c,d,f[e+10],9,38016083),d=n(d,h,l,c,f[e+15],14,3634488961),c=n(c,d,h,l,f[e+4],20,3889429448),l=n(l,c,d,h,f[e+9],5,568446438),h=n(h,l,c,d,f[e+14],9,3275163606),d=n(d,h,l,c,f[e+3],14,4107603335),c=n(c,d,h,l,f[e+8],20,1163531501),l=n(l,c,d,h,f[e+13],5,2850285829),h=n(h,l,c,d,f[e+2],9,4243563512),d=n(d,h,l,c,f[e+7],14,1735328473),c=n(c,d,h,l,f[e+12],20,2368359562),l=o(l,c,d,h,f[e+5],4,4294588738),h=o(h,l,c,d,f[e+8],11,2272392833),d=o(d,h,l,c,f[e+11],16,1839030562),c=o(c,d,h,l,f[e+14],23,4259657740),l=o(l,c,d,h,f[e+1],4,2763975236),h=o(h,l,c,d,f[e+4],11,1272893353),d=o(d,h,l,c,f[e+7],16,4139469664),c=o(c,d,h,l,f[e+10],23,3200236656),l=o(l,c,d,h,f[e+13],4,681279174),h=o(h,l,c,d,f[e+0],11,3936430074),d=o(d,h,l,c,f[e+3],16,3572445317),c=o(c,d,h,l,f[e+6],23,76029189),l=o(l,c,d,h,f[e+9],4,3654602809),h=o(h,l,c,d,f[e+12],11,3873151461),d=o(d,h,l,c,f[e+15],16,530742520),c=o(c,d,h,l,f[e+2],23,3299628645),l=i(l,c,d,h,f[e+0],6,4096336452),h=i(h,l,c,d,f[e+7],10,1126891415),d=i(d,h,l,c,f[e+14],15,2878612391),c=i(c,d,h,l,f[e+5],21,4237533241),l=i(l,c,d,h,f[e+12],6,1700485571),h=i(h,l,c,d,f[e+3],10,2399980690),d=i(d,h,l,c,f[e+10],15,4293915773),c=i(c,d,h,l,f[e+1],21,2240044497),l=i(l,c,d,h,f[e+8],6,1873313359),h=i(h,l,c,d,f[e+15],10,4264355552),d=i(d,h,l,c,f[e+6],15,2734768916),c=i(c,d,h,l,f[e+13],21,1309151649),l=i(l,c,d,h,f[e+4],6,4149444226),h=i(h,l,c,d,f[e+11],10,3174756917),d=i(d,h,l,c,f[e+2],15,718787259),c=i(c,d,h,l,f[e+9],21,3951481745),l=r(l,s),c=r(c,u),d=r(d,m),h=r(h,g);return(a(l)+a(c)+a(d)+a(h)).toLowerCase()},Ar=Nv;var tr=["__id__","asc"],K=100,Jl=(e,r)=>{let t=[tr],n=`${M(er("/"),fr)(t)}`,o=new ir({order:K,sort_fields:t,kv:r,prefix:n});return r.get("indexes")||{}},Xl=e=>{let r=0;for(let t of e){if(t[1]==="array"){if(r!==0)return!1}else if(!sr(t[1],["asc","desc"]))return!1;r++}return!(e.length===0||e.length===1&&e[0][0].split(".").length<2)},Ie=(e,r,t,n=!1)=>{for(let o in e)n||r.push(mt(o,t).join(".")),N(Object,e[o])&&!N(Array,e[o])&&Ie(e[o],r,mt(o,t))},Hl=(e,r,t)=>{if(e=z(u=>u.length>1?u:mt("asc",u))(e),!Xl(e))return;let n=`${M(er("/"),fr)([tr])}`,o=new ir({order:K,sort_fields:[tr],kv:t,prefix:n}),i=t.get("indexes")||{},a=z(er("/"))(e).join("/");if(!y(i[a]))return;let f=o.range(),s=M(Tr(["__id__"]),z(u=>u[0]))(e);if(e[0][1]==="array"){let u={},m={};for(let g of f){let l=q(g.val),c=cr(s,l);if(s.length>0&&c.length===0&&N(Array,g.val[s[0]]))for(let d of g.val[s[0]]){let h=`${M(er("/"),fr)(Q(e))}`,x=Ar(JSON.stringify(d)),_=`${`${e[0][0]}/array:${x}`}/${h}`,v=null,k=`${e[0][0]}/array:${x}/${z(S=>S.join("/"))(Q(e)).join("/")}`;y(m[x])?(u[x]={order:K,key:k},v=new ir({order:K,sort_fields:[...Q(e),tr],kv:t,prefix:_})):v=m[x],v.insert(g.key,g.val,!0)}}i[a]={key:a,items:u}}else{i[a]={order:K,key:a};let u=`${M(er("/"),fr)(e)}`,m=new ir({order:K,sort_fields:[...e,tr],kv:t,prefix:u});for(let g of f){let l=q(g.val);Ie(g.val,l,[],!0);let c=cr(s,l);s.length>0&&c.length===0&&m.insert(g.key,g.val,!0)}}t.put("indexes",i)},Kl=(e,r,t)=>{if(e=z(u=>u.length>1?u:mt("asc",u))(e),!Xl(e))return;let n=`${M(er("/"),fr)([tr])}`,o=new ir({order:K,sort_fields:[tr],kv:t,prefix:n}),i=t.get("indexes")||{},a=z(er("/"))(e).join("/");if(y(i[a]))return;let f=o.range(),s=M(Tr(["__id__"]),z(u=>u[0]))(e);if(e[0][1]==="array"){let u={},m={};for(let g of f){let l=q(g.val),c=cr(s,l);if(s.length>0&&c.length===0&&N(Array,g.val[s[0]]))for(let d of g.val[s[0]]){let h=`${M(er("/"),fr)(Q(e))}`,x=Ar(JSON.stringify(d)),_=`${`${e[0][0]}/array:${x}`}/${h}`,v=null,k=`${e[0][0]}/array:${x}/${z(S=>S.join(":"))(Q(e)).join("/")}`;y(m[x])?(u[x]={order:K,key:k},v=new ir({order:K,sort_fields:[...Q(e),tr],kv:t,prefix:_})):v=m[x],v.delete(g.key,!0)}}}else{let u=`${M(er("/"),fr)(e)}`,m=new ir({order:K,sort_fields:[...e,tr],kv:t,prefix:u});for(let g of f){let l=q(g.val);Ie(g.val,l,[],!0);let c=cr(s,l);s.length>0&&c.length===0&&m.delete(g.key,!0)}}delete i[a],t.put("indexes",i)},Xi=(e,r,t)=>{let n=[tr],o=`${M(er("/"),fr)(n)}`,i=new ir({order:K,sort_fields:[...n,tr],kv:t,prefix:o}),a=i.data(e),f=a.val,s=t.get("indexes")||{};for(let u in s){let m=q(f),g=Fr(2,u.split("/")),l=M(Tr(["__id__"]),z(d=>d[0]),Fr(2))(u.split("/")),c=cr(l,m);if(l.length>0&&c.length===0)if(g[0][1]==="array"){if(N(Array,f[g[0][0]]))for(let d of f[g[0][0]]){let h=Ar(JSON.stringify(d)),x=Fr(2,u.split("/")),w=`${x[0][0]}/array:${h}`;if(x.length>1&&(w+=`/${z(E=>E.join("/"))(Q(x)).join("/")}`),y(s[u].items[h]))continue;let v=`${x[0][0]}/array:${h}`,k=x.length===1?[tr]:Q(x);x.length>1&&(v+="/"+M(er("/"),fr)(Q(x))),new ir({order:K,sort_fields:[...k,tr],kv:t,prefix:v}).delete(e,!0)}}else{let d=Fr(2,u.split("/")),h=`${M(er("/"),fr)(d)}`;new ir({order:K,sort_fields:[...d,tr],kv:t,prefix:h}).delete(e,!0)}}return i.delete(e),t.delData(e),{before:a,after:{key:e,val:null,setter:null}}},Pv=(e,r)=>{let t=[],n=[],o=[];e??={},r??={};let i=M(Sr,fr,z(q))([e,r]);for(let a of i)if(!kr(e[a],r[a])){if(y(e[a])){if(o.push(a),N(Array,r[a]))for(let f of r[a])o.push(`${a}/array:${Ar(JSON.stringify(f))}`)}else if(y(r[a])){if(t.push(a),N(Array,e[a]))for(let f of e[a])t.push(`${a}/array:${Ar(JSON.stringify(f))}`)}else if(n.push(a),N(Array,e[a])&&N(Array,r[a])){let f=En(Sr,cr(r[a]))(e[a]),s=En(Sr,cr(e[a]))(r[a]);for(let u of f)o.push(`${a}/array:${Ar(JSON.stringify(u))}`);for(let u of s)t.push(`${a}/array:${Ar(JSON.stringify(u))}`)}else if(N(Array,e[a]))for(let f of Sr(e[a]))t.push(`${a}/array:${Ar(JSON.stringify(f))}`);else if(N(Array,r[a]))for(let f of Sr(r[a]))o.push(`${a}/array:${Ar(JSON.stringify(f))}`)}return{dels:t,changes:n,news:o}},Wv=(e,r,t,n,o)=>{let{dels:i,changes:a,news:f}=Pv(t.val,e),s=o.get("indexes")||{},u=ar(s),m={};for(let c of i){let d=c.split("/"),h=d[1]?.split(":")[0]==="array",x=h?c:`${c}/asc`,w=h?`${d[0]}/${d[1]}`:`${c}/asc`;m[x]=!0;let _=h?[tr]:[[c,"asc"],tr];new ir({order:K,sort_fields:_,kv:o,prefix:w}).delete(r,!0)}for(let c of f){let d=c.split("/"),h=d[1]?.split(":")[0]==="array",x=h?c:`${c}/asc`,w=h?`${d[0]}/${d[1]}`:`${c}/asc`;if(m[x]=!0,h){let _=`${d[0]}/array`,v=d[1].split(":")[1]??null;y(u[_])&&(u[_]={key:_,items:{}}),!y(v)&&y(u[_].items[v])&&(u[_].items[v]={key:x,order:K});let k=Fr(2,c.split("/")),S=k.length===1?[tr]:[...Q(k),tr];k.length>1&&(w+="/"+M(er("/"),fr)(Q(k))),new ir({order:K,sort_fields:k,kv:o,prefix:w}).insert(r,e,!0)}else{y(u[x])&&(u[x]={order:K,key:x});let _=[[c,"asc"],tr];new ir({order:K,sort_fields:_,kv:o,prefix:w}).insert(r,e,!0)}}o.put("indexes",u);let g=q(e);Ie(e,g,[],!0);let l=q(t.val);Ie(t.val,l,[],!0);for(let c in u)if(y(m[c])){let d=Fr(2,c.split("/")),h=M(Tr(["__id__"]),z(x=>x[0]),Fr(2))(c.split("/"));if(h.length>0){if(d[0][1]==="array"){let _=d[0][0],v=N(Array,e[_])?M(Sr,z(R=>Ar(JSON.stringify(R))))(e[_]):[],k=N(Array,t.val[_])?M(Sr,z(R=>Ar(JSON.stringify(R))))(t.val[_]):[],S=cr(v,k),E=cr(k,v),P=Or(k,v),$=Tr([_])(g),O=Tr([_])(l),U=Tr([_])(h),L=cr(U,$),F=cr(U,O);if(L.length===0||F.length===0){let R=!1,X=!1;Or(U,f).length>0&&(R=!0),Or(U,a).length>0&&(X=!0,R=!0),Or(U,i).length>0&&(X=!0,R=!1);let mr=R&&X?"change":R?"add":X?"del":"same",yr=[],xr=[],_t=[];for(let nr of S)yr.push(nr);for(let nr of E)xr.push(nr);for(let nr of P)mr==="add"?yr.push(nr):mr==="del"?xr.push(nr):mr==="change"&&_t.push(nr);let Br=z(er("/"))(Q(d)).join("/"),se=nr=>`${_}/array:${nr}/${Br}`,ea=nr=>`${_}/array:${nr}/${M(er("/"),fr)(Q(d))}`,na=nr=>nr.insert(r,e,!0),oa=nr=>nr.delete(r,!0),To=nr=>new ir({order:K,sort_fields:[...Q(d),tr],kv:o,prefix:ea(nr)});for(let nr of yr){let hn=se(nr);na(To(nr)),y(u[c].items[nr])&&(u[c].items[nr]={key:hn,order:K})}for(let nr of xr)oa(To(nr));for(let nr of _t){let hn=To(nr);oa(hn),na(hn)}}}let x=cr(h,g),w=cr(h,l);if(x.length===0||w.length===0){let _=!1,v=!1;Or(h,f).length>0&&(_=!0),Or(h,a).length>0&&(v=!0,_=!0),Or(h,i).length>0&&(v=!0,_=!1);for(let k of h){let S=k.split(".");if(S.length>1){let E=Kr(S,e),P=Kr(S,t.val);if(!kr(E,P)){y(P)||(v=!0),y(E)||(_=!0);break}}}if(v){let k=`${M(er("/"),fr)(d)}`;new ir({order:K,sort_fields:[...d,tr],kv:o,prefix:k}).delete(r,!0)}if(_){let k=Fr(2,c.split("/")),S=`${M(er("/"),fr)(k)}`;new ir({order:K,sort_fields:[...k,tr],kv:o,prefix:S}).insert(r,e,!0)}}}}return o.putData(r,e),{before:t,after:{key:r,val:e}}},Gl=(e,r,t,n,o=!1)=>{let i=`${M(er("/"),fr)([tr])}`,a=new ir({order:K,sort_fields:[tr],kv:n,prefix:i}),f=a.data(r);if(!y(f?.val))if(o)Xi(r,t,n);else return Wv(e,r,f,a,n);n.putData(r,e),a.insert(r,e,!1);let s=n.get("indexes")||{},u=ar(s),m="__id__/asc";y(u[m])&&(u[m]={order:K,key:m});for(let l in e){let c=`${l}/asc`;if(y(s[c])&&(u[c]={order:K,key:c}),new ir({order:K,sort_fields:[[l,"asc"],tr],kv:n,prefix:c}).insert(r,e,!0),N(Array,e[l]))for(let h of Sr(e[l])){let x=`${l}/array`,w=Ar(JSON.stringify(h)),_=`${x}:${w}`;y(u[x])&&(u[x]={key:x,items:{}}),y(u[x].items[w])&&(u[x].items[w]={order:K,key:_}),new ir({order:K,sort_fields:[tr],kv:n,prefix:`${l}/array:${Ar(JSON.stringify(h))}`,onCommit:function(k){}}).insert(r,e,!0)}}let g=q(e);Ie(e,g,[],!0);for(let l in s){let c=M(Tr(["__id__"]),z(x=>x[0]),Fr(2))(l.split("/")),d=cr(c,g);if((c.length>1||c.length===1&&c[0].split(".").length>1)&&d.length===0){let x=Fr(2,l.split("/"));if(x[0][1]==="array"){if(!N(Array,e[x[0][0]]))continue;for(let w of e[x[0][0]]){let _=`${M(er("/"),fr)(Q(x))}`,v=Ar(JSON.stringify(w)),S=`${`${x[0][0]}/array:${v}`}/${_}`,E=`${x[0][0]}/array:${v}/${z($=>$.join("/"))(Q(x)).join("/")}`,P=new ir({order:K,sort_fields:[...Q(x),tr],kv:n,prefix:S});y(u[l].items[v])&&(u[l].items[v]={order:K,key:E}),P.insert(r,e,!0)}}else{let w=`${M(er("/"),fr)(x)}`;new ir({order:K,sort_fields:[...x,tr],kv:n,prefix:w}).insert(r,e,!0)}}}return n.put("indexes",u),{before:f,after:{key:r,val:e}}};function zv(e){for(var r=[],t=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?r[t++]=o:o<2048?(r[t++]=o>>6|192,r[t++]=o&63|128):(o&64512)==55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)==56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++n)&1023),r[t++]=o>>18|240,r[t++]=o>>12&63|128,r[t++]=o>>6&63|128,r[t++]=o&63|128):(r[t++]=o>>12|224,r[t++]=o>>6&63|128,r[t++]=o&63|128)}return new Uint8Array(r)}function Hi(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Cv(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function tc(e,...r){if(!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(r.length>0&&!r.includes(e.length))throw new TypeError(`Expected Uint8Array of length ${r}, not of length=${e.length}`)}function Lv(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hi(e.outputLen),Hi(e.blockLen)}function Rv(e,r=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(r&&e.finished)throw new Error("Hash#digest() has already been called")}function Mv(e,r){tc(e);let t=r.outputLen;if(e.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var ae={number:Hi,bool:Cv,bytes:tc,hash:Lv,exists:Rv,output:Mv};function Dv(e){if(typeof e!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof e}`);return zv(e)}function ec(e){if(typeof e=="string"&&(e=Dv(e)),!(e instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof e})`);return e}function Tv(e){let r=n=>e().update(ec(n)).digest(),t=e();return r.outputLen=t.outputLen,r.blockLen=t.blockLen,r.create=()=>e(),r}var Po=BigInt(2**32-1),Ki=BigInt(32);function nc(e,r=!1){return r?{h:Number(e&Po),l:Number(e>>Ki&Po)}:{h:Number(e>>Ki&Po)|0,l:Number(e&Po)|0}}function Uv(e,r=!1){let t=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let o=0;o<e.length;o++){let{h:i,l:a}=nc(e[o],r);[t[o],n[o]]=[i,a]}return[t,n]}var Zv=(e,r)=>BigInt(e>>>0)<<Ki|BigInt(r>>>0),qv=(e,r,t)=>e>>>t,Vv=(e,r,t)=>e<<32-t|r>>>t,Jv=(e,r,t)=>e>>>t|r<<32-t,Xv=(e,r,t)=>e<<32-t|r>>>t,Hv=(e,r,t)=>e<<64-t|r>>>t-32,Kv=(e,r,t)=>e>>>t-32|r<<64-t,Gv=(e,r)=>r,Qv=(e,r)=>e,Yv=(e,r,t)=>e<<t|r>>>32-t,r0=(e,r,t)=>r<<t|e>>>32-t,t0=(e,r,t)=>r<<t-32|e>>>64-t,e0=(e,r,t)=>e<<t-32|r>>>64-t;function n0(e,r,t,n){let o=(r>>>0)+(n>>>0);return{h:e+t+(o/2**32|0)|0,l:o|0}}var o0=(e,r,t)=>(e>>>0)+(r>>>0)+(t>>>0),i0=(e,r,t,n)=>r+t+n+(e/2**32|0)|0,a0=(e,r,t,n)=>(e>>>0)+(r>>>0)+(t>>>0)+(n>>>0),f0=(e,r,t,n,o)=>r+t+n+o+(e/2**32|0)|0,s0=(e,r,t,n,o)=>(e>>>0)+(r>>>0)+(t>>>0)+(n>>>0)+(o>>>0),u0=(e,r,t,n,o,i)=>r+t+n+o+i+(e/2**32|0)|0,dn={fromBig:nc,split:Uv,toBig:Zv,shrSH:qv,shrSL:Vv,rotrSH:Jv,rotrSL:Xv,rotrBH:Hv,rotrBL:Kv,rotr32H:Gv,rotr32L:Qv,rotlSH:Yv,rotlSL:r0,rotlBH:t0,rotlBL:e0,add:n0,add3L:o0,add3H:i0,add4L:a0,add4H:f0,add5H:u0,add5L:s0},[oc,ic,ac]=[[],[],[]],l0=BigInt(0),mn=BigInt(1),c0=BigInt(2),p0=BigInt(7),m0=BigInt(256),d0=BigInt(113);for(let e=0,r=mn,t=1,n=0;e<24;e++){[t,n]=[n,(2*t+3*n)%5],oc.push(2*(5*n+t)),ic.push((e+1)*(e+2)/2%64);let o=l0;for(let i=0;i<7;i++)r=(r<<mn^(r>>p0)*d0)%m0,r&c0&&(o^=mn<<(mn<<BigInt(i))-mn);ac.push(o)}var[h0,y0]=dn.split(ac,!0),Ql=(e,r,t)=>t>32?dn.rotlBH(e,r,t):dn.rotlSH(e,r,t),Yl=(e,r,t)=>t>32?dn.rotlBL(e,r,t):dn.rotlSL(e,r,t),g0=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));function x0(e,r=24){let t=new Uint32Array(10);for(let n=24-r;n<24;n++){for(let a=0;a<10;a++)t[a]=e[a]^e[a+10]^e[a+20]^e[a+30]^e[a+40];for(let a=0;a<10;a+=2){let f=(a+8)%10,s=(a+2)%10,u=t[s],m=t[s+1],g=Ql(u,m,1)^t[f],l=Yl(u,m,1)^t[f+1];for(let c=0;c<50;c+=10)e[a+c]^=g,e[a+c+1]^=l}let o=e[2],i=e[3];for(let a=0;a<24;a++){let f=ic[a],s=Ql(o,i,f),u=Yl(o,i,f),m=oc[a];o=e[m],i=e[m+1],e[m]=s,e[m+1]=u}for(let a=0;a<50;a+=10){for(let f=0;f<10;f++)t[f]=e[a+f];for(let f=0;f<10;f++)e[a+f]^=~t[(f+2)%10]&t[(f+4)%10]}e[0]^=h0[n],e[1]^=y0[n]}t.fill(0)}var Gi=class{clone(){return this._cloneInto()}},Qi=class e extends Gi{constructor(r,t,n,o=!1,i=24){if(super(),this.blockLen=r,this.suffix=t,this.outputLen=n,this.enableXOF=o,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ae.number(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=g0(this.state)}keccak(){x0(this.state32,this.rounds),this.posOut=0,this.pos=0}update(r){ae.exists(this);let{blockLen:t,state:n}=this;r=ec(r);let o=r.length;for(let i=0;i<o;){let a=Math.min(t-this.pos,o-i);for(let f=0;f<a;f++)n[this.pos++]^=r[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:r,suffix:t,pos:n,blockLen:o}=this;r[n]^=t,(t&128)!==0&&n===o-1&&this.keccak(),r[o-1]^=128,this.keccak()}writeInto(r){ae.exists(this,!1),ae.bytes(r),this.finish();let t=this.state,{blockLen:n}=this;for(let o=0,i=r.length;o<i;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,i-o);r.set(t.subarray(this.posOut,this.posOut+a),o),this.posOut+=a,o+=a}return r}xofInto(r){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(r)}xof(r){return ae.number(r),this.xofInto(new Uint8Array(r))}digestInto(r){if(ae.output(r,this),this.finished)throw new Error("digest() was already called");return this.writeInto(r),this.destroy(),r}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(r){let{blockLen:t,suffix:n,outputLen:o,rounds:i,enableXOF:a}=this;return r||(r=new e(t,n,o,a,i)),r.state32.set(this.state32),r.pos=this.pos,r.posOut=this.posOut,r.finished=this.finished,r.rounds=i,r.suffix=n,r.outputLen=o,r.enableXOF=a,r.destroyed=this.destroyed,r}},v0=(e,r,t)=>Tv(()=>new Qi(r,e,t)),rc=v0(1,136,256/8);function _0(e){return r=>(ae.bytes(r),e(r))}var w0=()=>{let e=_0(rc);return e.create=rc.create,e},fc=w0();var A0=xt.default||xt;function zo(e){let{state:r}=e;return r.op=r.query[0],r.opcode=r.op.split(":")[0],r.operand=r.op.split(":")[1]??null,arguments[0]}function pc({state:{query:e,signer:r,id:t},msg:n,env:{kv:o,info:{id:i,i:a,hashpath:f,ts:s}}}){if(i)throw Error("already initialized");if(!e[0].schema)throw Error("schema is missing");if(!e[0].auth)throw Error("auth is missing");let u={},m=-1;for(let g of e[0].auth)u[g[0]]=++m,o.put("_config",`auth_0_${m}`,{rules:g});return o.put("_","_",{auth:u,triggers:{},index:0,auth_index:m}),o.put("_","_config",{index:1,schema:{type:"object",additionalProperties:!1},auth:[]}),o.put("_config","info",{dirs:3,hashpath:f,i:a,id:t,owner:r,ts:s,max_doc_id:168,max_dir_id:8,max_doc_size:256}),o.put("_","_accounts",{index:2,schema:{type:"object",additionalProperties:!1},auth:[]}),o.put("_config","schema_0",e[0].schema),arguments[0]}function b0(e,r){let t=q(e),n=q(r);return M(Sr,Ir(t))(n)}function Fe(e,r,t,n){t??=r.before;let o={},i=b0(e,t);for(let a of i)if(typeof e[a]<"u")if(e[a]!==null&&N(Object,e[a])&&!y(e[a]._$)){let f={signer:r.signer,ts:r.ts,id:n.id,owner:n.info.owner};if(typeof e[a]._$=="string"){if(e[a]._$==="del")continue;typeof f[e[a]._$]<"u"&&(o[a]=f[e[a]._$])}else o[a]=A0(vt([e[a]._$,t[a]??null]),f)}else o[a]=e[a];else o[a]=t[a];return o}var sc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function uc(e){if(!Number.isInteger(e)||e<0)throw new Error("Only non-negative integers allowed");if(e===0)return sc[0];let r="";for(;e>0;)r=sc[e%64]+r,e=Math.floor(e/64);return r}function Co({state:e,env:r}){let{dir:t}=e,n=r.kv.get("_",t);if(y(n))throw Error("dir doesn't exist:",t);let o=y(n.autoid)?0:n.autoid+1,i=r.kv[t]??{};for(;r.kv.get(t,uc(o));)o++;return e.doc=uc(o),n.autoid=o,r.kv.put("_",t,n),arguments[0]}function Rt({state:e,env:{kv:r,kv_dir:t}}){let{data:n,dir:o,doc:i,before:a}=e;if(y(r.get("_",o)))throw Error("dir doesn't exist");let f=y(a);return Gl(n,i,[o.toString()],t,f),arguments[0]}function Lo({state:e,env:r}){let{dir:t,doc:n}=e;if(y(r.kv.get("_",t)))throw Error("dir doesn't exist");return Xi(n,[t],r.kv_dir),arguments[0]}function Mt({state:e,env:{kv:r,info:t}}){let n=!1,{data:o,dir:i}=e,a=r.get("_config",`schema_${e.dirinfo.index}`);try{n=(0,lc.validate)(o,a).valid}catch{}let f=JSON.stringify(o).length;if(!n)throw Error("invalid schema");if(t.max_doc_size*20<f)throw Error(`data too large: ${f} bytes (max: ${t.max_data_size*20})`)}function k0(e,r){let t=e.replace(/-/g,"+").replace(/_/g,"/")+"==".slice(2*e.length%4);return Buffer.from(t,"base64").length<=r}function Dt(e,r){if(/^[A-Za-z0-9\-_]+$/.test(e)){let{max_doc_id:t}=r.get("_config","info");if(!k0(e,t))throw Error(`docID too large: ${e}`)}else throw Error(`invalid docID: ${e}`)}function S0(e){let t=(e+"===".slice((e.length+3)%4)).replace(/-/g,"+").replace(/_/g,"/"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[];for(let i=0;i<t.length;i+=4){let a=t.slice(i,i+4),f=0,s=0;for(let u=0;u<a.length;u++)a[u]!=="="&&(f=f<<6|n.indexOf(a[u]),s+=6);for(;s>=8;)s-=8,o.push(f>>s&255)}return new Uint8Array(o)}function O0(e){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",t="";for(let n=0;n<e.length;n+=3){let o=e[n],i=n+1<e.length?e[n+1]:0,a=n+2<e.length?e[n+2]:0,f=o<<16|i<<8|a;t+=r[f>>18&63],t+=r[f>>12&63],n+1<e.length&&(t+=r[f>>6&63]),n+2<e.length&&(t+=r[f&63])}return t}function je(e){if(!e||typeof e!="string")throw new Error("Invalid Arweave address: must be a non-empty string");if(e=e.trim(),e.length!==43)throw new Error(`Invalid Arweave address length: expected 43 characters, got ${e.length}`);if(!/^[A-Za-z0-9\-_]+$/.test(e))throw new Error("Invalid Arweave address: contains invalid characters");try{let t=S0(e);if(t.length!==32)throw new Error(`Invalid Arweave address: decoded to ${t.length} bytes, expected 32`);let n=new Uint8Array(23);return n[0]=97,n[1]=114,n[2]=45,n.set(t.slice(0,20),3),`ar--${O0(t.slice(0,20))}`}catch(t){throw new Error(`Failed to convert Arweave address: ${t.message}`)}}function Ro(e){let r=z(t=>{let n="utf8",o=t;if(N(Array,t)&&(o=t[0],n=t[1]??"utf8"),typeof o!="string"&&(o==null?o=String(o):typeof o=="object"?o=JSON.stringify(o):o=String(o)),n==="utf8"&&o.length===31&&$0(o)&&(n="base64url"),n==="hex"&&o.startsWith("0x")&&(o=o.slice(2)),n==="base64url"){for(o=o.replace(/-/g,"+").replace(/_/g,"/");o.length%4;)o+="=";n="base64"}return Buffer.from(o,n)})(e);return E0(fc(Buffer.concat(r)))}function $0(e){return/^[A-Za-z0-9_-]+$/.test(e)}function E0(e){return Buffer.from(e).slice(0,20).toString("base64").replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}var Yi="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Wo=Yi.length,B0=Yi.charAt(0),iU=Math.log(Wo)/Math.log(256),I0=Math.log(256)/Math.log(Wo);function F0(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length===0)return"";let r=0,t=0,n=0,o=e.length;for(;n!==o&&e[n]===0;)n++,r++;let i=(o-n)*I0+1>>>0,a=new Uint8Array(i);for(;n!==o;){let u=e[n],m=0;for(let g=i-1;(u!==0||m<t)&&g!==-1;g--,m++)u+=256*a[g]>>>0,a[g]=u%Wo>>>0,u=u/Wo>>>0;if(u!==0)throw new Error("Non-zero carry");t=m,n++}let f=i-t;for(;f!==i&&a[f]===0;)f++;let s=B0.repeat(r);for(;f<i;++f)s+=Yi.charAt(a[f]);return s}function Mo(e){let r=(0,cc.hash)(new TextEncoder().encode(JSON.stringify(e)));return F0(new Uint8Array([18,r.length,...Array.from(r)]))}function j0(e){e=e.replace(/-/g,"+").replace(/_/g,"/");let r=e.length%4;if(r===2)e+="==";else if(r===3)e+="=";else if(r!==0)throw new Error("Invalid base64url string");let t=atob(e),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n}function N0(e){let r="";for(let n of e)r+=String.fromCharCode(n);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function dc(e){let r=j0(e),t=(0,mc.default)(r);return N0(t)}function P0(e){let r=e.indexOf("=");if(r<0)throw new Error("Invalid Signature-Input (no `=` found)");let t=e.slice(0,r).trim(),n=e.slice(r+1).trim();if(!n.startsWith("("))throw new Error("Invalid Signature-Input (fields list missing)");let o=n.indexOf(")");if(o<0)throw new Error("Invalid Signature-Input (unclosed fields list)");let a=n.slice(1,o).split(/\s+/).map(u=>u.replace(/^"|"$/g,"").toLowerCase());n=n.slice(o+1);let f=[];n.split(";").forEach(u=>{let m=u.trim();if(!m)return;let g=m.match(/^([a-z0-9-]+)=(?:"((?:[^"\\]|\\.)*)"|([0-9]+|[A-Za-z0-9-._~]+))$/i);if(!g)throw new Error(`Invalid parameter in Signature-Input: ${m}`);let l=g[1].toLowerCase(),c=g[2]!=null?g[2].replace(/\\"/g,'"').replace(/\\\\/g,"\\"):g[3];f.push({key:l,val:c})});let s={label:t,fields:a};for(let{key:u,val:m}of f)u==="alg"&&(s.alg=m),u==="keyid"&&(s.keyid=m),u==="created"&&(s.created=Number(m)),u==="expires"&&(s.expires=Number(m)),u==="nonce"&&(s.nonce=m);if(!s.alg)throw new Error("Missing `alg` in Signature-Input");if(!s.keyid)throw new Error("Missing `keyid` in Signature-Input");return s}function W0({msg:e,env:r}){if(!e)return arguments[0];let t={signature:null,"signature-input":null};for(let n in e.headers){let o=n.toLowerCase();sr(o,["signature","signature-input"])&&(t[o]=e.headers[n],delete e.headers[n])}return e.headers={...e.headers,...t},arguments[0]}function z0(e,r){let t={},n=e.headers["inline-body-key"];for(let l of r){let c=l==="@path"?"path":l;t[c]=e.headers[c]}if(e.body){let l=e.body;n==="data"?t.data=l:t.body=l}delete t["inline-body-key"];let o=pi(e.headers),i=ci(e.headers),a=xi(e.headers),f=dc(a.toString("base64")),s={alg:"rsa-pss-sha512","commitment-device":"httpsig@1.0"},u={alg:"hmac-sha256","commitment-device":"httpsig@1.0"},m={signature:e.headers.signature,"signature-input":e.headers["signature-input"]};return{commitments:{[i]:{...s,committer:f,...m},[o]:{...u,...m}},...t}}var C0=e=>{let r={};for(let t in e?.headers??{})r[t]=e.headers[t];return e.body&&(r.body=e.body),r};function L0({state:e,msg:r,env:t}){if(!r)return arguments[0];let n=_i(Ai(C0(r))),o={},{fields:i,keyid:a}=P0(r.headers["signature-input"]),f={signature:r.headers.signature,"signature-input":r.headers["signature-input"]};for(let u of i){if(typeof r.headers[u]>"u")throw Error("invalid signature");f[u]=r.headers[u],u.toLowerCase()==="content-digest"&&(o.body=r.body)}let s=z0(r,i);if(t.info??={i:-1},t.info.hashpath=t.info.hashpath?mi(t.info.hashpath,s):`${n.id}/${jn(s)}`,e.signer=dc(a),e.signer23=je(e.signer),e.query=JSON.parse(n.query),t.info.i++,typeof n.id>"u")throw Error("id missing");if(typeof n.nonce>"u")throw Error("nonce missing");return e.id=n.id,e.nonce=n.nonce,t.info.ts=r.ts??Date.now(),t.kv.put("_config","info",t.info),arguments[0].msg={headers:f,...o},arguments[0]}var R0=Y().map(W0).map(L0).map(zo),ra=R0;function M0({state:e,msg:r,env:{kv:t}}){let n=t.get("_accounts",e.signer),o=n?.nonce??0;if(+e.nonce!==o+1)throw Error(`the wrong nonce: ${e.nonce}`);return t.put("_accounts",e.signer,{...n,nonce:o+1}),arguments[0]}var hc=M0;var kU=xt.default||xt;function yc({state:e,env:r}){let{data:t,dir:n}=e;if(y(r.kv.get("_",n)))throw Error("dir doesn't exist:",n);return e.data=Fe(t,e,{},r),arguments[0]}function D0({state:e,env:r}){let{data:t,dir:n,doc:o}=e;if(y(e.before))throw Error("data doesn't exist");return e.data=Fe(t,e,void 0,r),arguments[0]}function T0({state:e,env:r}){let{data:t,dir:n,doc:o}=e;if(y(r.kv.get("_",n)))throw Error("dir doesn't exist:",n);return y(e.before)||(e.data=Fe(t,e,void 0,r)),arguments[0]}var gc={add:Y().map(Co).map(yc),set:Y().map(yc),update:Y().map(D0),upsert:Y().map(T0)};function U0({state:e,env:r}){if(e.query.shift(),e.opcode==="batch")return arguments[0];let{kv:t}=r,n,o,i;return e.opcode==="init"||(e.opcode==="get"||e.opcode==="cget"?([o,i]=e.query,e.dir=o,typeof i=="string"?(Dt(i,t),e.doc=i,e.range=!1):e.range=!0):sr(e.opcode,["add","addIndex","removeIndex","addTrigger","removeTrigger","setSchema","setAuth"])?([n,o]=e.query,e.dir=o,e.data=n,e.opcode==="add"&&(e.before=null)):e.opcode==="del"?([o,i]=e.query,Dt(i,t),e.before=t.get(o,i),e.dir=o,e.doc=i,e.data=null):([n,o,i]=e.query,Dt(i,t),e.before=t.get(o,i),e.dir=o,e.doc=i,e.data=n)),o&&(e.dirinfo=t.get("_",o)),r.kv_dir={get:a=>t.get("__indexes__",`${o}/${a}`),put:(a,f,s)=>t.put("__indexes__",`${o}/${a}`,f),del:(a,f)=>t.del("__indexes__",`${o}/${a}`),data:a=>({val:t.get(o,a),__id__:a.split("/").pop()}),putData:(a,f)=>t.put(o,a,f),delData:a=>t.del(o,a)},gc[e.opcode]&&or(arguments[0]).chain(gc[e.opcode].fn()),arguments[0]}var fe=U0;var C=e=>{throw Error(e)},Z0=e=>{if(e.queries=[],y(e.array))if(sr(e.range?.[0]?.[1],["!=","not-in","in"])){let r=e.range?.[0]?.[1];if(r==="!="){let t={},n=ar(e.end);n??=["endBefore"],n[1]??={},n[0]!=="endBefore"&&(n[0]="endBefore"),n[1][e.range[0][0]]=e.range[0][2],t.endBefore=n[1],y(e.start)||(t[e.start[0]]=e.start[1]);let o={},i=ar(e.start);i??=["startAfter"],i[1]??={},i[0]!=="startAfter"&&(i[0]="startAfter"),i[1][e.range[0][0]]=e.range[0][2],o.startAfter=i[1],y(e.end)||(o[e.end[0]]=e.end[1]),e.queries=[{opt:t},{opt:o}],e.reverse.start=!0,e.reverse.end=!0,e.sortRange=!0}else if(r==="in"){let t=Bn(ce)(e.range[0][2]);for(let n of t){let o={},i=ar(e.start);i??=["startAt"],i[1]??={},i[1][e.range[0][0]]=n,o.startAt=i[1];let a=ar(e.end);a??=["endAt"],a[1]??={},a[1][e.range[0][0]]=n,o.endAt=a[1],e.queries.push({opt:o}),e.sortRange=!0,e.reverse.start=!0,e.reverse.end=!0}}else if(r==="not-in"){let t=null,n=Bn(ce)(e.range[0][2]);for(let[o,i]of n.entries()){let a={},f=ar(e.start);o!==0&&(f??=["startAfter"],f[1]??={},f[1][e.range[0][0]]=t),y(f)||(a[f[0]]=f[1]);let s=ar(e.end);if(s??=["endBefore"],s[1]??={},s[1][e.range[0][0]]=i,a.endBefore=s[1],e.queries.push({opt:a}),o==e.range[0][2].length-1){let u={},m=ar(e.start);m??=["startAfter"],m[1]??={},m[1][e.range[0][0]]=i,u.startAfter=m[1];let g=ar(e.end);y(g)||(u[g[0]]=g[1]),e.queries.push({opt:u})}t=i}e.sortRange=!0,e.reverse.start=!0,e.reverse.end=!0}e.type=e.sortByTail?"pranges":"ranges"}else{e.type="range";let r={limit:e.limit};y(e.start)||(r[e.start[0]]=e.start[1]),y(e.end)||(r[e.end[0]]=e.end[1]),e.queries.push({opt:r})}else{let r={limit:e.limit};if(y(e.start)||(r[e.start[0]]=e.start[1]),y(e.end)||(r[e.end[0]]=e.end[1]),e.array[1]==="array-contains-any"){for(let t of e.array[2]){let n=`${e.array[0]}/array:${Ar(JSON.stringify(t))}`;e.queries.push({opt:r,prefix:n})}e.type="pranges"}else{let t=`${e.array[0]}/array:${Ar(JSON.stringify(e.array[2]))}`;e.queries.push({opt:r,prefix:t}),e.type="range"}}},q0=e=>{e.equals.length>0&&!y(e.range)&&sr(e.range[0][0],rt(0,e.equals))&&C(`== and range field must be different [${JSON.stringify(e.range)}]`),(!y(e.start)||!y(e.end))&&(e.equals.length>0||!y(e.range))&&C(`range [${JSON.stringify(e.start??e.end)}] cannot be used with ==/inequity`);let r=null,t=null;if(!y(e.start)||!y(e.end))if(y(e.start)){if(!y(e.end))if(t??=[],t[0]=e.end[0],t[1]??={},e.end[1]?.__cursor__)t[1]=kn("__id__",e.end[1].id,e.end[1].data);else for(let[n,o]of Q(e.end).entries())y(e.sort[n])&&C(`sort must exist for [${JSON.stringify(o)}]`),t[1][e.sort[n][0]]=o}else if(r??=[],r[0]=e.start[0],r[1]??={},e.start[1]?.__cursor__)r[1]=kn("__id__",e.start[1].id,e.start[1].data);else for(let[n,o]of Q(e.start).entries())y(e.sort[n])&&C(`sort must exist for [${JSON.stringify(o)}]`),r[1][e.sort[n][0]]=o;else{for(let n of e.equals)r??=["startAt"],t??=["endAt"],r[1]??={},t[1]??={},r[1][n[0]]=n[2],t[1][n[0]]=n[2];for(let n of e.range||[])n[1]==="<"?(t??=["endBefore"],t[1]??={},t[0]==="endAt"&&(t[0]="endBefore"),t[1][n[0]]=n[2],e.reverse.end=!0):n[1]==="<="?(t??=["endAt"],t[1]??={},t[1][n[0]]=n[2],e.reverse.end=!0):n[1]===">"?(r??=["startAfter"],r[1]??={},r[0]==="startAt"&&(r[0]="startAfter"),r[1][n[0]]=n[2],e.reverse.start=!0):n[1]===">="&&(r??=["startAt"],r[1]??={},r[1][n[0]]=n[2],e.reverse.start=!0)}e.start=r,e.end=t},V0=e=>{let r=[];if(e.equals.length>0){let n=rt(0,e.equals),o=rt(0,e.sort),i=!1;for(let u of o)sr(u,n)?i&&C(`the wrong sort ${JSON.stringify(e.sort)}`):i=!0;let a=Or(n,o),f=kt(Te(0),e.sort),s=Dr(a.length,e.sort.length,e.sort);for(let u of Ht(n))s.unshift(f[u]??[u,"asc"]),r.unshift(f[u]??[u,"asc"]);e.sort=s}let t=r.length;if(!y(e.range?.[0][0])&&(e.sort.length===r.length||e.range[0][1]==="in"?r.push([e.range[0][0]]):!y(e.sort[t])&&e.range[0][0]!==e.sort[t][0]&&C(`the sort field at [${t}] must be [${e.range[0][0]}]`),sr(e.range[0][1],["!=","in","not-in"]))){let n=rt(0,e.sort);n.length!==0&&n[t]!==e.range[0][0]&&(sr(e.range[0][0],n)?C(`the wrong sort ${JSON.stringify(e.sort)}`):(e.sort.splice(e.equals.length,0,[e.range[0][0],"asc"]),e.sortByTail=!0))}for(let[n,o]of(e.sort||[]).entries())y(r[n])?r[n]=o:r[n][0]===o[0]?(!y(r[n][1])&&!y(o[1])&&r[n][1]!==o[1]&&C(`the wrong sort ${JSON.stringify(e.sort)}`),y(r[n][1])&&!y(o[1])&&(r[n][1]=o[1])):C(`the wrong sort ${JSON.stringify(e.sort)}`);e.sort=z(n=>(y(n[1])&&(n[1]="asc"),n))(r)},J0=e=>{let r=X0(e);return V0(r),q0(r),Z0(r),r},X0=e=>{let[r,t]=li(ei(N)(String),e);(y(r)||r.length===0)&&C("the wrong path"),N(Object,t)||C("option must be an object");let n={path:r},o={"==":[]},i={},a={},f=null,s=null,u=null,m=null,g=null,l=null,c=null,d=null,h=null,x=null,w=null,_=null;for(let v of ar(t))N(Number)(v)?y(n.limit)?(v>1e3&&C(`limit cannot be above 1000 [${v}]`),(v!==Math.round(Math.abs(v))||v<1)&&C(`limit must be a natural number [${v}]`),n.limit=v):C(`only one limit is allowed [${v}]`):N(Array)(v)?v.length===0?C("empty query option []"):v[0]==="startAt"?!y(u)||!y(m)||!y(c)||!y(d)?C("only one startAt/startAfter is allowed"):v.length<=1?C("startAt has no value"):v[1].__cursor__?(c=v,c[1].data.__id__=c[1].id):u=v:v[0]==="startAfter"?!y(u)||!y(m)||!y(c)||!y(d)?C("only one startAt/startAfter is allowed"):v.length<=1?C("startAfter has no value"):v[1].__cursor__?(d=v,d[1].data.__id__=d[1].id):m=v:v[0]==="endAt"?!y(g)||!y(l)||!y(h)||!y(x)?C("only one endAt/endBefore is allowed"):v.length<=1?C("endAt has no value"):v[1].__cursor__?(h=v,h[1].data.__id__=h[1].id):g=v:v[0]==="endBefore"?!y(g)||!y(l)||!y(h)||!y(x)?C("only one endAt/endBefore is allowed"):v.length<=1?C("endBefore has no value"):v[1].__cursor__?(x=v,x[1].data.__id__=x[1].id):l=v:v.length===3?sr(v[1])(["==","!=",">","<",">=","<=","in","not-in","array-contains","array-contains-any"])?sr(v[1],["array-contains","array-contains-any"])?((!y(o["array-contains"])||!y(o["array-contains-any"]))&&C("only one array-contains/array-contains-any is allowed"),v[1]==="array-contains-any"&&!N(Array,v[2])&&C(`array-contains-any must be an array ${JSON.stringify(v[2])}`),o[v[1]]=v):sr(v[1],["!=","in","not-in",">",">=","<","<="])?(sr(v[1],["in","not-in"])&&!N(Array,v[2])&&C(`${v[1]} must be an array [${JSON.stringify(v[2])}]`),sr(v[1],[">",">=","<","<="])?((!y(o["!="])||!y(o.in)||!y(o["not-in"]))&&C(`only one inequity is allowed [${JSON.stringify(v)}]`),!y(f)&&f!==v[0]?C(`inequity has to be on the same field [${JSON.stringify(v)}]`):a[v[1]]||v[1]===">"&&a[">="]||v[1]===">="&&a[">"]||v[1]==="<"&&a["<="]||v[1]==="<="&&a["<"]?C(`duplicate inequity [${JSON.stringify(v)}]`):(o.range??=[],o.range.push(v),f=v[0],a[v[1]]=!0)):((!y(o.range)||!y(o["!="])||!y(o.in)||!y(o["not-in"]))&&C(`only one inequity is allowed [${JSON.stringify(v)}]`),o[v[1]]=v)):v[1]==="=="?(!y(o.range)||!y(o["!="])||!y(o.in)||!y(o["not-in"])?C(`== must come before inequity [${JSON.stringify(v)}]`):i[v[0]]&&C(`only one == per field is allowed [${JSON.stringify(v)}]`),o["=="].push(v),i[v[0]]=!0):(y(o[v[1]])||C(),o[v[1]]=v):C(`The wrong where operant [${v[1]}]`):v.length===2?sr(v[1])(["asc","desc"])?y(s)?s=[v]:s.push(v):C(`sort order [${JSON.stringify(v[1])}] must be either asc or desc`):v.length===1?y(s)?s=[mt("asc",v)]:s.push(mt("asc",v)):C(`unknown query option [${JSON.stringify(v)}]`):C(`unknown query [${JSON.stringify(v)}]`);return n.limit??=1e3,n.start=u??m??null,n.end=g??l??null,n.startCursor=c??d??null,n.endCursor=h??x??null,n.sort=s??[],n.reverse={start:!1,end:!1},n.array=o["array-contains"]??o["array-contains-any"]??null,n.equals=o["=="],n.range=o.range??(y(o.in)?y(o["not-in"])?y(o["!="])?null:[o["!="]]:[o["not-in"]]:[o.in]),n.sortByTail=!1,n},xc=J0;var Tt=["__id__","asc"],ta=100,H0=(e,r,t,n=!1,o={})=>{let i=[],a=[];for(let u of e){!wc(u.prefix)&&y(u.prefix)&&u.sort.length===1&&u.sort[0][1]==="desc"&&(u.sort[0][1]="asc",u.opt??={},u.opt.reverse=!0),delete u.opt.limit;let m=u.prefix??"",g=`${M(er("/"),fr)(u.sort.length===0&&m===""?[Tt]:u.sort)}`;m!==""&&g!==""&&(g=`/${g}`),m+=g,vc(m,u.path,t);let l=new ir({order:ta,sort_fields:[...u.sort,Tt],kv:t,prefix:m});_c(u.opt,o,l);let c={val:null,tree:l,cur:l.range(u.opt,!0)};i.push(c)}let f=i[0].tree.comp.bind(i[0].tree),s=i[0].tree.sort_fields;for(kr(Kt(s),Tt)||s.push(Tt),n&&(s=Q(s));i.length>0;){let u=i[0].cur();i[0].val=u;let m=i.shift();if(!y(u)){let g=!1;for(let c=a.length-1;c>=0;c--){let d=f(u,a[c],!1,s);if(d===0){g=!0;break}else if(d<0){a.splice(c+1,0,u),g=!0;break}}g||a.unshift(u);let l=y(r)?null:a[r-1]||null;if(y(l)||f(l,u)<0){let c=0,d=!1;for(let h of i){if(!y(h.val)&&f(u,h.val,!1,s)>=0){i.splice(c,0,m),d=!0;break}c++}d||i.push(m)}}}return y(r)?a:a.slice(0,r)},K0=(e,r,t,n,o={})=>{let i=[],a=0,f=e;if(e[0].sort.length===1&&e[0].sort[0][1]==="desc"&&o.sortRange){f=Ht(f);for(let s of f){let u={};y(s.startAt)||(u.endAt=s.startAt,delete s.startAt),y(s.endAt)||(u.startAt=s.endAt,delete s.endAt),y(s.startAfter)||(u.endBefore=s.startAfter,delete s.startAfter),y(s.endBefore)||(u.startAfter=s.endBefore,delete s.endBefore);for(let m in u)s[m]=u[m]}}for(let s of f)if(y(r)||(s.opt??={},s.opt.limit=r-a),i=Ir(i,Ac(s.sort,s.opt,t,n,!1,"",o)),a+=i.length,!y(r)&&a>=r)break;return i},vc=(e,r,t)=>{let n=Jl(r,t),o=M(z(a=>[a[0],(a[1]||"asc").split(":")[0]]),Fr(2))(e.split("/")),i=M(er("/"),fr)(o);if((o.length>1||o[0][0].split(".").length>1)&&y(n[i]))throw Error(`missing index ${JSON.stringify(o)}`)},_c=(e,r={},t)=>{let n={};if(e.reverse){let o={};r.reverse.start&&(y(e.startAt)?y(e.startAfter)||(o.endBefore=e.startAfter,delete e.startAfter,n.start=!0):(o.endAt=e.startAt,delete e.startAt,n.start=!0)),r.reverse.end&&(y(e.endAt)?y(e.endBefore)||(o.startAfter=e.endBefore,delete e.endBefore,n.end=!0):(o.startAt=e.endAt,delete e.endAt,n.end=!0));for(let i in o)e[i]=o[i]}if(!y(r.start))if(y(e.startAt))if(y(e.startAfter))e[r.start[0]]=r.start[1].data;else{let o=t.comp({key:r.start[1].id,val:r.start[1].data},{val:e.startAfter},e.reverse,dt(t.sort_fields));r.start[0]==="startAt"?(n.end&&o>0||n.end!==!0&&o<0)&&(delete e.startAfter,e[r.start[0]]=r.start[1].data):(n.end&&o>=0||n.end!==!0&&o<=0)&&(e.startAfter=r.start[1].data)}else{let o=t.comp({key:r.start[1].id,val:r.start[1].data},{val:e.startAt},e.reverse,dt(t.sort_fields));(n.end&&o>=0||n.end!==!0&&o<=0)&&(delete e.startAt,e[r.start[0]]=r.start[1].data)}if(!y(r.end))if(y(e.endAt))if(y(e.endBefore))e[r.end[0]]=r.end[1].data;else{let o=t.comp({key:r.end[1].id,val:r.end[1].data},{val:e.endBefore},e.reverse,dt(t.sort_fields));r.end[0]==="endAt"?(n.start&&o<0||n.start!==!0&&o>0)&&(delete e.endBefore,e[r.end[0]]=r.end[1].data):(n.start&&o<=0||n.start!==!0&&o>=0)&&(e.endBefore=r.end[1].data)}else{let o=t.comp({key:r.end[1].id,val:r.end[1].data},{val:e.endAt},e.reverse,dt(t.sort_fields));(n.start&&o<=0||n.start!==!0&&o>=0)&&(delete e.endAt,e[r.end[0]]=r.end[1].data)}return e},wc=e=>e?.split("/")[1]?.split(":")[0]==="array",Ac=(e,r={},t,n,o=!1,i="",a={})=>{!wc(i)&&e.length===1&&e[0][1]==="desc"&&(e[0][1]="asc",r.reverse=!0);let f=`${i}${i===""||e.length===0?"":"/"}${M(er("/"),fr)(e.length===0&&i===""?[Tt]:e)}`;vc(f,t,n);let s=new ir({order:ta,sort_fields:[...e,Tt],kv:n,prefix:f}),u=_c(ar(r),a,s);return s.range(u,o)},G0=(e,r,t)=>{let n=`${M(er("/"),fr)([Tt])}`;return new ir({order:ta,sort_fields:[Tt],kv:t,prefix:n}).data(e)},bc=(e,r)=>{let t=null;if(e.path.length%2===0){let n=dt(e.path),o=Kt(e.path);t=G0(o,n,r)}else{let{limit:n,path:o,sort:i}=e;e.type==="range"?t=Ac(ar(i),e.queries[0].opt,o,r,!1,e.queries[0].prefix,{start:e.startCursor,end:e.endCursor,reverse:e.reverse}):e.type==="ranges"?t=K0(z(a=>({...a,sort:ar(i)}))(e.queries),n,o,r,{start:e.startCursor,end:e.endCursor,reverse:e.reverse,sortRange:e.sortRange}):e.type==="pranges"&&(t=H0(z(a=>({...a,sort:ar(i),path:o}))(e.queries),n,r,e.sortByTail,{start:e.startCursor,end:e.endCursor,reverse:e.reverse}))}return t};function kc({state:e,env:r}){let{dir:t,doc:n}=e,o=r.kv.get("_",t);if(y(o))throw Error(`dir doesn't exist: ${t}`);let i=xc(e.query),a=bc(i,r.kv_dir);return e.opcode==="cget"?e.result=e.range?z(f=>({__cursor__:!0,dir:t,id:f.key,data:f.val}))(a):{__cursor__:!0,dir:t,id:a.key,data:a.val}:e.result=e.range?rt("val")(a):a.val,arguments[0]}var Q0={get:Y().map(kc),cget:Y().map(kc)},Y0=({state:e})=>e.result;function r_({state:e}){return or(arguments[0]).chain(Q0[e.opcode].fn()).to(Y0)}var Ut=r_;function Sc(){return arguments[0]}function Ne({state:e,env:r}){if(e.signer!==r.info.owner)throw Error("only owner can execute");return arguments[0]}function t_({state:{op:e,signer:r,signer23:t,opcode:n,operand:o,dir:i,doc:a,query:f,before:s,data:u,dirinfo:m},msg:g,env:l}){let{kv:c,info:{id:d,owner:h,ts:x,i:w}}=l,_=n==="del"?{}:f[0],v={op:e,opcode:n,operand:o,owner:h,signer:r,signer23:t,ts:x,i:w,db:d,dir:i,doc:a,query:f,req:_,before:s,after:u,allow:!1},k=[];if(y(m))throw Error(`dir doesn't exist: ${i}`);for(let F in m.auth){let R=c.get("_config",`auth_${m.index}_${m.auth[F]}`);R&&k.push(R.rules)}let S=!1,U={get:(F,R,X)=>{let[mr,yr]=F;if(mr[0]==="_")return[c.get(...F),!1];let xr={opcode:"get"};return xr.query=F,xr.dir=mr,typeof yr=="string"?(Dt(yr,c),xr.doc=yr,xr.range=!1):xr.range=!0,[or({state:xr,env:{...l,kv_dir:{get:Br=>c.get("__indexes__",`${mr}/${Br}`),put:(Br,se,ea)=>c.put("__indexes__",`${mr}/${Br}`,se),del:(Br,se)=>c.del("__indexes__",`${mr}/${Br}`),twdata:Br=>({val:c.get(mr,Br),__id__:Br.split("/").pop()}),putData:(Br,se)=>c.put(mr,Br,se),delData:Br=>c.del(mr,Br)}}}).map(Ut).val(),!1]},wdb23:F=>[je(F),!1],wdb160:F=>[Ro(F),!1],cid:F=>[Mo(F),!1]},L=i[0]==="_"?{...U,set:(F,R,X)=>{let[mr,yr,xr]=F;return yr[0]!=="_"?[!1,!1]:(c.put(yr,xr,mr),[!0,!1])},update:(F,R,X)=>{let[mr,yr,xr]=F;if(yr[0]!=="_")return[!1,!1];let _t=c.get(yr,xr);return _t?(c.put(yr,xr,$n(mr,_t)),[!0,!1]):[!1,!1]},upsert:(F,R,X)=>{let[mr,yr,xr]=F;if(yr[0]!=="_")return[!1,!1];let _t=c.get(yr,xr)??{};return c.put(yr,xr,$n(mr,_t)),[!0,!1]},del:(F,R,X)=>{let[mr,yr]=F;return mr[0]!=="_"?[!1,!1]:c.get(mr,yr)?(c.del(mr,yr),[!0,!1]):[!1,!1]}}:U;for(let F of k)if(sr(e,F[0].split(",")))try{No(F[1],v,{...Vl,...L}),v.allow&&(S=!0);break}catch{throw Error("authentication failed")}if(!S)throw Error("operation not allowed");return arguments[0]}var Oc={default:t_,init:Sc,batch:Sc,addIndex:Ne,removeIndex:Ne,addTrigger:Ne,removeTrigger:Ne,setAuth:Ne,setSchema:Ne};function e_({state:e,env:r}){return(Oc[e.opcode]??Oc.default)(arguments[0]),arguments[0]}var Do=e_;var $c={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},writeOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};var Bc=Zt(ji(),1);function n_({state:e,env:r}){let{kv:t,kv_dir:n,info:o}=r,{doc:i,dir:a,data:f,before:s,dirinfo:u}=e,m={on:null,diff:{},before:s,after:f,doc:i,dir:a,i:o.i,ts:o.ts,db:o.id,owner:o.owner,signer:e.signer,signer23:e.signer23};if(s!==null&&f===null){m.on="delete";for(let c in s)m.diff[c]={before:s[c],after:null}}else if(s!==null&&f!==null){let c=q(s),d=q(f),h=Sr(c,d);for(let x of h)kr(s[x],f[x])||(m.on="update",m.diff[x]={before:s[x]??null,after:f[x]??null})}else if(s===null&&f!==null){m.on="create";for(let c in f)m.diff[c]={before:null,after:f[c]}}let g=({before:c,op:d,data:h,dir:x,doc:w})=>{let _={dir:x,doc:w,dirinfo:e.dirinfo,signer:e.signer,signer23:e.signer23,i:o.i,ts:o.ts,id:o.id,owner:o.owner,before:c},k={kv:t,kv_dir:{get:S=>t.get("__indexes__",`${x}/${S}`),put:(S,E,P)=>t.put("__indexes__",`${x}/${S}`,E),del:(S,E)=>t.del("__indexes__",`${x}/${S}`),data:S=>({val:t.get(x,S),__id__:S.split("/").pop()}),putData:(S,E)=>t.put(x,S,E),delData:S=>t.del(x,S)},info:o};return d==="del"?(_.data=null,or({state:_,env:k}).map(Lo)):(_.data=Fe(h,_,void 0,k),d==="add"?or({state:_,env:k}).map(Co).tap(Mt).map(Rt):or({state:_,env:k}).tap(Mt).map(Rt)),[!0,!1]},l=(c,d)=>{let h,x,w,_;if(d==="del"?[x,w]=c:[h,x,w]=c,y(t.get("_",x)))throw Error("dir doesn't exist:",x);let v=d==="add"?null:t.get(x,w)??null;return{data:h,dir:x,doc:w,before:v}};if(m.on){let c={};for(let d in u.triggers||{})c[d]=t.get("_config",`triggers_${u.index}_${u.triggers[d]}`);for(let d in c??{}){let h=c[d],x=h.on.split(",");if(sr(m.on,x)){let w=q(m.diff),_=!h.fields,v=h.match??"all";if(_||(v==="all"&&cr(h.fields,w).length===0||v==="any"&&Or(h.fields,w).length>0||v==="none"&&Or(h.fields,w).length===0)&&(_=!0),_){let k={...m,batch:[]},S={wdb23:$=>[je($),!1],wdb160:$=>[Ro($),!1],cid:$=>[Mo($),!1],get:$=>{let[O,U]=$;if(O[0]==="_")return[t.get(...$),!1];let L={opcode:"get"};return L.query=$,L.dir=O,L.dirinfo=t.get("_",O),typeof U=="string"?(Dt(U,t),L.doc=U,L.range=!1):L.range=!0,[or({state:L,env:{...r,kv_dir:{get:R=>t.get("__indexes__",`${O}/${R}`),put:(R,X,mr)=>t.put("__indexes__",`${O}/${R}`,X),del:(R,X)=>t.del("__indexes__",`${O}/${R}`),data:R=>({val:t.get(O,R),__id__:R.split("/").pop()}),putData:(R,X)=>t.put(O,R,X),delData:R=>t.del(O,R)}}}).map(Ut).val(),!1]},add:$=>{let{data:O,dir:U,before:L}=l($,"add");return g({before:L,op:"add",data:O,dir:U})},set:$=>{let{data:O,dir:U,doc:L,before:F}=l($,"set");if(F)throw Error("doc exists");return g({before:F,data:O,dir:U,doc:L})},update:$=>{let{data:O,dir:U,doc:L,before:F}=l($,"update");if(!F)throw Error("doc doesn't exist");return g({before:F,data:O,dir:U,doc:L})},upsert:$=>{let{data:O,dir:U,doc:L,before:F}=l($,"upsert");return g({before:F,data:O,dir:U,doc:L})},del:$=>{let{dir:O,doc:U,before:L}=l($,"del");if(!L)throw Error("doc doesn't exist");return g({before:L,op:"del",dir:O,doc:U})},toBatchAll:($,O)=>(O.batch=Ir(O.batch,$),[!0,!1]),toBatch:($,O)=>(O.batch.push($),[!0,!1])};No(h.fn,k,S);let E=$=>{if(N(Array,$))$=z(O=>N(Object,O)?E(O):O)($);else if(N(Object,$)){if(N(String,$.var))return Kr($.var.split("."))(k);$=z(O=>E(O))($)}return $},P=[];for(let $ of k.batch)typeof $=="string"?P=[...P,...E(vt($))]:P.push($);for(let $ of P){let[O,...U]=$;O[0]==="%"&&(O=O.slice(1)),S[O](E(vt(U)))}}}}}return arguments[0]}var Pe=n_;function o_({state:e,env:{kv:r}}){let{data:t,dir:n,dirinfo:o}=e;if(!t.key)throw Error("key doesn't exist");if(!t.on)throw Error("on doesn't exist");if(cr(t.on.split(","),["create","update","delete"]).length>0)throw Error(`the wrong on: ${t.on}`);if(t.fields&&!Array.isArray(t.fields))throw Error("fields must be Array");if(t.match&&!sr(t.match,["all","any","none"]))throw Error(`the wrong type: ${t.match}`);o.triggers??={},o.triggers_index=-1,o.triggers[t.key]=++o.triggers_index;let i={on:t.on,fn:t.fn,match:t.match??"all",fields:t.fields??null};return r.put("_",n,o),r.put("_config",`triggers_${o.index}_${o.triggers[t.key]}`,i),arguments[0]}function i_({state:e,env:{kv:r}}){let{data:t,dir:n,dirinfo:o}=e;if(!t.key)throw Error("key doesn't exist");if(o.triggers??={},y(o.triggers[t.key]))throw Error("trigger doesn't exist");return r.del("_config",`triggers_${o.index}_${o.triggers[t.key]}`),delete o.triggers[t.key],r.put("_",n,o),arguments[0]}function a_({state:e,env:{kv:r}}){let{data:t,dir:n,dirinfo:o}=e,i={},a=-1,f=t.length,s=(o.auth_index??-1)+1;if(!Array.isArray(t))throw Error("auth must be an array");if(s>f)for(let u=f;u<s;u++)u>=f&&r.del("_config",`auth_${o.index}_${u}`);for(let u of t){if(!Array.isArray(u))throw Error("auth must be an array");i[u[0]]=++a,r.put("_config",`auth_${o.index}_${a}`,{rules:u})}return a===-1?delete o.auth_index:o.auth_index=a,o.auth=i,r.put("_",n,o),arguments[0]}function f_({state:e,env:{kv:r}}){let{data:t,dir:n,dirinfo:o}=e,i=!1;try{i=(0,Bc.validate)(t,$c).valid}catch{}if(!i)throw Error("invalid schema");return r.put("_config",`schema_${o.index}`,t),arguments[0]}function Ic(e){for(let r of e){if(!Array.isArray(r))throw Error("index must be Array");if(r.length>2||r.length<1)throw Error("the wrong index");r.length===1&&r.push("asc")}return e}function s_({state:e,env:{kv:r,kv_dir:t}}){let{data:n,dir:o,dirinfo:i}=e;if(!Array.isArray(n))throw Error("index must be Array");if(n.length<2)throw Error("index must be multi fields");let a=r.get("_config",`indexes_${e.index}`)??{indexes:[]},f=Ic(n);for(let s of a.indexes||[])if(kr(f,s))throw Error("index already exists:",f);return a.indexes.push(f),Hl(n,[o],t),r.put("_config",`indexes_${i.index}`,a),arguments[0]}function u_({state:e,env:{kv:r,kv_dir:t}}){let{data:n,dir:o,dirinfo:i}=e,a=r.get("_config",`indexes_${i.index}`)??{indexes:[]},f=[],s=Ic(n),u=!1;for(let m of a.indexes)kr(s,m)?u=!0:f.push(m);if(!u)throw Error("index doesn't exist");return Kl(n,[o],t),a.indexes=f,r.put("_config",`indexes_${e.index}`,a),arguments[0]}function l_({state:e,env:r}){for(let t of e.query)or({state:{nonce:e.nonce,ts:e.ts,signer:e.signer,id:e.id,query:t},msg:null,env:{kv:r.kv,no_commit:!0}}).map(zo).map(fe).map(Do).map(Fc);return arguments[0]}var Ec={init:Y().map(pc),set:Y().tap(Mt).map(Rt).map(Pe),add:Y().tap(Mt).map(Rt).map(Pe),upsert:Y().tap(Mt).map(Rt).map(Pe),update:Y().tap(Mt).map(Rt).map(Pe),del:Y().map(Lo).map(Pe),addIndex:Y().map(s_),removeIndex:Y().map(u_),addTrigger:Y().map(o_),removeTrigger:Y().map(i_),setSchema:Y().map(f_),setAuth:Y().map(a_),batch:Y().map(l_)};function Fc({state:e,msg:r,env:{no_commit:t,kv:n,info:o}}){Ec[e.opcode]&&or(arguments[0]).chain(Ec[e.opcode].fn());let i=null;return t!==!0&&(i=n.commit(r,null,e,o)),e.result=i,arguments[0]}var jc=Fc;var c_=(e,r,t,n={})=>{let o={},i={},a=e.get("__meta__/current"),f=a?a.i+1:0,s=[],u=!1,m=h=>ar(i[h]??o[h]??e.get(h)??null),g=(h,x)=>i[h]=x,l=h=>g(h,null),c=h=>{i={},h&&h()},d=async()=>{if(s.length>0){u=!0;let h=0,x,w,_,v,k=null,S=[],E={},P=null,$=null,O=null;await e.transaction(()=>{for(;s.length>0;){({i:x,cl:w,opt:k,cb:P,state:$,info:O}=s.shift()),_||(_=x),v=x;let U={},L={};for(let X in w??{})k.delta&&(E[X]=e.get(X)??null),w[X]===null?e.remove(X):e.put(X,w[X]),/^__.*$/.test(X)?L[X]=w[X]:U[X]=w[X],h++;let F={i:x,opt:k,cl:U,ts:O?.ts,hashpath:O?.hashpath??null},R={cl:L};S.push(F),e.put(["__wal__",x],F),e.put(["__priv_wal__",x],F),e.put("__meta__/current",{i:x,ts:O?.ts,hashpath:$?.hashpath??null});try{P&&P(F)}catch(X){console.log(X)}x++}}),r?.({from:_,to:v,count:h,len:s.length,data:S,old:E}),await d()}u=!1};return{io:e,reset:c,commit:(h={},x,w,_)=>{t&&t(h,{put:g,get:m,del:l},w,_).then(()=>{});let v=ar(i);s.push({i:f,cl:v,opt:h,cb:x,state:w,info:_});for(let k in v??{})o[k]=v[k];return c(),u||d().then(()=>{}),{i:f++,data:v}},put:g,del:l,get:m,dump:()=>({l:i,s:o}),...n}},Nc=c_;var p_=e=>({...e,get:(a,f)=>e.get(`${a}/${f}`),put:(a,f,s)=>e.put(`${a}/${f}`,s),del:(a,f)=>e.del(`${a}/${f}`),commit:(...a)=>e.commit(...a),reset:(...a)=>e.reset(...a)}),m_=({kv:e,msg:r,opt:t})=>({state:{},msg:r,env:{...t,kv:e,info:e.get("_config","info")}}),d_=({kv:e,async:r=!1,write:t,read:n,__write__:o={},__read__:i={},init:a=m_,store:f=p_})=>(s,u={})=>{let m=s.init(e)(Nc),g={};if(t){let c=Y();for(let d of t)d.__ka__?c=c.chain(d.fn()):d.__monad__?c=c.chain(d):c=c.map(d);g.write=(d,h,x)=>{try{let{state:w,msg:_}=or({kv:d,msg:h,opt:{...u,...x}}).map(a).chain(c.fn()).val();return{...w,msg:_}}catch(w){throw console.log(w),d.reset(),w}},r&&(g.pwrite=(d,h,x)=>new Promise((w,_)=>{try{or({kv:d,msg:h,opt:{...u,...x,cb:w}}).map(a).chain(c.fn())}catch(v){d.reset(),_(v)}}))}if(n){let c=Y();for(let d of n)d.__ka__?c=c.chain(d.fn()):d.__monad__?c=c.chain(d):c=c.map(d);g.read=(d,h,x)=>{try{return or({kv:d,msg:h,opt:{...u,...x}}).map(a).chain(c.fn()).val()}catch(w){throw w}}}for(let c in i){let d=i[c],h=Y();for(let x of d)x.__ka__?h=h.chain(x.fn()):x.__monad__?h=h.chain(x):h=h.map(x);g[c]=async(x,...w)=>{try{let _=or({kv:x,msg:w,opt:u}).map(a).chain(h.fn()).val();return _&&typeof _.then=="function"?await _:_}catch(_){throw _}}}for(let c in o){let d=o[c],h=Y();for(let x of d)x.__ka__?h=h.chain(x.fn()):x.__monad__?h=h.chain(x):h=h.map(x);g[c]=(x,...w)=>{try{return or({kv:x,msg:w,opt:u}).map(a).chain(h.fn()),x}catch(_){throw x.reset(),_}}}return(r?Yt(g):Qt(g))(f(m))},Pc=d_;var Wc=(e,r,t,n={})=>o=>{let i=o(e.io,r,t,n);for(let a in i)e[a]=i[a];return e};function h_({state:e,msg:r}){return e.opcode="get",e.query=["get",...r],arguments[0]}function y_({state:e,msg:r}){return e.opcode="cget",e.query=["cget",...r],arguments[0]}var EZ=Pc({kv:Wc,write:[ra,hc,fe,Do,jc],read:[ra,fe,Ut],__read__:{get:[h_,fe,Ut],cget:[y_,fe,Ut]}});export{EZ as default};
